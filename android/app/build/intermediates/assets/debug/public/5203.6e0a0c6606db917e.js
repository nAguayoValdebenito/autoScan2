"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5203],{5203:(dI,Bu,te)=>{te.r(Bu),te.d(Bu,{RegistroPageModule:()=>Cy});var Ms=te(177),jt=te(4341),be=te(4742),fi=te(4964),b=te(467),F=te(3953),zf=te(8287),at=te(1182),He=te(9842),je=te(574),mi=te(9253),Qf=te(3236),$f=te(1985),gi=te(8455),Uu=te(7673),Os=te(9172),Wf=te(9974),Hf=te(4360);function Ls(){return(0,Wf.N)((r,e)=>{let t,n=!1;r.subscribe((0,Hf._)(e,i=>{const s=t;t=i,n&&e.next([s,i]),n=!0}))})}var zt,zu,Xe=te(6354),Bs=te(2816),Jf=te(3294),qu=te(5964),Yf=(te(324),te(9574)),pi=te(2979),Gu=te(8779),Ze=te(5398),ne=te(1401),Ku=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ju={};(function(){var r;function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function i(T,p,I){I||(I=0);var E=Array(16);if("string"==typeof p)for(var v=0;16>v;++v)E[v]=p.charCodeAt(I++)|p.charCodeAt(I++)<<8|p.charCodeAt(I++)<<16|p.charCodeAt(I++)<<24;else for(v=0;16>v;++v)E[v]=p[I++]|p[I++]<<8|p[I++]<<16|p[I++]<<24;var P=T.g[3],y=(p=T.g[0])+(P^(I=T.g[1])&((v=T.g[2])^P))+E[0]+3614090360&4294967295;y=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=(I=(v=(P=(p=I+(y<<7&4294967295|y>>>25))+((y=P+(v^p&(I^v))+E[1]+3905402710&4294967295)<<12&4294967295|y>>>20))+((y=v+(I^P&(p^I))+E[2]+606105819&4294967295)<<17&4294967295|y>>>15))+((y=I+(p^v&(P^p))+E[3]+3250441966&4294967295)<<22&4294967295|y>>>10))+((y=p+(P^I&(v^P))+E[4]+4118548399&4294967295)<<7&4294967295|y>>>25))+((y=P+(v^p&(I^v))+E[5]+1200080426&4294967295)<<12&4294967295|y>>>20))+((y=v+(I^P&(p^I))+E[6]+2821735955&4294967295)<<17&4294967295|y>>>15))+((y=I+(p^v&(P^p))+E[7]+4249261313&4294967295)<<22&4294967295|y>>>10))+((y=p+(P^I&(v^P))+E[8]+1770035416&4294967295)<<7&4294967295|y>>>25))+((y=P+(v^p&(I^v))+E[9]+2336552879&4294967295)<<12&4294967295|y>>>20))+((y=v+(I^P&(p^I))+E[10]+4294925233&4294967295)<<17&4294967295|y>>>15))+((y=I+(p^v&(P^p))+E[11]+2304563134&4294967295)<<22&4294967295|y>>>10))+((y=p+(P^I&(v^P))+E[12]+1804603682&4294967295)<<7&4294967295|y>>>25))+((y=P+(v^p&(I^v))+E[13]+4254626195&4294967295)<<12&4294967295|y>>>20))+((y=v+(I^P&(p^I))+E[14]+2792965006&4294967295)<<17&4294967295|y>>>15))+((y=I+(p^v&(P^p))+E[15]+1236535329&4294967295)<<22&4294967295|y>>>10))+((y=p+(v^P&(I^v))+E[1]+4129170786&4294967295)<<5&4294967295|y>>>27))+((y=P+(I^v&(p^I))+E[6]+3225465664&4294967295)<<9&4294967295|y>>>23))+((y=v+(p^I&(P^p))+E[11]+643717713&4294967295)<<14&4294967295|y>>>18))+((y=I+(P^p&(v^P))+E[0]+3921069994&4294967295)<<20&4294967295|y>>>12))+((y=p+(v^P&(I^v))+E[5]+3593408605&4294967295)<<5&4294967295|y>>>27))+((y=P+(I^v&(p^I))+E[10]+38016083&4294967295)<<9&4294967295|y>>>23))+((y=v+(p^I&(P^p))+E[15]+3634488961&4294967295)<<14&4294967295|y>>>18))+((y=I+(P^p&(v^P))+E[4]+3889429448&4294967295)<<20&4294967295|y>>>12))+((y=p+(v^P&(I^v))+E[9]+568446438&4294967295)<<5&4294967295|y>>>27))+((y=P+(I^v&(p^I))+E[14]+3275163606&4294967295)<<9&4294967295|y>>>23))+((y=v+(p^I&(P^p))+E[3]+4107603335&4294967295)<<14&4294967295|y>>>18))+((y=I+(P^p&(v^P))+E[8]+1163531501&4294967295)<<20&4294967295|y>>>12))+((y=p+(v^P&(I^v))+E[13]+2850285829&4294967295)<<5&4294967295|y>>>27))+((y=P+(I^v&(p^I))+E[2]+4243563512&4294967295)<<9&4294967295|y>>>23))+((y=v+(p^I&(P^p))+E[7]+1735328473&4294967295)<<14&4294967295|y>>>18))+((y=I+(P^p&(v^P))+E[12]+2368359562&4294967295)<<20&4294967295|y>>>12))+((y=p+(I^v^P)+E[5]+4294588738&4294967295)<<4&4294967295|y>>>28))+((y=P+(p^I^v)+E[8]+2272392833&4294967295)<<11&4294967295|y>>>21))+((y=v+(P^p^I)+E[11]+1839030562&4294967295)<<16&4294967295|y>>>16))+((y=I+(v^P^p)+E[14]+4259657740&4294967295)<<23&4294967295|y>>>9))+((y=p+(I^v^P)+E[1]+2763975236&4294967295)<<4&4294967295|y>>>28))+((y=P+(p^I^v)+E[4]+1272893353&4294967295)<<11&4294967295|y>>>21))+((y=v+(P^p^I)+E[7]+4139469664&4294967295)<<16&4294967295|y>>>16))+((y=I+(v^P^p)+E[10]+3200236656&4294967295)<<23&4294967295|y>>>9))+((y=p+(I^v^P)+E[13]+681279174&4294967295)<<4&4294967295|y>>>28))+((y=P+(p^I^v)+E[0]+3936430074&4294967295)<<11&4294967295|y>>>21))+((y=v+(P^p^I)+E[3]+3572445317&4294967295)<<16&4294967295|y>>>16))+((y=I+(v^P^p)+E[6]+76029189&4294967295)<<23&4294967295|y>>>9))+((y=p+(I^v^P)+E[9]+3654602809&4294967295)<<4&4294967295|y>>>28))+((y=P+(p^I^v)+E[12]+3873151461&4294967295)<<11&4294967295|y>>>21))+((y=v+(P^p^I)+E[15]+530742520&4294967295)<<16&4294967295|y>>>16))+((y=I+(v^P^p)+E[2]+3299628645&4294967295)<<23&4294967295|y>>>9))+((y=p+(v^(I|~P))+E[0]+4096336452&4294967295)<<6&4294967295|y>>>26))+((y=P+(I^(p|~v))+E[7]+1126891415&4294967295)<<10&4294967295|y>>>22))+((y=v+(p^(P|~I))+E[14]+2878612391&4294967295)<<15&4294967295|y>>>17))+((y=I+(P^(v|~p))+E[5]+4237533241&4294967295)<<21&4294967295|y>>>11))+((y=p+(v^(I|~P))+E[12]+1700485571&4294967295)<<6&4294967295|y>>>26))+((y=P+(I^(p|~v))+E[3]+2399980690&4294967295)<<10&4294967295|y>>>22))+((y=v+(p^(P|~I))+E[10]+4293915773&4294967295)<<15&4294967295|y>>>17))+((y=I+(P^(v|~p))+E[1]+2240044497&4294967295)<<21&4294967295|y>>>11))+((y=p+(v^(I|~P))+E[8]+1873313359&4294967295)<<6&4294967295|y>>>26))+((y=P+(I^(p|~v))+E[15]+4264355552&4294967295)<<10&4294967295|y>>>22))+((y=v+(p^(P|~I))+E[6]+2734768916&4294967295)<<15&4294967295|y>>>17))+((y=I+(P^(v|~p))+E[13]+1309151649&4294967295)<<21&4294967295|y>>>11))+((P=(p=I+((y=p+(v^(I|~P))+E[4]+4149444226&4294967295)<<6&4294967295|y>>>26))+((y=P+(I^(p|~v))+E[11]+3174756917&4294967295)<<10&4294967295|y>>>22))^((v=P+((y=v+(p^(P|~I))+E[2]+718787259&4294967295)<<15&4294967295|y>>>17))|~p))+E[9]+3951481745&4294967295,T.g[0]=T.g[0]+p&4294967295,T.g[1]=T.g[1]+(v+(y<<21&4294967295|y>>>11))&4294967295,T.g[2]=T.g[2]+v&4294967295,T.g[3]=T.g[3]+P&4294967295}function a(T,p){this.h=p;for(var I=[],E=!0,v=T.length-1;0<=v;v--){var P=0|T[v];E&&P==p||(I[v]=P,E=!1)}this.g=I}(function e(T,p){function I(){}I.prototype=p.prototype,T.D=p.prototype,T.prototype=new I,T.prototype.constructor=T,T.C=function(E,v,P){for(var y=Array(arguments.length-2),yt=2;yt<arguments.length;yt++)y[yt-2]=arguments[yt];return p.prototype[v].apply(E,y)}})(n,function t(){this.blockSize=-1}),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},n.prototype.u=function(T,p){void 0===p&&(p=T.length);for(var I=p-this.blockSize,E=this.B,v=this.h,P=0;P<p;){if(0==v)for(;P<=I;)i(this,T,P),P+=this.blockSize;if("string"==typeof T){for(;P<p;)if(E[v++]=T.charCodeAt(P++),v==this.blockSize){i(this,E),v=0;break}}else for(;P<p;)if(E[v++]=T[P++],v==this.blockSize){i(this,E),v=0;break}}this.h=v,this.o+=p},n.prototype.v=function(){var T=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);T[0]=128;for(var p=1;p<T.length-8;++p)T[p]=0;var I=8*this.o;for(p=T.length-8;p<T.length;++p)T[p]=255&I,I/=256;for(this.u(T),T=Array(16),p=I=0;4>p;++p)for(var E=0;32>E;E+=8)T[I++]=this.g[p]>>>E&255;return T};var u={};function l(T){return-128<=T&&128>T?function s(T,p){var I=u;return Object.prototype.hasOwnProperty.call(I,T)?I[T]:I[T]=p(T)}(T,function(p){return new a([0|p],0>p?-1:0)}):new a([0|T],0>T?-1:0)}function h(T){if(isNaN(T)||!isFinite(T))return g;if(0>T)return D(h(-T));for(var p=[],I=1,E=0;T>=I;E++)p[E]=T/I|0,I*=4294967296;return new a(p,0)}var g=l(0),_=l(1),R=l(16777216);function x(T){if(0!=T.h)return!1;for(var p=0;p<T.g.length;p++)if(0!=T.g[p])return!1;return!0}function k(T){return-1==T.h}function D(T){for(var p=T.g.length,I=[],E=0;E<p;E++)I[E]=~T.g[E];return new a(I,~T.h).add(_)}function U(T,p){return T.add(D(p))}function j(T,p){for(;(65535&T[p])!=T[p];)T[p+1]+=T[p]>>>16,T[p]&=65535,p++}function G(T,p){this.g=T,this.h=p}function z(T,p){if(x(p))throw Error("division by zero");if(x(T))return new G(g,g);if(k(T))return p=z(D(T),p),new G(D(p.g),D(p.h));if(k(p))return p=z(T,D(p)),new G(D(p.g),p.h);if(30<T.g.length){if(k(T)||k(p))throw Error("slowDivide_ only works with positive integers.");for(var I=_,E=p;0>=E.l(T);)I=X(I),E=X(E);var v=$(I,1),P=$(E,1);for(E=$(E,2),I=$(I,2);!x(E);){var y=P.add(E);0>=y.l(T)&&(v=v.add(I),P=y),E=$(E,1),I=$(I,1)}return p=U(T,v.j(p)),new G(v,p)}for(v=g;0<=T.l(p);){for(I=Math.max(1,Math.floor(T.m()/p.m())),E=48>=(E=Math.ceil(Math.log(I)/Math.LN2))?1:Math.pow(2,E-48),y=(P=h(I)).j(p);k(y)||0<y.l(T);)y=(P=h(I-=E)).j(p);x(P)&&(P=_),v=v.add(P),T=U(T,y)}return new G(v,T)}function X(T){for(var p=T.g.length+1,I=[],E=0;E<p;E++)I[E]=T.i(E)<<1|T.i(E-1)>>>31;return new a(I,T.h)}function $(T,p){var I=p>>5;p%=32;for(var E=T.g.length-I,v=[],P=0;P<E;P++)v[P]=0<p?T.i(P+I)>>>p|T.i(P+I+1)<<32-p:T.i(P+I);return new a(v,T.h)}(r=a.prototype).m=function(){if(k(this))return-D(this).m();for(var T=0,p=1,I=0;I<this.g.length;I++){var E=this.i(I);T+=(0<=E?E:4294967296+E)*p,p*=4294967296}return T},r.toString=function(T){if(2>(T=T||10)||36<T)throw Error("radix out of range: "+T);if(x(this))return"0";if(k(this))return"-"+D(this).toString(T);for(var p=h(Math.pow(T,6)),I=this,E="";;){var v=z(I,p).g,P=((0<(I=U(I,v.j(p))).g.length?I.g[0]:I.h)>>>0).toString(T);if(x(I=v))return P+E;for(;6>P.length;)P="0"+P;E=P+E}},r.i=function(T){return 0>T?0:T<this.g.length?this.g[T]:this.h},r.l=function(T){return k(T=U(this,T))?-1:x(T)?0:1},r.abs=function(){return k(this)?D(this):this},r.add=function(T){for(var p=Math.max(this.g.length,T.g.length),I=[],E=0,v=0;v<=p;v++){var P=E+(65535&this.i(v))+(65535&T.i(v)),y=(P>>>16)+(this.i(v)>>>16)+(T.i(v)>>>16);E=y>>>16,I[v]=(y&=65535)<<16|(P&=65535)}return new a(I,-2147483648&I[I.length-1]?-1:0)},r.j=function(T){if(x(this)||x(T))return g;if(k(this))return k(T)?D(this).j(D(T)):D(D(this).j(T));if(k(T))return D(this.j(D(T)));if(0>this.l(R)&&0>T.l(R))return h(this.m()*T.m());for(var p=this.g.length+T.g.length,I=[],E=0;E<2*p;E++)I[E]=0;for(E=0;E<this.g.length;E++)for(var v=0;v<T.g.length;v++){var P=this.i(E)>>>16,y=65535&this.i(E),yt=T.i(v)>>>16,Wr=65535&T.i(v);I[2*E+2*v]+=y*Wr,j(I,2*E+2*v),I[2*E+2*v+1]+=P*Wr,j(I,2*E+2*v+1),I[2*E+2*v+1]+=y*yt,j(I,2*E+2*v+1),I[2*E+2*v+2]+=P*yt,j(I,2*E+2*v+2)}for(E=0;E<p;E++)I[E]=I[2*E+1]<<16|I[2*E];for(E=p;E<2*p;E++)I[E]=0;return new a(I,0)},r.A=function(T){return z(this,T).h},r.and=function(T){for(var p=Math.max(this.g.length,T.g.length),I=[],E=0;E<p;E++)I[E]=this.i(E)&T.i(E);return new a(I,this.h&T.h)},r.or=function(T){for(var p=Math.max(this.g.length,T.g.length),I=[],E=0;E<p;E++)I[E]=this.i(E)|T.i(E);return new a(I,this.h|T.h)},r.xor=function(T){for(var p=Math.max(this.g.length,T.g.length),I=[],E=0;E<p;E++)I[E]=this.i(E)^T.i(E);return new a(I,this.h^T.h)},n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,zu=ju.Md5=n,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=h,a.fromString=function f(T,p){if(0==T.length)throw Error("number format error: empty string");if(2>(p=p||10)||36<p)throw Error("radix out of range: "+p);if("-"==T.charAt(0))return D(f(T.substring(1),p));if(0<=T.indexOf("-"))throw Error('number format error: interior "-" character');for(var I=h(Math.pow(p,8)),E=g,v=0;v<T.length;v+=8){var P=Math.min(8,T.length-v),y=parseInt(T.substring(v,v+P),p);8>P?(P=h(Math.pow(p,P)),E=E.j(P).add(h(y))):E=(E=E.j(I)).add(h(y))}return E},zt=ju.Integer=a}).apply(typeof Ku<"u"?Ku:typeof self<"u"?self:typeof window<"u"?window:{});var Qu,or,$u,yi,Us,Wu,Hu,Ju,_i=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ut={};(function(){var r,e="function"==typeof Object.defineProperties?Object.defineProperty:function(o,c,d){return o==Array.prototype||o==Object.prototype||(o[c]=d.value),o},n=function t(o){o=["object"==typeof globalThis&&globalThis,o,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof _i&&_i];for(var c=0;c<o.length;++c){var d=o[c];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}(this);!function i(o,c){if(c)e:{var d=n;o=o.split(".");for(var m=0;m<o.length-1;m++){var A=o[m];if(!(A in d))break e;d=d[A]}(c=c(m=d[o=o[o.length-1]]))!=m&&null!=c&&e(d,o,{configurable:!0,writable:!0,value:c})}}("Array.prototype.values",function(o){return o||function(){return function s(o,c){o instanceof String&&(o+="");var d=0,m=!1,A={next:function(){if(!m&&d<o.length){var S=d++;return{value:c(S,o[S]),done:!1}}return m=!0,{done:!0,value:void 0}}};return A[Symbol.iterator]=function(){return A},A}(this,function(c,d){return d})}});var a=a||{},u=this||self;function l(o){var c=typeof o;return"array"==(c="object"!=c?c:o?Array.isArray(o)?"array":c:"null")||"object"==c&&"number"==typeof o.length}function h(o){var c=typeof o;return"object"==c&&null!=o||"function"==c}function f(o,c,d){return o.call.apply(o.bind,arguments)}function g(o,c,d){if(!o)throw Error();if(2<arguments.length){var m=Array.prototype.slice.call(arguments,2);return function(){var A=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(A,m),o.apply(c,A)}}return function(){return o.apply(c,arguments)}}function _(o,c,d){return(_=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?f:g).apply(null,arguments)}function R(o,c){var d=Array.prototype.slice.call(arguments,1);return function(){var m=d.slice();return m.push.apply(m,arguments),o.apply(this,m)}}function x(o,c){function d(){}d.prototype=c.prototype,o.aa=c.prototype,o.prototype=new d,o.prototype.constructor=o,o.Qb=function(m,A,S){for(var O=Array(arguments.length-2),oe=2;oe<arguments.length;oe++)O[oe-2]=arguments[oe];return c.prototype[A].apply(m,O)}}function k(o){const c=o.length;if(0<c){const d=Array(c);for(let m=0;m<c;m++)d[m]=o[m];return d}return[]}function D(o,c){for(let d=1;d<arguments.length;d++){const m=arguments[d];if(l(m)){const A=o.length||0,S=m.length||0;o.length=A+S;for(let O=0;O<S;O++)o[A+O]=m[O]}else o.push(m)}}function j(o){return/^[\s\xa0]*$/.test(o)}function G(){var o=u.navigator;return o&&(o=o.userAgent)?o:""}function z(o){return z[" "](o),o}z[" "]=function(){};var X=!(-1==G().indexOf("Gecko")||-1!=G().toLowerCase().indexOf("webkit")&&-1==G().indexOf("Edge")||-1!=G().indexOf("Trident")||-1!=G().indexOf("MSIE")||-1!=G().indexOf("Edge"));function $(o,c,d){for(const m in o)c.call(d,o[m],m,o)}function p(o){const c={};for(const d in o)c[d]=o[d];return c}const I="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function E(o,c){let d,m;for(let A=1;A<arguments.length;A++){for(d in m=arguments[A],m)o[d]=m[d];for(let S=0;S<I.length;S++)d=I[S],Object.prototype.hasOwnProperty.call(m,d)&&(o[d]=m[d])}}function v(o){var c=1;o=o.split(":");const d=[];for(;0<c&&o.length;)d.push(o.shift()),c--;return o.length&&d.push(o.join(":")),d}function P(o){u.setTimeout(()=>{throw o},0)}function y(){var o=mu;let c=null;return o.g&&(c=o.g,o.g=o.g.next,o.g||(o.h=null),c.next=null),c}var Wr=new class U{constructor(c,d){this.i=c,this.j=d,this.h=0,this.g=null}get(){let c;return 0<this.h?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}(()=>new Dy,o=>o.reset());class Dy{constructor(){this.next=this.g=this.h=null}set(c,d){this.h=c,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let Hr,Jr=!1,mu=new class yt{constructor(){this.h=this.g=null}add(c,d){const m=Wr.get();m.set(c,d),this.h?this.h.next=m:this.g=m,this.h=m}},Kd=()=>{const o=u.Promise.resolve(void 0);Hr=()=>{o.then(Ny)}};var Ny=()=>{for(var o;o=y();){try{o.h.call(o.g)}catch(d){P(d)}var c=Wr;c.j(o),100>c.h&&(c.h++,o.next=c.g,c.g=o)}Jr=!1};function Ut(){this.s=this.s,this.C=this.C}function ke(o,c){this.type=o,this.g=this.target=c,this.defaultPrevented=!1}Ut.prototype.s=!1,Ut.prototype.ma=function(){this.s||(this.s=!0,this.N())},Ut.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},ke.prototype.h=function(){this.defaultPrevented=!0};var ky=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var o=!1,c=Object.defineProperty({},"passive",{get:function(){o=!0}});try{const d=()=>{};u.addEventListener("test",d,c),u.removeEventListener("test",d,c)}catch{}return o}();function Yr(o,c){if(ke.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o){var d=this.type=o.type,m=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;if(this.target=o.target||o.srcElement,this.g=c,c=o.relatedTarget){if(X){e:{try{z(c.nodeName);var A=!0;break e}catch{}A=!1}A||(c=null)}}else"mouseover"==d?c=o.fromElement:"mouseout"==d&&(c=o.toElement);this.relatedTarget=c,m?(this.clientX=void 0!==m.clientX?m.clientX:m.pageX,this.clientY=void 0!==m.clientY?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0):(this.clientX=void 0!==o.clientX?o.clientX:o.pageX,this.clientY=void 0!==o.clientY?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType="string"==typeof o.pointerType?o.pointerType:Fy[o.pointerType]||"",this.state=o.state,this.i=o,o.defaultPrevented&&Yr.aa.h.call(this)}}x(Yr,ke);var Fy={2:"touch",3:"pen",4:"mouse"};Yr.prototype.h=function(){Yr.aa.h.call(this);var o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var Xr="closure_listenable_"+(1e6*Math.random()|0),My=0;function Oy(o,c,d,m,A){this.listener=o,this.proxy=null,this.src=c,this.type=d,this.capture=!!m,this.ha=A,this.key=++My,this.da=this.fa=!1}function Is(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function Ts(o){this.src=o,this.g={},this.h=0}function gu(o,c){var d=c.type;if(d in o.g){var S,m=o.g[d],A=Array.prototype.indexOf.call(m,c,void 0);(S=0<=A)&&Array.prototype.splice.call(m,A,1),S&&(Is(c),0==o.g[d].length&&(delete o.g[d],o.h--))}}function pu(o,c,d,m){for(var A=0;A<o.length;++A){var S=o[A];if(!S.da&&S.listener==c&&S.capture==!!d&&S.ha==m)return A}return-1}Ts.prototype.add=function(o,c,d,m,A){var S=o.toString();(o=this.g[S])||(o=this.g[S]=[],this.h++);var O=pu(o,c,m,A);return-1<O?(c=o[O],d||(c.fa=!1)):((c=new Oy(c,this.src,S,!!m,A)).fa=d,o.push(c)),c};var _u="closure_lm_"+(1e6*Math.random()|0),yu={};function jd(o,c,d,m,A){if(m&&m.once)return Qd(o,c,d,m,A);if(Array.isArray(c)){for(var S=0;S<c.length;S++)jd(o,c[S],d,m,A);return null}return d=vu(d),o&&o[Xr]?o.K(c,d,h(m)?!!m.capture:!!m,A):zd(o,c,d,!1,m,A)}function zd(o,c,d,m,A,S){if(!c)throw Error("Invalid event type");var O=h(A)?!!A.capture:!!A,oe=Tu(o);if(oe||(o[_u]=oe=new Ts(o)),(d=oe.add(c,d,m,O,S)).proxy)return d;if(m=function Ly(){const c=By;return function o(d){return c.call(o.src,o.listener,d)}}(),d.proxy=m,m.src=o,m.listener=d,o.addEventListener)ky||(A=O),void 0===A&&(A=!1),o.addEventListener(c.toString(),m,A);else if(o.attachEvent)o.attachEvent(Wd(c.toString()),m);else{if(!o.addListener||!o.removeListener)throw Error("addEventListener and attachEvent are unavailable.");o.addListener(m)}return d}function Qd(o,c,d,m,A){if(Array.isArray(c)){for(var S=0;S<c.length;S++)Qd(o,c[S],d,m,A);return null}return d=vu(d),o&&o[Xr]?o.L(c,d,h(m)?!!m.capture:!!m,A):zd(o,c,d,!0,m,A)}function $d(o,c,d,m,A){if(Array.isArray(c))for(var S=0;S<c.length;S++)$d(o,c[S],d,m,A);else m=h(m)?!!m.capture:!!m,d=vu(d),o&&o[Xr]?(o=o.i,(c=String(c).toString())in o.g&&-1<(d=pu(S=o.g[c],d,m,A))&&(Is(S[d]),Array.prototype.splice.call(S,d,1),0==S.length&&(delete o.g[c],o.h--))):o&&(o=Tu(o))&&(c=o.g[c.toString()],o=-1,c&&(o=pu(c,d,m,A)),(d=-1<o?c[o]:null)&&Iu(d))}function Iu(o){if("number"!=typeof o&&o&&!o.da){var c=o.src;if(c&&c[Xr])gu(c.i,o);else{var d=o.type,m=o.proxy;c.removeEventListener?c.removeEventListener(d,m,o.capture):c.detachEvent?c.detachEvent(Wd(d),m):c.addListener&&c.removeListener&&c.removeListener(m),(d=Tu(c))?(gu(d,o),0==d.h&&(d.src=null,c[_u]=null)):Is(o)}}}function Wd(o){return o in yu?yu[o]:yu[o]="on"+o}function By(o,c){if(o.da)o=!0;else{c=new Yr(c,this);var d=o.listener,m=o.ha||o.src;o.fa&&Iu(o),o=d.call(m,c)}return o}function Tu(o){return(o=o[_u])instanceof Ts?o:null}var Eu="__closure_events_fn_"+(1e9*Math.random()>>>0);function vu(o){return"function"==typeof o?o:(o[Eu]||(o[Eu]=function(c){return o.handleEvent(c)}),o[Eu])}function Fe(){Ut.call(this),this.i=new Ts(this),this.M=this,this.F=null}function Ue(o,c){var d,m=o.F;if(m)for(d=[];m;m=m.F)d.push(m);if(o=o.M,m=c.type||c,"string"==typeof c)c=new ke(c,o);else if(c instanceof ke)c.target=c.target||o;else{var A=c;E(c=new ke(m,o),A)}if(A=!0,d)for(var S=d.length-1;0<=S;S--){var O=c.g=d[S];A=Es(O,m,!0,c)&&A}if(A=Es(O=c.g=o,m,!0,c)&&A,A=Es(O,m,!1,c)&&A,d)for(S=0;S<d.length;S++)A=Es(O=c.g=d[S],m,!1,c)&&A}function Es(o,c,d,m){if(!(c=o.i.g[String(c)]))return!0;c=c.concat();for(var A=!0,S=0;S<c.length;++S){var O=c[S];if(O&&!O.da&&O.capture==d){var oe=O.listener,Se=O.ha||O.src;O.fa&&gu(o.i,O),A=!1!==oe.call(Se,m)&&A}}return A&&!m.defaultPrevented}function Hd(o,c,d){if("function"==typeof o)d&&(o=_(o,d));else{if(!o||"function"!=typeof o.handleEvent)throw Error("Invalid listener argument");o=_(o.handleEvent,o)}return 2147483647<Number(c)?-1:u.setTimeout(o,c||0)}function Jd(o){o.g=Hd(()=>{o.g=null,o.i&&(o.i=!1,Jd(o))},o.l);const c=o.h;o.h=null,o.m.apply(null,c)}x(Fe,Ut),Fe.prototype[Xr]=!0,Fe.prototype.removeEventListener=function(o,c,d,m){$d(this,o,c,d,m)},Fe.prototype.N=function(){if(Fe.aa.N.call(this),this.i){var c,o=this.i;for(c in o.g){for(var d=o.g[c],m=0;m<d.length;m++)Is(d[m]);delete o.g[c],o.h--}}this.F=null},Fe.prototype.K=function(o,c,d,m){return this.i.add(String(o),c,!1,d,m)},Fe.prototype.L=function(o,c,d,m){return this.i.add(String(o),c,!0,d,m)};class Uy extends Ut{constructor(c,d){super(),this.m=c,this.l=d,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:Jd(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Zr(o){Ut.call(this),this.h=o,this.g={}}x(Zr,Ut);var Yd=[];function Xd(o){$(o.g,function(c,d){this.g.hasOwnProperty(d)&&Iu(c)},o),o.g={}}Zr.prototype.N=function(){Zr.aa.N.call(this),Xd(this)},Zr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Au=u.JSON.stringify,qy=u.JSON.parse,Gy=class{stringify(o){return u.JSON.stringify(o,void 0)}parse(o){return u.JSON.parse(o,void 0)}};function wu(){}function ef(){}wu.prototype.h=null;var ei={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Ru(){ke.call(this,"d")}function Pu(){ke.call(this,"c")}x(Ru,ke),x(Pu,ke);var mn={},tf=null;function vs(){return tf=tf||new Fe}function nf(o){ke.call(this,mn.La,o)}function ti(o){const c=vs();Ue(c,new nf(c))}function rf(o,c){ke.call(this,mn.STAT_EVENT,o),this.stat=c}function qe(o){const c=vs();Ue(c,new rf(c,o))}function sf(o,c){ke.call(this,mn.Ma,o),this.size=c}function ni(o,c){if("function"!=typeof o)throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){o()},c)}function ri(){this.g=!0}function nr(o,c,d,m){o.info(function(){return"XMLHTTP TEXT ("+c+"): "+function Qy(o,c){if(!o.g)return c;if(!c)return null;try{var d=JSON.parse(c);if(d)for(o=0;o<d.length;o++)if(Array.isArray(d[o])){var m=d[o];if(!(2>m.length)){var A=m[1];if(Array.isArray(A)&&!(1>A.length)){var S=A[0];if("noop"!=S&&"stop"!=S&&"close"!=S)for(var O=1;O<A.length;O++)A[O]=""}}}return Au(d)}catch{return c}}(o,d)+(m?" "+m:"")})}mn.La="serverreachability",x(nf,ke),mn.STAT_EVENT="statevent",x(rf,ke),mn.Ma="timingevent",x(sf,ke),ri.prototype.xa=function(){this.g=!1},ri.prototype.info=function(){};var Vu,As={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},of={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function ws(){}function qt(o,c,d,m){this.j=o,this.i=c,this.l=d,this.R=m||1,this.U=new Zr(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new af}function af(){this.i=null,this.g="",this.h=!1}x(ws,wu),ws.prototype.g=function(){return new XMLHttpRequest},ws.prototype.i=function(){return{}},Vu=new ws;var uf={},Su={};function bu(o,c,d){o.L=1,o.v=Ss(It(c)),o.m=d,o.P=!0,lf(o,null)}function lf(o,c){o.F=Date.now(),Rs(o),o.A=It(o.v);var d=o.A,m=o.R;Array.isArray(m)||(m=[String(m)]),Af(d.i,"t",m),o.C=0,d=o.j.J,o.h=new af,o.g=qf(o.j,d?c:null,!o.m),0<o.O&&(o.M=new Uy(_(o.Y,o,o.g),o.O)),c=o.U,d=o.g,m=o.ca;var A="readystatechange";Array.isArray(A)||(A&&(Yd[0]=A.toString()),A=Yd);for(var S=0;S<A.length;S++){var O=jd(d,A[S],m||c.handleEvent,!1,c.h||c);if(!O)break;c.g[O.key]=O}c=o.H?p(o.H):{},o.m?(o.u||(o.u="POST"),c["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.A,o.u,o.m,c)):(o.u="GET",o.g.ea(o.A,o.u,null,c)),ti(),function Ky(o,c,d,m,A,S){o.info(function(){if(o.g)if(S)for(var O="",oe=S.split("&"),Se=0;Se<oe.length;Se++){var ee=oe[Se].split("=");if(1<ee.length){var Me=ee[0];ee=ee[1];var Oe=Me.split("_");O=2<=Oe.length&&"type"==Oe[1]?O+(Me+"=")+ee+"&":O+(Me+"=redacted&")}}else O=null;else O=S;return"XMLHTTP REQ ("+m+") [attempt "+A+"]: "+c+"\n"+d+"\n"+O})}(o.i,o.u,o.A,o.l,o.R,o.m)}function cf(o){return!!o.g&&"GET"==o.u&&2!=o.L&&o.j.Ca}function $y(o,c){var d=o.C,m=c.indexOf("\n",d);return-1==m?Su:(d=Number(c.substring(d,m)),isNaN(d)?uf:(m+=1)+d>c.length?Su:(c=c.slice(m,m+d),o.C=m+d,c))}function Rs(o){o.S=Date.now()+o.I,hf(o,o.I)}function hf(o,c){if(null!=o.B)throw Error("WatchDog timer not null");o.B=ni(_(o.ba,o),c)}function xu(o){o.B&&(u.clearTimeout(o.B),o.B=null)}function ii(o){0==o.j.G||o.J||Of(o.j,o)}function gn(o){xu(o);var c=o.M;c&&"function"==typeof c.ma&&c.ma(),o.M=null,Xd(o.U),o.g&&(c=o.g,o.g=null,c.abort(),c.ma())}function Cu(o,c){try{var d=o.j;if(0!=d.G&&(d.g==o||Du(d.h,o)))if(!o.K&&Du(d.h,o)&&3==d.G){try{var m=d.Da.g.parse(c)}catch{m=null}if(Array.isArray(m)&&3==m.length){var A=m;if(0==A[0]){e:if(!d.u){if(d.g){if(!(d.g.F+3e3<o.F))break e;Ns(d),Cs(d)}Mu(d),qe(18)}}else d.za=A[1],0<d.za-d.T&&37500>A[2]&&d.F&&0==d.v&&!d.C&&(d.C=ni(_(d.Za,d),6e3));if(1>=mf(d.h)&&d.ca){try{d.ca()}catch{}d.ca=void 0}}else _n(d,11)}else if((o.K||d.g==o)&&Ns(d),!j(c))for(A=d.Da.g.parse(c),c=0;c<A.length;c++){let ee=A[c];if(d.T=ee[0],ee=ee[1],2==d.G)if("c"==ee[0]){d.K=ee[1],d.ia=ee[2];const Me=ee[3];null!=Me&&(d.la=Me,d.j.info("VER="+d.la));const Oe=ee[4];null!=Oe&&(d.Aa=Oe,d.j.info("SVER="+d.Aa));const sr=ee[5];null!=sr&&"number"==typeof sr&&0<sr&&(d.L=m=1.5*sr,d.j.info("backChannelRequestTimeoutMs_="+m)),m=d;const Ye=o.g;if(Ye){const Fs=Ye.g?Ye.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Fs){var S=m.h;S.g||-1==Fs.indexOf("spdy")&&-1==Fs.indexOf("quic")&&-1==Fs.indexOf("h2")||(S.j=S.l,S.g=new Set,S.h&&(Nu(S,S.h),S.h=null))}if(m.D){const Lu=Ye.g?Ye.g.getResponseHeader("X-HTTP-Session-Id"):null;Lu&&(m.ya=Lu,he(m.I,m.D,Lu))}}d.G=3,d.l&&d.l.ua(),d.ba&&(d.R=Date.now()-o.F,d.j.info("Handshake RTT: "+d.R+"ms"));var O=o;if((m=d).qa=Uf(m,m.J?m.ia:null,m.W),O.K){gf(m.h,O);var oe=O,Se=m.L;Se&&(oe.I=Se),oe.B&&(xu(oe),Rs(oe)),m.g=O}else Ff(m);0<d.i.length&&Ds(d)}else"stop"!=ee[0]&&"close"!=ee[0]||_n(d,7);else 3==d.G&&("stop"==ee[0]||"close"==ee[0]?"stop"==ee[0]?_n(d,7):Fu(d):"noop"!=ee[0]&&d.l&&d.l.ta(ee),d.v=0)}ti()}catch{}}qt.prototype.ca=function(o){o=o.target;const c=this.M;c&&3==Tt(o)?c.j():this.Y(o)},qt.prototype.Y=function(o){try{if(o==this.g)e:{const Oe=Tt(this.g);var c=this.g.Ba();if(this.g.Z(),!(3>Oe)&&(3!=Oe||this.g&&(this.h.h||this.g.oa()||xf(this.g)))){this.J||4!=Oe||7==c||ti(),xu(this);var d=this.g.Z();this.X=d;t:if(cf(this)){var m=xf(this.g);o="";var A=m.length,S=4==Tt(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){gn(this),ii(this);var O="";break t}this.h.i=new u.TextDecoder}for(c=0;c<A;c++)this.h.h=!0,o+=this.h.i.decode(m[c],{stream:!(S&&c==A-1)});m.length=0,this.h.g+=o,this.C=0,O=this.h.g}else O=this.g.oa();if(this.o=200==d,function jy(o,c,d,m,A,S,O){o.info(function(){return"XMLHTTP RESP ("+m+") [ attempt "+A+"]: "+c+"\n"+d+"\n"+S+" "+O})}(this.i,this.u,this.A,this.l,this.R,Oe,d),this.o){if(this.T&&!this.K){t:{if(this.g){var oe,Se=this.g;if((oe=Se.g?Se.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!j(oe)){var ee=oe;break t}}ee=null}if(!(d=ee)){this.o=!1,this.s=3,qe(12),gn(this),ii(this);break e}nr(this.i,this.l,d,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Cu(this,d)}if(this.P){let Ye;for(d=!0;!this.J&&this.C<O.length;){if(Ye=$y(this,O),Ye==Su){4==Oe&&(this.s=4,qe(14),d=!1),nr(this.i,this.l,null,"[Incomplete Response]");break}if(Ye==uf){this.s=4,qe(15),nr(this.i,this.l,O,"[Invalid Chunk]"),d=!1;break}nr(this.i,this.l,Ye,null),Cu(this,Ye)}if(cf(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=Oe||0!=O.length||this.h.h||(this.s=1,qe(16),d=!1),this.o=this.o&&d,d){if(0<O.length&&!this.W){this.W=!0;var Me=this.j;Me.g==this&&Me.ba&&!Me.M&&(Me.j.info("Great, no buffering proxy detected. Bytes received: "+O.length),Ou(Me),Me.M=!0,qe(11))}}else nr(this.i,this.l,O,"[Invalid Chunked Response]"),gn(this),ii(this)}else nr(this.i,this.l,O,null),Cu(this,O);4==Oe&&gn(this),this.o&&!this.J&&(4==Oe?Of(this.j,this):(this.o=!1,Rs(this)))}else(function cI(o){const c={};o=(o.g&&2<=Tt(o)&&o.g.getAllResponseHeaders()||"").split("\r\n");for(let m=0;m<o.length;m++){if(j(o[m]))continue;var d=v(o[m]);const A=d[0];if("string"!=typeof(d=d[1]))continue;d=d.trim();const S=c[A]||[];c[A]=S,S.push(d)}!function T(o,c){for(const d in o)c.call(void 0,o[d],d,o)}(c,function(m){return m.join(", ")})})(this.g),400==d&&0<O.indexOf("Unknown SID")?(this.s=3,qe(12)):(this.s=0,qe(13)),gn(this),ii(this)}}}catch{}},qt.prototype.cancel=function(){this.J=!0,gn(this)},qt.prototype.ba=function(){this.B=null;const o=Date.now();0<=o-this.S?(function zy(o,c){o.info(function(){return"TIMEOUT: "+c})}(this.i,this.A),2!=this.L&&(ti(),qe(17)),gn(this),this.s=2,ii(this)):hf(this,this.S-o)};var Wy=class{constructor(o,c){this.g=o,this.map=c}};function df(o){this.l=o||10,o=u.PerformanceNavigationTiming?0<(o=u.performance.getEntriesByType("navigation")).length&&("hq"==o[0].nextHopProtocol||"h2"==o[0].nextHopProtocol):!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function ff(o){return!!o.h||!!o.g&&o.g.size>=o.j}function mf(o){return o.h?1:o.g?o.g.size:0}function Du(o,c){return o.h?o.h==c:!!o.g&&o.g.has(c)}function Nu(o,c){o.g?o.g.add(c):o.h=c}function gf(o,c){o.h&&o.h==c?o.h=null:o.g&&o.g.has(c)&&o.g.delete(c)}function pf(o){if(null!=o.h)return o.i.concat(o.h.D);if(null!=o.g&&0!==o.g.size){let c=o.i;for(const d of o.g.values())c=c.concat(d.D);return c}return k(o.i)}function _f(o,c){if(o.forEach&&"function"==typeof o.forEach)o.forEach(c,void 0);else if(l(o)||"string"==typeof o)Array.prototype.forEach.call(o,c,void 0);else for(var d=function Jy(o){if(o.na&&"function"==typeof o.na)return o.na();if(!o.V||"function"!=typeof o.V){if(typeof Map<"u"&&o instanceof Map)return Array.from(o.keys());if(!(typeof Set<"u"&&o instanceof Set)){if(l(o)||"string"==typeof o){var c=[];o=o.length;for(var d=0;d<o;d++)c.push(d);return c}c=[],d=0;for(const m in o)c[d++]=m;return c}}}(o),m=function Hy(o){if(o.V&&"function"==typeof o.V)return o.V();if(typeof Map<"u"&&o instanceof Map||typeof Set<"u"&&o instanceof Set)return Array.from(o.values());if("string"==typeof o)return o.split("");if(l(o)){for(var c=[],d=o.length,m=0;m<d;m++)c.push(o[m]);return c}for(m in c=[],d=0,o)c[d++]=o[m];return c}(o),A=m.length,S=0;S<A;S++)c.call(void 0,m[S],d&&d[S],o)}df.prototype.cancel=function(){if(this.i=pf(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const o of this.g.values())o.cancel();this.g.clear()}};var yf=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function pn(o){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,o instanceof pn){this.h=o.h,Ps(this,o.j),this.o=o.o,this.g=o.g,Vs(this,o.s),this.l=o.l;var c=o.i,d=new ai;d.i=c.i,c.g&&(d.g=new Map(c.g),d.h=c.h),If(this,d),this.m=o.m}else o&&(c=String(o).match(yf))?(this.h=!1,Ps(this,c[1]||"",!0),this.o=si(c[2]||""),this.g=si(c[3]||"",!0),Vs(this,c[4]),this.l=si(c[5]||"",!0),If(this,c[6]||"",!0),this.m=si(c[7]||"")):(this.h=!1,this.i=new ai(null,this.h))}function It(o){return new pn(o)}function Ps(o,c,d){o.j=d?si(c,!0):c,o.j&&(o.j=o.j.replace(/:$/,""))}function Vs(o,c){if(c){if(c=Number(c),isNaN(c)||0>c)throw Error("Bad port number "+c);o.s=c}else o.s=null}function If(o,c,d){c instanceof ai?(o.i=c,function rI(o,c){c&&!o.j&&(Gt(o),o.i=null,o.g.forEach(function(d,m){var A=m.toLowerCase();m!=A&&(Ef(this,m),Af(this,A,d))},o)),o.j=c}(o.i,o.h)):(d||(c=oi(c,tI)),o.i=new ai(c,o.h))}function he(o,c,d){o.i.set(c,d)}function Ss(o){return he(o,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),o}function si(o,c){return o?c?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function oi(o,c,d){return"string"==typeof o?(o=encodeURI(o).replace(c,Xy),d&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function Xy(o){return"%"+((o=o.charCodeAt(0))>>4&15).toString(16)+(15&o).toString(16)}pn.prototype.toString=function(){var o=[],c=this.j;c&&o.push(oi(c,Tf,!0),":");var d=this.g;return(d||"file"==c)&&(o.push("//"),(c=this.o)&&o.push(oi(c,Tf,!0),"@"),o.push(encodeURIComponent(String(d)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(d=this.s)&&o.push(":",String(d))),(d=this.l)&&(this.g&&"/"!=d.charAt(0)&&o.push("/"),o.push(oi(d,"/"==d.charAt(0)?eI:Zy,!0))),(d=this.i.toString())&&o.push("?",d),(d=this.m)&&o.push("#",oi(d,nI)),o.join("")};var Tf=/[#\/\?@]/g,Zy=/[#\?:]/g,eI=/[#\?]/g,tI=/[#\?@]/g,nI=/#/g;function ai(o,c){this.h=this.g=null,this.i=o||null,this.j=!!c}function Gt(o){o.g||(o.g=new Map,o.h=0,o.i&&function Yy(o,c){if(o){o=o.split("&");for(var d=0;d<o.length;d++){var m=o[d].indexOf("="),A=null;if(0<=m){var S=o[d].substring(0,m);A=o[d].substring(m+1)}else S=o[d];c(S,A?decodeURIComponent(A.replace(/\+/g," ")):"")}}}(o.i,function(c,d){o.add(decodeURIComponent(c.replace(/\+/g," ")),d)}))}function Ef(o,c){Gt(o),c=rr(o,c),o.g.has(c)&&(o.i=null,o.h-=o.g.get(c).length,o.g.delete(c))}function vf(o,c){return Gt(o),c=rr(o,c),o.g.has(c)}function Af(o,c,d){Ef(o,c),0<d.length&&(o.i=null,o.g.set(rr(o,c),k(d)),o.h+=d.length)}function rr(o,c){return c=String(c),o.j&&(c=c.toLowerCase()),c}function Kt(o,c,d,m,A){try{A&&(A.onload=null,A.onerror=null,A.onabort=null,A.ontimeout=null),m(d)}catch{}}function oI(){this.g=new Gy}function aI(o,c,d){const m=d||"";try{_f(o,function(A,S){let O=A;h(A)&&(O=Au(A)),c.push(m+S+"="+encodeURIComponent(O))})}catch(A){throw c.push(m+"type="+encodeURIComponent("_badmap")),A}}function ui(o){this.l=o.Ub||null,this.j=o.eb||!1}function bs(o,c){Fe.call(this),this.D=o,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function wf(o){o.j.read().then(o.Pa.bind(o)).catch(o.ga.bind(o))}function li(o){o.readyState=4,o.l=null,o.j=null,o.v=null,ci(o)}function ci(o){o.onreadystatechange&&o.onreadystatechange.call(o)}function Rf(o){let c="";return $(o,function(d,m){c+=m,c+=":",c+=d,c+="\r\n"}),c}function ku(o,c,d){e:{for(m in d){var m=!1;break e}m=!0}m||(d=Rf(d),"string"==typeof o?null!=d&&encodeURIComponent(String(d)):he(o,c,d))}function _e(o){Fe.call(this),this.headers=new Map,this.o=o||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(r=ai.prototype).add=function(o,c){Gt(this),this.i=null,o=rr(this,o);var d=this.g.get(o);return d||this.g.set(o,d=[]),d.push(c),this.h+=1,this},r.forEach=function(o,c){Gt(this),this.g.forEach(function(d,m){d.forEach(function(A){o.call(c,A,m,this)},this)},this)},r.na=function(){Gt(this);const o=Array.from(this.g.values()),c=Array.from(this.g.keys()),d=[];for(let m=0;m<c.length;m++){const A=o[m];for(let S=0;S<A.length;S++)d.push(c[m])}return d},r.V=function(o){Gt(this);let c=[];if("string"==typeof o)vf(this,o)&&(c=c.concat(this.g.get(rr(this,o))));else{o=Array.from(this.g.values());for(let d=0;d<o.length;d++)c=c.concat(o[d])}return c},r.set=function(o,c){return Gt(this),this.i=null,vf(this,o=rr(this,o))&&(this.h-=this.g.get(o).length),this.g.set(o,[c]),this.h+=1,this},r.get=function(o,c){return o&&0<(o=this.V(o)).length?String(o[0]):c},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const o=[],c=Array.from(this.g.keys());for(var d=0;d<c.length;d++){var m=c[d];const S=encodeURIComponent(String(m)),O=this.V(m);for(m=0;m<O.length;m++){var A=S;""!==O[m]&&(A+="="+encodeURIComponent(String(O[m]))),o.push(A)}}return this.i=o.join("&")},x(ui,wu),ui.prototype.g=function(){return new bs(this.l,this.j)},ui.prototype.i=function(o){return function(){return o}}({}),x(bs,Fe),(r=bs.prototype).open=function(o,c){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=o,this.A=c,this.readyState=1,ci(this)},r.send=function(o){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const c={headers:this.u,method:this.B,credentials:this.m,cache:void 0};o&&(c.body=o),(this.D||u).fetch(new Request(this.A,c)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,li(this)),this.readyState=0},r.Sa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,ci(this)),this.g&&(this.readyState=3,ci(this),this.g)))if("arraybuffer"===this.responseType)o.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;wf(this)}else o.text().then(this.Ra.bind(this),this.ga.bind(this))},r.Pa=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var c=o.value?o.value:new Uint8Array(0);(c=this.v.decode(c,{stream:!o.done}))&&(this.response=this.responseText+=c)}o.done?li(this):ci(this),3==this.readyState&&wf(this)}},r.Ra=function(o){this.g&&(this.response=this.responseText=o,li(this))},r.Qa=function(o){this.g&&(this.response=o,li(this))},r.ga=function(){this.g&&li(this)},r.setRequestHeader=function(o,c){this.u.append(o,c)},r.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const o=[],c=this.h.entries();for(var d=c.next();!d.done;)o.push((d=d.value)[0]+": "+d[1]),d=c.next();return o.join("\r\n")},Object.defineProperty(bs.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(o){this.m=o?"include":"same-origin"}}),x(_e,Fe);var uI=/^https?$/i,lI=["POST","PUT"];function Pf(o,c){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=c,o.m=5,Vf(o),xs(o)}function Vf(o){o.A||(o.A=!0,Ue(o,"complete"),Ue(o,"error"))}function Sf(o){if(o.h&&typeof a<"u"&&(!o.v[1]||4!=Tt(o)||2!=o.Z()))if(o.u&&4==Tt(o))Hd(o.Ea,0,o);else if(Ue(o,"readystatechange"),4==Tt(o)){o.h=!1;try{const O=o.Z();e:switch(O){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break e;default:c=!1}var d;if(!(d=c)){var m;if(m=0===O){var A=String(o.D).match(yf)[1]||null;!A&&u.self&&u.self.location&&(A=u.self.location.protocol.slice(0,-1)),m=!uI.test(A?A.toLowerCase():"")}d=m}if(d)Ue(o,"complete"),Ue(o,"success");else{o.m=6;try{var S=2<Tt(o)?o.g.statusText:""}catch{S=""}o.l=S+" ["+o.Z()+"]",Vf(o)}}finally{xs(o)}}}function xs(o,c){if(o.g){bf(o);const d=o.g,m=o.v[0]?()=>{}:null;o.g=null,o.v=null,c||Ue(o,"ready");try{d.onreadystatechange=m}catch{}}}function bf(o){o.I&&(u.clearTimeout(o.I),o.I=null)}function Tt(o){return o.g?o.g.readyState:0}function xf(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.H){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function hi(o,c,d){return d&&d.internalChannelParams&&d.internalChannelParams[o]||c}function Cf(o){this.Aa=0,this.i=[],this.j=new ri,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=hi("failFast",!1,o),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=hi("baseRetryDelayMs",5e3,o),this.cb=hi("retryDelaySeedMs",1e4,o),this.Wa=hi("forwardChannelMaxRetries",2,o),this.wa=hi("forwardChannelRequestTimeoutMs",2e4,o),this.pa=o&&o.xmlHttpFactory||void 0,this.Xa=o&&o.Tb||void 0,this.Ca=o&&o.useFetchStreams||!1,this.L=void 0,this.J=o&&o.supportsCrossDomainXhr||!1,this.K="",this.h=new df(o&&o.concurrentRequestLimit),this.Da=new oI,this.P=o&&o.fastHandshake||!1,this.O=o&&o.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=o&&o.Rb||!1,o&&o.xa&&this.j.xa(),o&&o.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&o&&o.detectBufferingProxy||!1,this.ja=void 0,o&&o.longPollingTimeout&&0<o.longPollingTimeout&&(this.ja=o.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function Fu(o){if(Df(o),3==o.G){var c=o.U++,d=It(o.I);if(he(d,"SID",o.K),he(d,"RID",c),he(d,"TYPE","terminate"),di(o,d),(c=new qt(o,o.j,c)).L=2,c.v=Ss(It(d)),d=!1,u.navigator&&u.navigator.sendBeacon)try{d=u.navigator.sendBeacon(c.v.toString(),"")}catch{}!d&&u.Image&&((new Image).src=c.v,d=!0),d||(c.g=qf(c.j,null),c.g.ea(c.v)),c.F=Date.now(),Rs(c)}Bf(o)}function Cs(o){o.g&&(Ou(o),o.g.cancel(),o.g=null)}function Df(o){Cs(o),o.u&&(u.clearTimeout(o.u),o.u=null),Ns(o),o.h.cancel(),o.s&&("number"==typeof o.s&&u.clearTimeout(o.s),o.s=null)}function Ds(o){if(!ff(o.h)&&!o.s){o.s=!0;var c=o.Ga;Hr||Kd(),Jr||(Hr(),Jr=!0),mu.add(c,o),o.B=0}}function Nf(o,c){var d;d=c?c.l:o.U++;const m=It(o.I);he(m,"SID",o.K),he(m,"RID",d),he(m,"AID",o.T),di(o,m),o.m&&o.o&&ku(m,o.m,o.o),d=new qt(o,o.j,d,o.B+1),null===o.m&&(d.H=o.o),c&&(o.i=c.D.concat(o.i)),c=kf(o,d,1e3),d.I=Math.round(.5*o.wa)+Math.round(.5*o.wa*Math.random()),Nu(o.h,d),bu(d,m,c)}function di(o,c){o.H&&$(o.H,function(d,m){he(c,m,d)}),o.l&&_f({},function(d,m){he(c,m,d)})}function kf(o,c,d){d=Math.min(o.i.length,d);var m=o.l?_(o.l.Na,o.l,o):null;e:{var A=o.i;let S=-1;for(;;){const O=["count="+d];-1==S?0<d?(S=A[0].g,O.push("ofs="+S)):S=0:O.push("ofs="+S);let oe=!0;for(let Se=0;Se<d;Se++){let ee=A[Se].g;const Me=A[Se].map;if(ee-=S,0>ee)S=Math.max(0,A[Se].g-100),oe=!1;else try{aI(Me,O,"req"+ee+"_")}catch{m&&m(Me)}}if(oe){m=O.join("&");break e}}}return o=o.i.splice(0,d),c.D=o,m}function Ff(o){if(!o.g&&!o.u){o.Y=1;var c=o.Fa;Hr||Kd(),Jr||(Hr(),Jr=!0),mu.add(c,o),o.v=0}}function Mu(o){return!(o.g||o.u||3<=o.v||(o.Y++,o.u=ni(_(o.Fa,o),Lf(o,o.v)),o.v++,0))}function Ou(o){null!=o.A&&(u.clearTimeout(o.A),o.A=null)}function Mf(o){o.g=new qt(o,o.j,"rpc",o.Y),null===o.m&&(o.g.H=o.o),o.g.O=0;var c=It(o.qa);he(c,"RID","rpc"),he(c,"SID",o.K),he(c,"AID",o.T),he(c,"CI",o.F?"0":"1"),!o.F&&o.ja&&he(c,"TO",o.ja),he(c,"TYPE","xmlhttp"),di(o,c),o.m&&o.o&&ku(c,o.m,o.o),o.L&&(o.g.I=o.L);var d=o.g;o=o.ia,d.L=1,d.v=Ss(It(c)),d.m=null,d.P=!0,lf(d,o)}function Ns(o){null!=o.C&&(u.clearTimeout(o.C),o.C=null)}function Of(o,c){var d=null;if(o.g==c){Ns(o),Ou(o),o.g=null;var m=2}else{if(!Du(o.h,c))return;d=c.D,gf(o.h,c),m=1}if(0!=o.G)if(c.o)if(1==m){d=c.m?c.m.length:0,c=Date.now()-c.F;var A=o.B;Ue(m=vs(),new sf(m,d)),Ds(o)}else Ff(o);else if(3==(A=c.s)||0==A&&0<c.X||!(1==m&&function hI(o,c){return!(mf(o.h)>=o.h.j-(o.s?1:0)||(o.s?(o.i=c.D.concat(o.i),0):1==o.G||2==o.G||o.B>=(o.Va?0:o.Wa)||(o.s=ni(_(o.Ga,o,c),Lf(o,o.B)),o.B++,0)))}(o,c)||2==m&&Mu(o)))switch(d&&0<d.length&&(c=o.h,c.i=c.i.concat(d)),A){case 1:_n(o,5);break;case 4:_n(o,10);break;case 3:_n(o,6);break;default:_n(o,2)}}function Lf(o,c){let d=o.Ta+Math.floor(Math.random()*o.cb);return o.isActive()||(d*=2),d*c}function _n(o,c){if(o.j.info("Error code "+c),2==c){var d=_(o.fb,o),m=o.Xa;const A=!m;m=new pn(m||"//www.google.com/images/cleardot.gif"),u.location&&"http"==u.location.protocol||Ps(m,"https"),Ss(m),A?function iI(o,c){const d=new ri;if(u.Image){const m=new Image;m.onload=R(Kt,d,"TestLoadImage: loaded",!0,c,m),m.onerror=R(Kt,d,"TestLoadImage: error",!1,c,m),m.onabort=R(Kt,d,"TestLoadImage: abort",!1,c,m),m.ontimeout=R(Kt,d,"TestLoadImage: timeout",!1,c,m),u.setTimeout(function(){m.ontimeout&&m.ontimeout()},1e4),m.src=o}else c(!1)}(m.toString(),d):function sI(o,c){new ri;const m=new AbortController,A=setTimeout(()=>{m.abort(),Kt(0,0,!1,c)},1e4);fetch(o,{signal:m.signal}).then(S=>{clearTimeout(A),Kt(0,0,!!S.ok,c)}).catch(()=>{clearTimeout(A),Kt(0,0,!1,c)})}(m.toString(),d)}else qe(2);o.G=0,o.l&&o.l.sa(c),Bf(o),Df(o)}function Bf(o){if(o.G=0,o.ka=[],o.l){const c=pf(o.h);(0!=c.length||0!=o.i.length)&&(D(o.ka,c),D(o.ka,o.i),o.h.i.length=0,k(o.i),o.i.length=0),o.l.ra()}}function Uf(o,c,d){var m=d instanceof pn?It(d):new pn(d);if(""!=m.g)c&&(m.g=c+"."+m.g),Vs(m,m.s);else{var A=u.location;m=A.protocol,c=c?c+"."+A.hostname:A.hostname,A=+A.port;var S=new pn(null);m&&Ps(S,m),c&&(S.g=c),A&&Vs(S,A),d&&(S.l=d),m=S}return c=o.ya,(d=o.D)&&c&&he(m,d,c),he(m,"VER",o.la),di(o,m),m}function qf(o,c,d){if(c&&!o.J)throw Error("Can't create secondary domain capable XhrIo object.");return(c=new _e(o.Ca&&!o.pa?new ui({eb:d}):o.pa)).Ha(o.J),c}function Gf(){}function ks(){}function We(o,c){Fe.call(this),this.g=new Cf(c),this.l=o,this.h=c&&c.messageUrlParams||null,o=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(o?o["X-WebChannel-Content-Type"]=c.messageContentType:o={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.va&&(o?o["X-WebChannel-Client-Profile"]=c.va:o={"X-WebChannel-Client-Profile":c.va}),this.g.S=o,(o=c&&c.Sb)&&!j(o)&&(this.g.m=o),this.v=c&&c.supportsCrossDomainXhr||!1,this.u=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!j(c)&&(this.g.D=c,null!==(o=this.h)&&c in o&&c in(o=this.h)&&delete o[c]),this.j=new ir(this)}function Kf(o){Ru.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var c=o.__sm__;if(c){e:{for(const d in c){o=d;break e}o=void 0}(this.i=o)&&(o=this.i,c=null!==c&&o in c?c[o]:void 0),this.data=c}else this.data=o}function jf(){Pu.call(this),this.status=1}function ir(o){this.g=o}(r=_e.prototype).Ha=function(o){this.J=o},r.ea=function(o,c,d,m){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);c=c?c.toUpperCase():"GET",this.D=o,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Vu.g(),this.v=function Zd(o){return o.h||(o.h=o.i())}(this.o?this.o:Vu),this.g.onreadystatechange=_(this.Ea,this);try{this.B=!0,this.g.open(c,String(o),!0),this.B=!1}catch(S){return void Pf(this,S)}if(o=d||"",d=new Map(this.headers),m)if(Object.getPrototypeOf(m)===Object.prototype)for(var A in m)d.set(A,m[A]);else{if("function"!=typeof m.keys||"function"!=typeof m.get)throw Error("Unknown input type for opt_headers: "+String(m));for(const S of m.keys())d.set(S,m.get(S))}m=Array.from(d.keys()).find(S=>"content-type"==S.toLowerCase()),A=u.FormData&&o instanceof u.FormData,!(0<=Array.prototype.indexOf.call(lI,c,void 0))||m||A||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[S,O]of d)this.g.setRequestHeader(S,O);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{bf(this),this.u=!0,this.g.send(o),this.u=!1}catch(S){Pf(this,S)}},r.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=o||7,Ue(this,"complete"),Ue(this,"abort"),xs(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),xs(this,!0)),_e.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?Sf(this):this.bb())},r.bb=function(){Sf(this)},r.isActive=function(){return!!this.g},r.Z=function(){try{return 2<Tt(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(o){if(this.g){var c=this.g.responseText;return o&&0==c.indexOf(o)&&(c=c.substring(o.length)),qy(c)}},r.Ba=function(){return this.m},r.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(r=Cf.prototype).la=8,r.G=1,r.connect=function(o,c,d,m){qe(0),this.W=o,this.H=c||{},d&&void 0!==m&&(this.H.OSID=d,this.H.OAID=m),this.F=this.X,this.I=Uf(this,null,this.W),Ds(this)},r.Ga=function(o){if(this.s)if(this.s=null,1==this.G){if(!o){this.U=Math.floor(1e5*Math.random()),o=this.U++;const A=new qt(this,this.j,o);let S=this.o;if(this.S&&(S?(S=p(S),E(S,this.S)):S=this.S),null!==this.m||this.O||(A.H=S,S=null),this.P)e:{for(var c=0,d=0;d<this.i.length;d++){var m=this.i[d];if(void 0===(m="__data__"in m.map&&"string"==typeof(m=m.map.__data__)?m.length:void 0))break;if(4096<(c+=m)){c=d;break e}if(4096===c||d===this.i.length-1){c=d+1;break e}}c=1e3}else c=1e3;c=kf(this,A,c),he(d=It(this.I),"RID",o),he(d,"CVER",22),this.D&&he(d,"X-HTTP-Session-Id",this.D),di(this,d),S&&(this.O?c="headers="+encodeURIComponent(String(Rf(S)))+"&"+c:this.m&&ku(d,this.m,S)),Nu(this.h,A),this.Ua&&he(d,"TYPE","init"),this.P?(he(d,"$req",c),he(d,"SID","null"),A.T=!0,bu(A,d,null)):bu(A,d,c),this.G=2}}else 3==this.G&&(o?Nf(this,o):0==this.i.length||ff(this.h)||Nf(this))},r.Fa=function(){if(this.u=null,Mf(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var o=2*this.R;this.j.info("BP detection timer enabled: "+o),this.A=ni(_(this.ab,this),o)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,qe(10),Cs(this),Mf(this))},r.Za=function(){null!=this.C&&(this.C=null,Cs(this),Mu(this),qe(19))},r.fb=function(o){o?(this.j.info("Successfully pinged google.com"),qe(2)):(this.j.info("Failed to ping google.com"),qe(1))},r.isActive=function(){return!!this.l&&this.l.isActive(this)},(r=Gf.prototype).ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){},ks.prototype.g=function(o,c){return new We(o,c)},x(We,Fe),We.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},We.prototype.close=function(){Fu(this.g)},We.prototype.o=function(o){var c=this.g;if("string"==typeof o){var d={};d.__data__=o,o=d}else this.u&&((d={}).__data__=Au(o),o=d);c.i.push(new Wy(c.Ya++,o)),3==c.G&&Ds(c)},We.prototype.N=function(){this.g.l=null,delete this.j,Fu(this.g),delete this.g,We.aa.N.call(this)},x(Kf,Ru),x(jf,Pu),x(ir,Gf),ir.prototype.ua=function(){Ue(this.g,"a")},ir.prototype.ta=function(o){Ue(this.g,new Kf(o))},ir.prototype.sa=function(o){Ue(this.g,new jf)},ir.prototype.ra=function(){Ue(this.g,"b")},ks.prototype.createWebChannel=ks.prototype.g,We.prototype.send=We.prototype.o,We.prototype.open=We.prototype.m,We.prototype.close=We.prototype.close,Ju=ut.createWebChannelTransport=function(){return new ks},Hu=ut.getStatEventTarget=function(){return vs()},Wu=ut.Event=mn,Us=ut.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},As.NO_ERROR=0,As.TIMEOUT=8,As.HTTP_ERROR=6,yi=ut.ErrorCode=As,of.COMPLETE="complete",$u=ut.EventType=of,ef.EventType=ei,ei.OPEN="a",ei.CLOSE="b",ei.ERROR="c",ei.MESSAGE="d",Fe.prototype.listen=Fe.prototype.K,or=ut.WebChannel=ef,ut.FetchXmlHttpFactory=ui,_e.prototype.listenOnce=_e.prototype.L,_e.prototype.getLastError=_e.prototype.Ka,_e.prototype.getLastErrorCode=_e.prototype.Ba,_e.prototype.getStatus=_e.prototype.Z,_e.prototype.getResponseJson=_e.prototype.Oa,_e.prototype.getResponseText=_e.prototype.oa,_e.prototype.send=_e.prototype.ea,_e.prototype.setWithCredentials=_e.prototype.Ha,Qu=ut.XhrIo=_e}).apply(typeof _i<"u"?_i:typeof self<"u"?self:typeof window<"u"?window:{});const Yu="@firebase/firestore";class ve{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}ve.UNAUTHENTICATED=new ve(null),ve.GOOGLE_CREDENTIALS=new ve("google-credentials-uid"),ve.FIRST_PARTY=new ve("first-party-uid"),ve.MOCK_USER=new ve("mock-user");let yn="10.14.0";const Et=new Ze.Vy("@firebase/firestore");function In(){return Et.logLevel}function N(r,...e){if(Et.logLevel<=Ze.$b.DEBUG){const t=e.map(qs);Et.debug(`Firestore (${yn}): ${r}`,...t)}}function ye(r,...e){if(Et.logLevel<=Ze.$b.ERROR){const t=e.map(qs);Et.error(`Firestore (${yn}): ${r}`,...t)}}function ze(r,...e){if(Et.logLevel<=Ze.$b.WARN){const t=e.map(qs);Et.warn(`Firestore (${yn}): ${r}`,...t)}}function qs(r){if("string"==typeof r)return r;try{return JSON.stringify(r)}catch{return r}}function B(r="Unexpected state"){const e=`FIRESTORE (${yn}) INTERNAL ASSERTION FAILED: `+r;throw ye(e),new Error(e)}function q(r,e){r||B()}function M(r,e){return r}const V={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class C extends ne.g{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Ae{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Xu{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class tm{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ve.UNAUTHENTICATED))}shutdown(){}}class nm{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class rm{constructor(e){this.t=e,this.currentUser=ve.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var n=this;q(void 0===this.o);let i=this.i;const s=h=>this.i!==i?(i=this.i,t(h)):Promise.resolve();let a=new Ae;this.o=()=>{this.i++,this.currentUser=this.u(),a.resolve(),a=new Ae,e.enqueueRetryable(()=>s(this.currentUser))};const u=()=>{const h=a;e.enqueueRetryable((0,b.A)(function*(){yield h.promise,yield s(n.currentUser)}))},l=h=>{N("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),u())};this.t.onInit(h=>l(h)),setTimeout(()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?l(h):(N("FirebaseAuthCredentialsProvider","Auth not yet detected"),a.resolve(),a=new Ae)}},0),u()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(N("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(q("string"==typeof n.accessToken),new Xu(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return q(null===e||"string"==typeof e),new ve(e)}}class im{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=ve.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class sm{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new im(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(ve.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Zu{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class om{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){q(void 0===this.o);const n=s=>{null!=s.error&&N("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const a=s.token!==this.R;return this.R=s.token,N("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>n(s))};const i=s=>{N("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.A.getImmediate({optional:!0});s?i(s):N("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(q("string"==typeof t.token),this.R=t.token,new Zu(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function am(r){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let n=0;n<r;n++)t[n]=Math.floor(256*Math.random());return t}class el{static newId(){const t=62*Math.floor(256/62);let n="";for(;n.length<20;){const i=am(40);for(let s=0;s<i.length;++s)n.length<20&&i[s]<t&&(n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(i[s]%62))}return n}}function Q(r,e){return r<e?-1:r>e?1:0}function Tn(r,e,t){return r.length===e.length&&r.every((n,i)=>t(n,e[i]))}function tl(r){return r+"\0"}class de{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new C(V.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new C(V.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new C(V.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new C(V.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return de.fromMillis(Date.now())}static fromDate(e){return de.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new de(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Q(this.nanoseconds,e.nanoseconds):Q(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class K{constructor(e){this.timestamp=e}static fromTimestamp(e){return new K(e)}static min(){return new K(new de(0,0))}static max(){return new K(new de(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class ar{constructor(e,t,n){void 0===t?t=0:t>e.length&&B(),void 0===n?n=e.length-t:n>e.length-t&&B(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===ar.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ar?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++){const s=e.get(i),a=t.get(i);if(s<a)return-1;if(s>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class J extends ar{construct(e,t,n){return new J(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new C(V.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(i=>i.length>0))}return new J(t)}static emptyPath(){return new J([])}}const um=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ue extends ar{construct(e,t,n){return new ue(e,t,n)}static isValidIdentifier(e){return um.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ue.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new ue(["__name__"])}static fromServerFormat(e){const t=[];let n="",i=0;const s=()=>{if(0===n.length)throw new C(V.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let a=!1;for(;i<e.length;){const u=e[i];if("\\"===u){if(i+1===e.length)throw new C(V.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[i+1];if("\\"!==l&&"."!==l&&"`"!==l)throw new C(V.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=l,i+=2}else"`"===u?(a=!a,i++):"."!==u||a?(n+=u,i++):(s(),i++)}if(s(),a)throw new C(V.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ue(t)}static emptyPath(){return new ue([])}}class L{constructor(e){this.path=e}static fromPath(e){return new L(J.fromString(e))}static fromName(e){return new L(J.fromString(e).popFirst(5))}static empty(){return new L(J.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===J.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return J.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new L(new J(e.slice()))}}class En{constructor(e,t,n,i){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=i}}function Gs(r){return r.fields.find(e=>2===e.kind)}function Qt(r){return r.fields.filter(e=>2!==e.kind)}En.UNKNOWN_ID=-1;class $t{constructor(e,t){this.fieldPath=e,this.kind=t}}class vn{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new vn(0,Qe.min())}}function nl(r,e){const t=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,i=K.fromTimestamp(1e9===n?new de(t+1,0):new de(t,n));return new Qe(i,L.empty(),e)}function rl(r){return new Qe(r.readTime,r.key,-1)}class Qe{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new Qe(K.min(),L.empty(),-1)}static max(){return new Qe(K.max(),L.empty(),-1)}}function Ks(r,e){let t=r.readTime.compareTo(e.readTime);return 0!==t?t:(t=L.comparator(r.documentKey,e.documentKey),0!==t?t:Q(r.largestBatchId,e.largestBatchId))}const il="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class sl{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function vt(r){return js.apply(this,arguments)}function js(){return(js=(0,b.A)(function*(r){if(r.code!==V.FAILED_PRECONDITION||r.message!==il)throw r;N("LocalStore","Unexpectedly lost primary lease")})).apply(this,arguments)}class w{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&B(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new w((n,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(n,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(n,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof w?t:w.resolve(t)}catch(t){return w.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):w.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):w.reject(t)}static resolve(e){return new w((t,n)=>{t(e)})}static reject(e){return new w((t,n)=>{n(e)})}static waitFor(e){return new w((t,n)=>{let i=0,s=0,a=!1;e.forEach(u=>{++i,u.next(()=>{++s,a&&s===i&&t()},l=>n(l))}),a=!0,s===i&&t()})}static or(e){let t=w.resolve(!1);for(const n of e)t=t.next(i=>i?w.resolve(i):n());return t}static forEach(e,t){const n=[];return e.forEach((i,s)=>{n.push(t.call(this,i,s))}),this.waitFor(n)}static mapArray(e,t){return new w((n,i)=>{const s=e.length,a=new Array(s);let u=0;for(let l=0;l<s;l++){const h=l;t(e[h]).next(f=>{a[h]=f,++u,u===s&&n(a)},f=>i(f))}})}static doWhile(e,t){return new w((n,i)=>{const s=()=>{!0===e()?t().next(()=>{s()},i):n()};s()})}}class Ii{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new Ae,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new ur(e,t.error)):this.V.resolve()},this.transaction.onerror=n=>{const i=zs(n.target.error);this.V.reject(new ur(e,i))}}static open(e,t,n,i){try{return new Ii(t,e.transaction(i,n))}catch(s){throw new ur(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(N("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new dm(t)}}class et{constructor(e,t,n){this.name=e,this.version=t,this.p=n,12.2===et.S((0,ne.ZQ)())&&ye("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return N("SimpleDb","Removing database:",e),Wt(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!(0,ne.zW)())return!1;if(et.v())return!0;const e=(0,ne.ZQ)(),t=et.S(e),n=0<t&&t<10,i=ol(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||s)}static v(){var e;return typeof process<"u"&&"YES"===(null===(e=process.__PRIVATE_env)||void 0===e?void 0:e.C)}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}M(e){var t=this;return(0,b.A)(function*(){return t.db||(N("SimpleDb","Opening database:",t.name),t.db=yield new Promise((n,i)=>{const s=indexedDB.open(t.name,t.version);s.onsuccess=a=>{n(a.target.result)},s.onblocked=()=>{i(new ur(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=a=>{const u=a.target.error;i("VersionError"===u.name?new C(V.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===u.name?new C(V.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+u):new ur(e,u))},s.onupgradeneeded=a=>{N("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',a.oldVersion),t.p.O(a.target.result,s.transaction,a.oldVersion,t.version).next(()=>{N("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.N&&(t.db.onversionchange=n=>t.N(n)),t.db})()}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,n,i){var s=this;return(0,b.A)(function*(){const a="readonly"===t;let u=0;for(;;){++u;try{s.db=yield s.M(e);const l=Ii.open(s.db,e,a?"readonly":"readwrite",n),h=i(l).next(f=>(l.g(),f)).catch(f=>(l.abort(f),w.reject(f))).toPromise();return h.catch(()=>{}),yield l.m,h}catch(l){const h=l,f="FirebaseError"!==h.name&&u<3;if(N("SimpleDb","Transaction failed with error:",h.message,"Retrying:",f),s.close(),!f)return Promise.reject(h)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}function ol(r){const e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class hm{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return Wt(this.B.delete())}}class ur extends C{constructor(e,t){super(V.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function At(r){return"IndexedDbTransactionError"===r.name}class dm{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(N("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(N("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),Wt(n)}add(e){return N("SimpleDb","ADD",this.store.name,e,e),Wt(this.store.add(e))}get(e){return Wt(this.store.get(e)).next(t=>(void 0===t&&(t=null),N("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return N("SimpleDb","DELETE",this.store.name,e),Wt(this.store.delete(e))}count(){return N("SimpleDb","COUNT",this.store.name),Wt(this.store.count())}U(e,t){const n=this.options(e,t),i=n.index?this.store.index(n.index):this.store;if("function"==typeof i.getAll){const s=i.getAll(n.range);return new w((a,u)=>{s.onerror=l=>{u(l.target.error)},s.onsuccess=l=>{a(l.target.result)}})}{const s=this.cursor(n),a=[];return this.W(s,(u,l)=>{a.push(l)}).next(()=>a)}}G(e,t){const n=this.store.getAll(e,null===t?void 0:t);return new w((i,s)=>{n.onerror=a=>{s(a.target.error)},n.onsuccess=a=>{i(a.target.result)}})}j(e,t){N("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.H=!1;const i=this.cursor(n);return this.W(i,(s,a,u)=>u.delete())}J(e,t){let n;t?n=e:(n={},t=e);const i=this.cursor(n);return this.W(i,t)}Y(e){const t=this.cursor({});return new w((n,i)=>{t.onerror=s=>{const a=zs(s.target.error);i(a)},t.onsuccess=s=>{const a=s.target.result;a?e(a.primaryKey,a.value).next(u=>{u?a.continue():n()}):n()}})}W(e,t){const n=[];return new w((i,s)=>{e.onerror=a=>{s(a.target.error)},e.onsuccess=a=>{const u=a.target.result;if(!u)return void i();const l=new hm(u),h=t(u.primaryKey,u.value,l);if(h instanceof w){const f=h.catch(g=>(l.done(),w.reject(g)));n.push(f)}l.isDone?i():null===l.K?u.continue():u.continue(l.K)}}).next(()=>w.waitFor(n))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.H?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Wt(r){return new w((e,t)=>{r.onsuccess=n=>{e(n.target.result)},r.onerror=n=>{const i=zs(n.target.error);t(i)}})}let al=!1;function zs(r){const e=et.S((0,ne.ZQ)());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(r.message.indexOf(t)>=0){const n=new C("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return al||(al=!0,setTimeout(()=>{throw n},0)),n}}return r}class fm{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}X(e){var t=this;N("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(0,b.A)(function*(){t.task=null;try{N("IndexBackfiller",`Documents written: ${yield t.Z.ee()}`)}catch(n){At(n)?N("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",n):yield vt(n)}yield t.X(6e4)}))}}class mm{constructor(e,t){this.localStore=e,this.persistence=t}ee(e=50){var t=this;return(0,b.A)(function*(){return t.persistence.runTransaction("Backfill Indexes","readwrite-primary",n=>t.te(n,e))})()}te(e,t){const n=new Set;let i=t,s=!0;return w.doWhile(()=>!0===s&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(a=>{if(null!==a&&!n.has(a))return N("IndexBackfiller",`Processing collection: ${a}`),this.ne(e,a,i).next(u=>{i-=u,n.add(a)});s=!1})).next(()=>t-i)}ne(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,n).next(s=>{const a=s.changes;return this.localStore.indexManager.updateIndexEntries(e,a).next(()=>this.re(i,s)).next(u=>(N("IndexBackfiller",`Updating offset: ${u}`),this.localStore.indexManager.updateCollectionGroup(e,t,u))).next(()=>a.size)}))}re(e,t){let n=e;return t.changes.forEach((i,s)=>{const a=rl(s);Ks(a,n)>0&&(n=a)}),new Qe(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}let $e=(()=>{class r{constructor(t,n){this.previousValue=t,n&&(n.sequenceNumberHandler=i=>this.ie(i),this.se=i=>n.writeSequenceNumber(i))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.se&&this.se(t),t}}return r.oe=-1,r})();function lr(r){return null==r}function cr(r){return 0===r&&1/r==-1/0}function ul(r){return"number"==typeof r&&Number.isInteger(r)&&!cr(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}function xe(r){let e="";for(let t=0;t<r.length;t++)e.length>0&&(e=ll(e)),e=gm(r.get(t),e);return ll(e)}function gm(r,e){let t=e;const n=r.length;for(let i=0;i<n;i++){const s=r.charAt(i);switch(s){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=s}}return t}function ll(r){return r+"\x01\x01"}function tt(r){const e=r.length;if(q(e>=2),2===e)return q("\x01"===r.charAt(0)&&"\x01"===r.charAt(1)),J.emptyPath();const t=e-2,n=[];let i="";for(let s=0;s<e;){const a=r.indexOf("\x01",s);switch((a<0||a>t)&&B(),r.charAt(a+1)){case"\x01":const u=r.substring(s,a);let l;0===i.length?l=u:(i+=u,l=i,i=""),n.push(l);break;case"\x10":i+=r.substring(s,a),i+="\0";break;case"\x11":i+=r.substring(s,a+1);break;default:B()}s=a+2}return new J(n)}const cl=["userId","batchId"];function Ti(r,e){return[r,xe(e)]}function hl(r,e,t){return[r,xe(e),t]}const pm={},_m=["prefixPath","collectionGroup","readTime","documentId"],ym=["prefixPath","collectionGroup","documentId"],Im=["collectionGroup","readTime","prefixPath","documentId"],Tm=["canonicalId","targetId"],Em=["targetId","path"],vm=["path","targetId"],Am=["collectionId","parent"],wm=["indexId","uid"],Rm=["uid","sequenceNumber"],Pm=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Vm=["indexId","uid","orderedDocumentKey"],Sm=["userId","collectionPath","documentId"],bm=["userId","collectionPath","largestBatchId"],xm=["userId","collectionGroup","largestBatchId"],dl=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Cm=[...dl,"documentOverlays"],fl=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],ml=fl,Qs=[...ml,"indexConfiguration","indexState","indexEntries"],Dm=Qs,Nm=[...Qs,"globals"];class $s extends sl{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function Ee(r,e){const t=M(r);return et.F(t._e,e)}function gl(r){let e=0;for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function wt(r,e){for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function _l(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}class ae{constructor(e,t){this.comparator=e,this.root=t||Re.EMPTY}insert(e,t){return new ae(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Re.BLACK,null,null))}remove(e){return new ae(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Re.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(e,n.key);if(0===i)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ei(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ei(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ei(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ei(this.root,e,this.comparator,!0)}}class Ei{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Re{constructor(e,t,n,i,s){this.key=e,this.value=t,this.color=null!=n?n:Re.RED,this.left=null!=i?i:Re.EMPTY,this.right=null!=s?s:Re.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,s){return new Re(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const s=n(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Re.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return Re.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Re.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Re.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw B();const e=this.left.check();if(e!==this.right.check())throw B();return e+(this.isRed()?0:1)}}Re.EMPTY=null,Re.RED=!0,Re.BLACK=!1,Re.EMPTY=new class{constructor(){this.size=0}get key(){throw B()}get value(){throw B()}get color(){throw B()}get left(){throw B()}get right(){throw B()}copy(e,t,n,i,s){return this}insert(e,t,n){return new Re(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ie{constructor(e){this.comparator=e,this.data=new ae(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new yl(this.data.getIterator())}getIteratorFrom(e){return new yl(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof ie)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=n.getNext().key;if(0!==this.comparator(i,s))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new ie(this.comparator);return t.data=e,t}}class yl{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function An(r){return r.hasNext()?r.getNext():void 0}class Ge{constructor(e){this.fields=e,e.sort(ue.comparator)}static empty(){return new Ge([])}unionWith(e){let t=new ie(ue.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new Ge(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Tn(this.fields,e.fields,(t,n)=>t.isEqual(n))}}class Il extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class pe{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Il("Invalid base64 string: "+s):s}}(e);return new pe(t)}static fromUint8Array(e){const t=function(i){let s="";for(let a=0;a<i.length;++a)s+=String.fromCharCode(i[a]);return s}(e);return new pe(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(t){const n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Q(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}pe.EMPTY_BYTE_STRING=new pe("");const Fm=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function lt(r){if(q(!!r),"string"==typeof r){let e=0;const t=Fm.exec(r);if(q(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:fe(r.seconds),nanos:fe(r.nanos)}}function fe(r){return"number"==typeof r?r:"string"==typeof r?Number(r):0}function ct(r){return"string"==typeof r?pe.fromBase64String(r):pe.fromUint8Array(r)}function vi(r){var e,t;return"server_timestamp"===(null===(t=((null===(e=null==r?void 0:r.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function Ai(r){const e=r.mapValue.fields.__previous_value__;return vi(e)?Ai(e):e}function hr(r){const e=lt(r.mapValue.fields.__local_write_time__.timestampValue);return new de(e.seconds,e.nanos)}class Mm{constructor(e,t,n,i,s,a,u,l,h){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=l,this.useFetchStreams=h}}class Rt{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Rt("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Rt&&e.projectId===this.projectId&&e.database===this.database}}const Pt={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},wi={nullValue:"NULL_VALUE"};function Vt(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?vi(r)?4:wl(r)?9007199254740991:Vi(r)?10:11:B()}function nt(r,e){if(r===e)return!0;const t=Vt(r);if(t!==Vt(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return hr(r).isEqual(hr(e));case 3:return function(i,s){if("string"==typeof i.timestampValue&&"string"==typeof s.timestampValue&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const a=lt(i.timestampValue),u=lt(s.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos}(r,e);case 5:return r.stringValue===e.stringValue;case 6:return s=e,ct(r.bytesValue).isEqual(ct(s.bytesValue));case 7:return r.referenceValue===e.referenceValue;case 8:return function(i,s){return fe(i.geoPointValue.latitude)===fe(s.geoPointValue.latitude)&&fe(i.geoPointValue.longitude)===fe(s.geoPointValue.longitude)}(r,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return fe(i.integerValue)===fe(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const a=fe(i.doubleValue),u=fe(s.doubleValue);return a===u?cr(a)===cr(u):isNaN(a)&&isNaN(u)}return!1}(r,e);case 9:return Tn(r.arrayValue.values||[],e.arrayValue.values||[],nt);case 10:case 11:return function(i,s){const a=i.mapValue.fields||{},u=s.mapValue.fields||{};if(gl(a)!==gl(u))return!1;for(const l in a)if(a.hasOwnProperty(l)&&(void 0===u[l]||!nt(a[l],u[l])))return!1;return!0}(r,e);default:return B()}var s}function dr(r,e){return void 0!==(r.values||[]).find(t=>nt(t,e))}function St(r,e){if(r===e)return 0;const t=Vt(r),n=Vt(e);if(t!==n)return Q(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return Q(r.booleanValue,e.booleanValue);case 2:return function(s,a){const u=fe(s.integerValue||s.doubleValue),l=fe(a.integerValue||a.doubleValue);return u<l?-1:u>l?1:u===l?0:isNaN(u)?isNaN(l)?0:-1:1}(r,e);case 3:return Tl(r.timestampValue,e.timestampValue);case 4:return Tl(hr(r),hr(e));case 5:return Q(r.stringValue,e.stringValue);case 6:return function(s,a){const u=ct(s),l=ct(a);return u.compareTo(l)}(r.bytesValue,e.bytesValue);case 7:return function(s,a){const u=s.split("/"),l=a.split("/");for(let h=0;h<u.length&&h<l.length;h++){const f=Q(u[h],l[h]);if(0!==f)return f}return Q(u.length,l.length)}(r.referenceValue,e.referenceValue);case 8:return function(s,a){const u=Q(fe(s.latitude),fe(a.latitude));return 0!==u?u:Q(fe(s.longitude),fe(a.longitude))}(r.geoPointValue,e.geoPointValue);case 9:return El(r.arrayValue,e.arrayValue);case 10:return function(s,a){var u,l,h,f;const R=null===(u=(s.fields||{}).value)||void 0===u?void 0:u.arrayValue,x=null===(l=(a.fields||{}).value)||void 0===l?void 0:l.arrayValue,k=Q((null===(h=null==R?void 0:R.values)||void 0===h?void 0:h.length)||0,(null===(f=null==x?void 0:x.values)||void 0===f?void 0:f.length)||0);return 0!==k?k:El(R,x)}(r.mapValue,e.mapValue);case 11:return function(s,a){if(s===Pt.mapValue&&a===Pt.mapValue)return 0;if(s===Pt.mapValue)return 1;if(a===Pt.mapValue)return-1;const u=s.fields||{},l=Object.keys(u),h=a.fields||{},f=Object.keys(h);l.sort(),f.sort();for(let g=0;g<l.length&&g<f.length;++g){const _=Q(l[g],f[g]);if(0!==_)return _;const R=St(u[l[g]],h[f[g]]);if(0!==R)return R}return Q(l.length,f.length)}(r.mapValue,e.mapValue);default:throw B()}}function Tl(r,e){if("string"==typeof r&&"string"==typeof e&&r.length===e.length)return Q(r,e);const t=lt(r),n=lt(e),i=Q(t.seconds,n.seconds);return 0!==i?i:Q(t.nanos,n.nanos)}function El(r,e){const t=r.values||[],n=e.values||[];for(let i=0;i<t.length&&i<n.length;++i){const s=St(t[i],n[i]);if(s)return s}return Q(t.length,n.length)}function wn(r){return Ws(r)}function Ws(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(t){const n=lt(t);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?ct(r.bytesValue).toBase64():"referenceValue"in r?L.fromName(r.referenceValue).toString():"geoPointValue"in r?function(t){return`geo(${t.latitude},${t.longitude})`}(r.geoPointValue):"arrayValue"in r?function(t){let n="[",i=!0;for(const s of t.values||[])i?i=!1:n+=",",n+=Ws(s);return n+"]"}(r.arrayValue):"mapValue"in r?function(t){const n=Object.keys(t.fields||{}).sort();let i="{",s=!0;for(const a of n)s?s=!1:i+=",",i+=`${a}:${Ws(t.fields[a])}`;return i+"}"}(r.mapValue):B()}function Ht(r,e){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${e.path.canonicalString()}`}}function Hs(r){return!!r&&"integerValue"in r}function fr(r){return!!r&&"arrayValue"in r}function vl(r){return!!r&&"nullValue"in r}function Al(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function Pi(r){return!!r&&"mapValue"in r}function Vi(r){var e,t;return"__vector__"===(null===(t=((null===(e=null==r?void 0:r.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function mr(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&"object"==typeof r.timestampValue)return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){const e={mapValue:{fields:{}}};return wt(r.mapValue.fields,(t,n)=>e.mapValue.fields[t]=mr(n)),e}if(r.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=mr(r.arrayValue.values[t]);return e}return Object.assign({},r)}function wl(r){return"__max__"===(((r.mapValue||{}).fields||{}).__type__||{}).stringValue}const Rl={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function Om(r){return"nullValue"in r?wi:"booleanValue"in r?{booleanValue:!1}:"integerValue"in r||"doubleValue"in r?{doubleValue:NaN}:"timestampValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in r?{stringValue:""}:"bytesValue"in r?{bytesValue:""}:"referenceValue"in r?Ht(Rt.empty(),L.empty()):"geoPointValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in r?{arrayValue:{}}:"mapValue"in r?Vi(r)?Rl:{mapValue:{}}:B()}function Lm(r){return"nullValue"in r?{booleanValue:!1}:"booleanValue"in r?{doubleValue:NaN}:"integerValue"in r||"doubleValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in r?{stringValue:""}:"stringValue"in r?{bytesValue:""}:"bytesValue"in r?Ht(Rt.empty(),L.empty()):"referenceValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in r?{arrayValue:{}}:"arrayValue"in r?Rl:"mapValue"in r?Vi(r)?{mapValue:{}}:Pt:B()}function Pl(r,e){const t=St(r.value,e.value);return 0!==t?t:r.inclusive&&!e.inclusive?-1:!r.inclusive&&e.inclusive?1:0}function Vl(r,e){const t=St(r.value,e.value);return 0!==t?t:r.inclusive&&!e.inclusive?1:!r.inclusive&&e.inclusive?-1:0}class Pe{constructor(e){this.value=e}static empty(){return new Pe({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Pi(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=mr(t)}setAll(e){let t=ue.emptyPath(),n={},i=[];e.forEach((a,u)=>{if(!t.isImmediateParentOf(u)){const l=this.getFieldsMap(t);this.applyChanges(l,n,i),n={},i=[],t=u.popLast()}a?n[u.lastSegment()]=mr(a):i.push(u.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,n,i)}delete(e){const t=this.field(e.popLast());Pi(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return nt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];Pi(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){wt(t,(i,s)=>e[i]=s);for(const i of n)delete e[i]}clone(){return new Pe(mr(this.value))}}function Sl(r){const e=[];return wt(r.fields,(t,n)=>{const i=new ue([t]);if(Pi(n)){const s=Sl(n.mapValue).fields;if(0===s.length)e.push(i);else for(const a of s)e.push(i.child(a))}else e.push(i)}),new Ge(e)}class le{constructor(e,t,n,i,s,a,u){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=s,this.data=a,this.documentState=u}static newInvalidDocument(e){return new le(e,0,K.min(),K.min(),K.min(),Pe.empty(),0)}static newFoundDocument(e,t,n,i){return new le(e,1,t,K.min(),n,i,0)}static newNoDocument(e,t){return new le(e,2,t,K.min(),K.min(),Pe.empty(),0)}static newUnknownDocument(e,t){return new le(e,3,t,K.min(),K.min(),Pe.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(K.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Pe.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Pe.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=K.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof le&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new le(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class bt{constructor(e,t){this.position=e,this.inclusive=t}}function bl(r,e,t){let n=0;for(let i=0;i<r.position.length;i++){const s=e[i],a=r.position[i];if(n=s.field.isKeyField()?L.comparator(L.fromName(a.referenceValue),t.key):St(a,t.data.field(s.field)),"desc"===s.dir&&(n*=-1),0!==n)break}return n}function xl(r,e){if(null===r)return null===e;if(null===e||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!nt(r.position[t],e.position[t]))return!1;return!0}class gr{constructor(e,t="asc"){this.field=e,this.dir=t}}function Bm(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}class Cl{}class Y extends Cl{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new Um(e,t,n):"array-contains"===t?new Km(e,n):"in"===t?new Ol(e,n):"not-in"===t?new jm(e,n):"array-contains-any"===t?new zm(e,n):new Y(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new qm(e,n):new Gm(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(St(t,this.value)):null!==t&&Vt(this.value)===Vt(t)&&this.matchesComparison(St(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return B()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class re extends Cl{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new re(e,t)}matches(e){return Rn(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Rn(r){return"and"===r.op}function Js(r){return"or"===r.op}function Ys(r){return Dl(r)&&Rn(r)}function Dl(r){for(const e of r.filters)if(e instanceof re)return!1;return!0}function Xs(r){if(r instanceof Y)return r.field.canonicalString()+r.op.toString()+wn(r.value);if(Ys(r))return r.filters.map(e=>Xs(e)).join(",");{const e=r.filters.map(t=>Xs(t)).join(",");return`${r.op}(${e})`}}function Nl(r,e){return r instanceof Y?(n=r,(i=e)instanceof Y&&n.op===i.op&&n.field.isEqual(i.field)&&nt(n.value,i.value)):r instanceof re?function(n,i){return i instanceof re&&n.op===i.op&&n.filters.length===i.filters.length&&n.filters.reduce((s,a,u)=>s&&Nl(a,i.filters[u]),!0)}(r,e):void B();var n,i}function kl(r,e){const t=r.filters.concat(e);return re.create(t,r.op)}function Fl(r){return r instanceof Y?`${(t=r).field.canonicalString()} ${t.op} ${wn(t.value)}`:r instanceof re?function(t){return t.op.toString()+" {"+t.getFilters().map(Fl).join(" ,")+"}"}(r):"Filter";var t}class Um extends Y{constructor(e,t,n){super(e,t,n),this.key=L.fromName(n.referenceValue)}matches(e){const t=L.comparator(e.key,this.key);return this.matchesComparison(t)}}class qm extends Y{constructor(e,t){super(e,"in",t),this.keys=Ml(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Gm extends Y{constructor(e,t){super(e,"not-in",t),this.keys=Ml(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Ml(r,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(n=>L.fromName(n.referenceValue))}class Km extends Y{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return fr(t)&&dr(t.arrayValue,this.value)}}class Ol extends Y{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&dr(this.value.arrayValue,t)}}class jm extends Y{constructor(e,t){super(e,"not-in",t)}matches(e){if(dr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!dr(this.value.arrayValue,t)}}class zm extends Y{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!fr(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>dr(this.value.arrayValue,n))}}class Qm{constructor(e,t=null,n=[],i=[],s=null,a=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=a,this.endAt=u,this.ue=null}}function Zs(r,e=null,t=[],n=[],i=null,s=null,a=null){return new Qm(r,e,t,n,i,s,a)}function Jt(r){const e=M(r);if(null===e.ue){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>Xs(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>{return(s=n).field.canonicalString()+s.dir;var s}).join(","),lr(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>wn(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>wn(n)).join(",")),e.ue=t}return e.ue}function pr(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!Bm(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!Nl(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!xl(r.startAt,e.startAt)&&xl(r.endAt,e.endAt)}function Si(r){return L.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length}function bi(r,e){return r.filters.filter(t=>t instanceof Y&&t.field.isEqual(e))}function Ll(r,e,t){let n=wi,i=!0;for(const s of bi(r,e)){let a=wi,u=!0;switch(s.op){case"<":case"<=":a=Om(s.value);break;case"==":case"in":case">=":a=s.value;break;case">":a=s.value,u=!1;break;case"!=":case"not-in":a=wi}Pl({value:n,inclusive:i},{value:a,inclusive:u})<0&&(n=a,i=u)}if(null!==t)for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(e)){const a=t.position[s];Pl({value:n,inclusive:i},{value:a,inclusive:t.inclusive})<0&&(n=a,i=t.inclusive);break}return{value:n,inclusive:i}}function Bl(r,e,t){let n=Pt,i=!0;for(const s of bi(r,e)){let a=Pt,u=!0;switch(s.op){case">=":case">":a=Lm(s.value),u=!1;break;case"==":case"in":case"<=":a=s.value;break;case"<":a=s.value,u=!1;break;case"!=":case"not-in":a=Pt}Vl({value:n,inclusive:i},{value:a,inclusive:u})>0&&(n=a,i=u)}if(null!==t)for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(e)){const a=t.position[s];Vl({value:n,inclusive:i},{value:a,inclusive:t.inclusive})>0&&(n=a,i=t.inclusive);break}return{value:n,inclusive:i}}class ht{constructor(e,t=null,n=[],i=[],s=null,a="F",u=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=a,this.startAt=u,this.endAt=l,this.ce=null,this.le=null,this.he=null}}function Ul(r,e,t,n,i,s,a,u){return new ht(r,e,t,n,i,s,a,u)}function Pn(r){return new ht(r)}function ql(r){return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.explicitOrderBy.length||1===r.explicitOrderBy.length&&r.explicitOrderBy[0].field.isKeyField())}function eo(r){return null!==r.collectionGroup}function Vn(r){const e=M(r);if(null===e.ce){e.ce=[];const t=new Set;for(const s of e.explicitOrderBy)e.ce.push(s),t.add(s.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new ie(ue.comparator);return a.filters.forEach(l=>{l.getFlattenedFilters().forEach(h=>{h.isInequality()&&(u=u.add(h.field))})}),u})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new gr(s,n))}),t.has(ue.keyField().canonicalString())||e.ce.push(new gr(ue.keyField(),n))}return e.ce}function Ce(r){const e=M(r);return e.le||(e.le=function Kl(r,e){if("F"===r.limitType)return Zs(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map(i=>new gr(i.field,"desc"===i.dir?"asc":"desc"));const t=r.endAt?new bt(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new bt(r.startAt.position,r.startAt.inclusive):null;return Zs(r.path,r.collectionGroup,e,r.filters,r.limit,t,n)}}(e,Vn(r))),e.le}function to(r,e){const t=r.filters.concat([e]);return new ht(r.path,r.collectionGroup,r.explicitOrderBy.slice(),t,r.limit,r.limitType,r.startAt,r.endAt)}function xi(r,e,t){return new ht(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function _r(r,e){return pr(Ce(r),Ce(e))&&r.limitType===e.limitType}function jl(r){return`${Jt(Ce(r))}|lt:${r.limitType}`}function Sn(r){return`Query(target=${function(t){let n=t.path.canonicalString();return null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(i=>Fl(i)).join(", ")}]`),lr(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(i=>{return`${(a=i).field.canonicalString()} (${a.dir})`;var a}).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(i=>wn(i)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(i=>wn(i)).join(",")),`Target(${n})`}(Ce(r))}; limitType=${r.limitType})`}function yr(r,e){return e.isFoundDocument()&&function(n,i){const s=i.key.path;return null!==n.collectionGroup?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(s):L.isDocumentKey(n.path)?n.path.isEqual(s):n.path.isImmediateParentOf(s)}(r,e)&&function(n,i){for(const s of Vn(n))if(!s.field.isKeyField()&&null===i.data.field(s.field))return!1;return!0}(r,e)&&function(n,i){for(const s of n.filters)if(!s.matches(i))return!1;return!0}(r,e)&&(i=e,!((n=r).startAt&&!function(a,u,l){const h=bl(a,u,l);return a.inclusive?h<=0:h<0}(n.startAt,Vn(n),i)||n.endAt&&!function(a,u,l){const h=bl(a,u,l);return a.inclusive?h>=0:h>0}(n.endAt,Vn(n),i)));var n,i}function zl(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function Ql(r){return(e,t)=>{let n=!1;for(const i of Vn(r)){const s=$m(i,e,t);if(0!==s)return s;n=n||i.field.isKeyField()}return 0}}function $m(r,e,t){const n=r.field.isKeyField()?L.comparator(e.key,t.key):function(s,a,u){const l=a.data.field(s),h=u.data.field(s);return null!==l&&null!==h?St(l,h):B()}(r.field,e,t);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return B()}}class dt{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[i,s]of n)if(this.equalsFn(i,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),i=this.inner[n];if(void 0===i)return this.inner[n]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return 1===n.length?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){wt(this.inner,(t,n)=>{for(const[i,s]of n)e(i,s)})}isEmpty(){return _l(this.inner)}size(){return this.innerSize}}const Wm=new ae(L.comparator);function Ke(){return Wm}const $l=new ae(L.comparator);function Ir(...r){let e=$l;for(const t of r)e=e.insert(t.key,t);return e}function Wl(r){let e=$l;return r.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function rt(){return Tr()}function Hl(){return Tr()}function Tr(){return new dt(r=>r.toString(),(r,e)=>r.isEqual(e))}const Hm=new ae(L.comparator),Jm=new ie(L.comparator);function W(...r){let e=Jm;for(const t of r)e=e.add(t);return e}const Ym=new ie(Q);function no(){return Ym}function ro(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:cr(e)?"-0":e}}function Jl(r){return{integerValue:""+r}}function Yl(r,e){return ul(e)?Jl(e):ro(r,e)}class Ci{constructor(){this._=void 0}}function Xm(r,e,t){return r instanceof bn?function(i,s){const a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&vi(s)&&(s=Ai(s)),s&&(a.fields.__previous_value__=s),{mapValue:a}}(t,e):r instanceof Yt?Zl(r,e):r instanceof Xt?ec(r,e):function(i,s){const a=Xl(i,s),u=tc(a)+tc(i.Pe);return Hs(a)&&Hs(i.Pe)?Jl(u):ro(i.serializer,u)}(r,e)}function Zm(r,e,t){return r instanceof Yt?Zl(r,e):r instanceof Xt?ec(r,e):t}function Xl(r,e){return r instanceof xn?Hs(n=e)||(s=n)&&"doubleValue"in s?e:{integerValue:0}:null;var n,s}class bn extends Ci{}class Yt extends Ci{constructor(e){super(),this.elements=e}}function Zl(r,e){const t=nc(e);for(const n of r.elements)t.some(i=>nt(i,n))||t.push(n);return{arrayValue:{values:t}}}class Xt extends Ci{constructor(e){super(),this.elements=e}}function ec(r,e){let t=nc(e);for(const n of r.elements)t=t.filter(i=>!nt(i,n));return{arrayValue:{values:t}}}class xn extends Ci{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function tc(r){return fe(r.integerValue||r.doubleValue)}function nc(r){return fr(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}class Er{constructor(e,t){this.field=e,this.transform=t}}class tg{constructor(e,t){this.version=e,this.transformResults=t}}class me{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new me}static exists(e){return new me(void 0,e)}static updateTime(e){return new me(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Di(r,e){return void 0!==r.updateTime?e.isFoundDocument()&&e.version.isEqual(r.updateTime):void 0===r.exists||r.exists===e.isFoundDocument()}class Ni{}function rc(r,e){if(!r.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return r.isNoDocument()?new Dn(r.key,me.none()):new Cn(r.key,r.data,me.none());{const t=r.data,n=Pe.empty();let i=new ie(ue.comparator);for(let s of e.fields)if(!i.has(s)){let a=t.field(s);null===a&&s.length>1&&(s=s.popLast(),a=t.field(s)),null===a?n.delete(s):n.set(s,a),i=i.add(s)}return new ft(r.key,n,new Ge(i.toArray()),me.none())}}function ng(r,e,t){r instanceof Cn?function(i,s,a){const u=i.value.clone(),l=oc(i.fieldTransforms,s,a.transformResults);u.setAll(l),s.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(r,e,t):r instanceof ft?function(i,s,a){if(!Di(i.precondition,s))return void s.convertToUnknownDocument(a.version);const u=oc(i.fieldTransforms,s,a.transformResults),l=s.data;l.setAll(sc(i)),l.setAll(u),s.convertToFoundDocument(a.version,l).setHasCommittedMutations()}(r,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function vr(r,e,t,n){return r instanceof Cn?function(s,a,u,l){if(!Di(s.precondition,a))return u;const h=s.value.clone(),f=ac(s.fieldTransforms,l,a);return h.setAll(f),a.convertToFoundDocument(a.version,h).setHasLocalMutations(),null}(r,e,t,n):r instanceof ft?function(s,a,u,l){if(!Di(s.precondition,a))return u;const h=ac(s.fieldTransforms,l,a),f=a.data;return f.setAll(sc(s)),f.setAll(h),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),null===u?null:u.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(g=>g.field))}(r,e,t,n):(u=t,Di(r.precondition,a=e)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u);var a,u}function rg(r,e){let t=null;for(const n of r.fieldTransforms){const i=e.data.field(n.field),s=Xl(n.transform,i||null);null!=s&&(null===t&&(t=Pe.empty()),t.set(n.field,s))}return t||null}function ic(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&(i=e.fieldTransforms,!!(void 0===(n=r.fieldTransforms)&&void 0===i||n&&i&&Tn(n,i,(s,a)=>function eg(r,e){return r.field.isEqual(e.field)&&(i=e.transform,(n=r.transform)instanceof Yt&&i instanceof Yt||n instanceof Xt&&i instanceof Xt?Tn(n.elements,i.elements,nt):n instanceof xn&&i instanceof xn?nt(n.Pe,i.Pe):n instanceof bn&&i instanceof bn);var n,i}(s,a))))&&(0===r.type?r.value.isEqual(e.value):1!==r.type||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask));var n,i}class Cn extends Ni{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class ft extends Ni{constructor(e,t,n,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function sc(r){const e=new Map;return r.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const n=r.data.field(t);e.set(t,n)}}),e}function oc(r,e,t){const n=new Map;q(r.length===t.length);for(let i=0;i<t.length;i++){const s=r[i],a=s.transform,u=e.data.field(s.field);n.set(s.field,Zm(a,u,t[i]))}return n}function ac(r,e,t){const n=new Map;for(const i of r){const s=i.transform,a=t.data.field(i.field);n.set(i.field,Xm(s,a,e))}return n}class Dn extends Ni{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class io extends Ni{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class so{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&ng(s,e,n[i])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=vr(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=vr(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Hl();return this.mutations.forEach(i=>{const s=e.get(i.key),a=s.overlayedDocument;let u=this.applyToLocalView(a,s.mutatedFields);u=t.has(i.key)?null:u;const l=rc(a,u);null!==l&&n.set(i.key,l),a.isValidDocument()||a.convertToNoDocument(K.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),W())}isEqual(e){return this.batchId===e.batchId&&Tn(this.mutations,e.mutations,(t,n)=>ic(t,n))&&Tn(this.baseMutations,e.baseMutations,(t,n)=>ic(t,n))}}class oo{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){q(e.mutations.length===n.length);let i=function(){return Hm}();const s=e.mutations;for(let a=0;a<s.length;a++)i=i.insert(s[a].key,n[a].version);return new oo(e,t,n,i)}}class ao{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class ig{constructor(e,t){this.count=e,this.unchangedNames=t}}var Te,Z;function lc(r){switch(r){default:return B();case V.CANCELLED:case V.UNKNOWN:case V.DEADLINE_EXCEEDED:case V.RESOURCE_EXHAUSTED:case V.INTERNAL:case V.UNAVAILABLE:case V.UNAUTHENTICATED:return!1;case V.INVALID_ARGUMENT:case V.NOT_FOUND:case V.ALREADY_EXISTS:case V.PERMISSION_DENIED:case V.FAILED_PRECONDITION:case V.ABORTED:case V.OUT_OF_RANGE:case V.UNIMPLEMENTED:case V.DATA_LOSS:return!0}}function cc(r){if(void 0===r)return ye("GRPC error has no .code"),V.UNKNOWN;switch(r){case Te.OK:return V.OK;case Te.CANCELLED:return V.CANCELLED;case Te.UNKNOWN:return V.UNKNOWN;case Te.DEADLINE_EXCEEDED:return V.DEADLINE_EXCEEDED;case Te.RESOURCE_EXHAUSTED:return V.RESOURCE_EXHAUSTED;case Te.INTERNAL:return V.INTERNAL;case Te.UNAVAILABLE:return V.UNAVAILABLE;case Te.UNAUTHENTICATED:return V.UNAUTHENTICATED;case Te.INVALID_ARGUMENT:return V.INVALID_ARGUMENT;case Te.NOT_FOUND:return V.NOT_FOUND;case Te.ALREADY_EXISTS:return V.ALREADY_EXISTS;case Te.PERMISSION_DENIED:return V.PERMISSION_DENIED;case Te.FAILED_PRECONDITION:return V.FAILED_PRECONDITION;case Te.ABORTED:return V.ABORTED;case Te.OUT_OF_RANGE:return V.OUT_OF_RANGE;case Te.UNIMPLEMENTED:return V.UNIMPLEMENTED;case Te.DATA_LOSS:return V.DATA_LOSS;default:return B()}}(Z=Te||(Te={}))[Z.OK=0]="OK",Z[Z.CANCELLED=1]="CANCELLED",Z[Z.UNKNOWN=2]="UNKNOWN",Z[Z.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Z[Z.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Z[Z.NOT_FOUND=5]="NOT_FOUND",Z[Z.ALREADY_EXISTS=6]="ALREADY_EXISTS",Z[Z.PERMISSION_DENIED=7]="PERMISSION_DENIED",Z[Z.UNAUTHENTICATED=16]="UNAUTHENTICATED",Z[Z.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Z[Z.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Z[Z.ABORTED=10]="ABORTED",Z[Z.OUT_OF_RANGE=11]="OUT_OF_RANGE",Z[Z.UNIMPLEMENTED=12]="UNIMPLEMENTED",Z[Z.INTERNAL=13]="INTERNAL",Z[Z.UNAVAILABLE=14]="UNAVAILABLE",Z[Z.DATA_LOSS=15]="DATA_LOSS";function hc(){return new TextEncoder}const sg=new zt([4294967295,4294967295],0);function dc(r){const e=hc().encode(r),t=new zu;return t.update(e),new Uint8Array(t.digest())}function fc(r){const e=new DataView(r.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new zt([t,n],0),new zt([i,s],0)]}class uo{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Ar(`Invalid padding: ${t}`);if(n<0)throw new Ar(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new Ar(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new Ar(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=zt.fromNumber(this.Ie)}Ee(e,t,n){let i=e.add(t.multiply(zt.fromNumber(n)));return 1===i.compare(sg)&&(i=new zt([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Ie)return!1;const t=dc(e),[n,i]=fc(t);for(let s=0;s<this.hashCount;s++){const a=this.Ee(n,i,s);if(!this.de(a))return!1}return!0}static create(e,t,n){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),a=new uo(s,i,t);return n.forEach(u=>a.insert(u)),a}insert(e){if(0===this.Ie)return;const t=dc(e),[n,i]=fc(t);for(let s=0;s<this.hashCount;s++){const a=this.Ee(n,i,s);this.Ae(a)}}Ae(e){const t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class Ar extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class wr{constructor(e,t,n,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const i=new Map;return i.set(e,Rr.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new wr(K.min(),i,new ae(Q),Ke(),W())}}class Rr{constructor(e,t,n,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Rr(n,t,W(),W(),W())}}class Fi{constructor(e,t,n,i){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=i}}class mc{constructor(e,t){this.targetId=e,this.me=t}}class gc{constructor(e,t,n=pe.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}}class pc{constructor(){this.fe=0,this.ge=yc(),this.pe=pe.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=W(),t=W(),n=W();return this.ge.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:B()}}),new Rr(this.pe,this.ye,e,t,n)}Ce(){this.we=!1,this.ge=yc()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,q(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class og{constructor(e){this.Le=e,this.Be=new Map,this.ke=Ke(),this.qe=_c(),this.Qe=new ae(Q)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:B()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((n,i)=>{this.ze(i)&&t(i)})}He(e){const t=e.targetId,n=e.me.count,i=this.Je(t);if(i){const s=i.target;if(Si(s))if(0===n){const a=new L(s.path);this.Ue(t,a,le.newNoDocument(a,K.min()))}else q(1===n);else{const a=this.Ye(t);if(a!==n){const u=this.Ze(e),l=u?this.Xe(u,e,a):1;0!==l&&(this.je(t),this.Qe=this.Qe.insert(t,2===l?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:i=0},hashCount:s=0}=t;let a,u;try{a=ct(n).toUint8Array()}catch(l){if(l instanceof Il)return ze("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{u=new uo(a,i,s)}catch(l){return ze(l instanceof Ar?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return 0===u.Ie?null:u}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){const n=this.Le.getRemoteKeysForTarget(t);let i=0;return n.forEach(s=>{const a=this.Le.tt(),u=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;e.mightContain(u)||(this.Ue(t,s,null),i++)}),i}rt(e){const t=new Map;this.Be.forEach((s,a)=>{const u=this.Je(a);if(u){if(s.current&&Si(u.target)){const l=new L(u.target.path);null!==this.ke.get(l)||this.it(a,l)||this.Ue(a,l,le.newNoDocument(l,e))}s.be&&(t.set(a,s.ve()),s.Ce())}});let n=W();this.qe.forEach((s,a)=>{let u=!0;a.forEachWhile(l=>{const h=this.Je(l);return!h||"TargetPurposeLimboResolution"===h.purpose||(u=!1,!1)}),u&&(n=n.add(s))}),this.ke.forEach((s,a)=>a.setReadTime(e));const i=new wr(e,t,this.Qe,this.ke,n);return this.ke=Ke(),this.qe=_c(),this.Qe=new ae(Q),i}$e(e,t){if(!this.ze(e))return;const n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;const i=this.Ge(e);this.it(e,t)?i.Fe(t,1):i.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new pc,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new ie(Q),this.qe=this.qe.insert(e,t)),t}ze(e){const t=null!==this.Je(e);return t||N("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new pc),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function _c(){return new ae(L.comparator)}function yc(){return new ae(L.comparator)}const ag={asc:"ASCENDING",desc:"DESCENDING"},ug={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},lg={and:"AND",or:"OR"};class cg{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function lo(r,e){return r.useProto3Json||lr(e)?e:{value:e}}function Nn(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Ic(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function hg(r,e){return Nn(r,e.toTimestamp())}function Ie(r){return q(!!r),K.fromTimestamp(function(t){const n=lt(t);return new de(n.seconds,n.nanos)}(r))}function co(r,e){return ho(r,e).canonicalString()}function ho(r,e){const t=(i=r,new J(["projects",i.projectId,"databases",i.database])).child("documents");var i;return void 0===e?t:t.child(e)}function Tc(r){const e=J.fromString(r);return q(Cc(e)),e}function Pr(r,e){return co(r.databaseId,e.path)}function it(r,e){const t=Tc(e);if(t.get(1)!==r.databaseId.projectId)throw new C(V.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new C(V.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new L(Ac(t))}function Ec(r,e){return co(r.databaseId,e)}function vc(r){const e=Tc(r);return 4===e.length?J.emptyPath():Ac(e)}function fo(r){return new J(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function Ac(r){return q(r.length>4&&"documents"===r.get(4)),r.popFirst(5)}function wc(r,e,t){return{name:Pr(r,e),fields:t.value.mapValue.fields}}function Rc(r,e,t){const n=it(r,e.name),i=Ie(e.updateTime),s=e.createTime?Ie(e.createTime):K.min(),a=new Pe({mapValue:{fields:e.fields}}),u=le.newFoundDocument(n,i,s,a);return t&&u.setHasCommittedMutations(),t?u.setHasCommittedMutations():u}function Vr(r,e){let t;if(e instanceof Cn)t={update:wc(r,e.key,e.value)};else if(e instanceof Dn)t={delete:Pr(r,e.key)};else if(e instanceof ft)t={update:wc(r,e.key,e.data),updateMask:Ig(e.fieldMask)};else{if(!(e instanceof io))return B();t={verify:Pr(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(s,a){const u=a.transform;if(u instanceof bn)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Yt)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof Xt)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof xn)return{fieldPath:a.field.canonicalString(),increment:u.Pe};throw B()}(0,n))),e.precondition.isNone||(t.currentDocument=void 0!==(s=e.precondition).updateTime?{updateTime:hg(r,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:B()),t;var s}function mo(r,e){const t=e.currentDocument?void 0!==(s=e.currentDocument).updateTime?me.updateTime(Ie(s.updateTime)):void 0!==s.exists?me.exists(s.exists):me.none():me.none(),n=e.updateTransforms?e.updateTransforms.map(i=>function(a,u){let l=null;"setToServerValue"in u?(q("REQUEST_TIME"===u.setToServerValue),l=new bn):"appendMissingElements"in u?l=new Yt(u.appendMissingElements.values||[]):"removeAllFromArray"in u?l=new Xt(u.removeAllFromArray.values||[]):"increment"in u?l=new xn(a,u.increment):B();const h=ue.fromServerFormat(u.fieldPath);return new Er(h,l)}(r,i)):[];var s;if(e.update){const i=it(r,e.update.name),s=new Pe({mapValue:{fields:e.update.fields}});if(e.updateMask){const a=new Ge((e.updateMask.fieldPaths||[]).map(f=>ue.fromServerFormat(f)));return new ft(i,s,a,t,n)}return new Cn(i,s,t,n)}if(e.delete){const i=it(r,e.delete);return new Dn(i,t)}if(e.verify){const i=it(r,e.verify);return new io(i,t)}return B()}function Pc(r,e){return{documents:[Ec(r,e.path)]}}function Mi(r,e){const t={structuredQuery:{}},n=e.path;let i;null!==e.collectionGroup?(i=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=Ec(r,i);const s=function(h){if(0!==h.length)return xc(re.create(h,"and"))}(e.filters);s&&(t.structuredQuery.where=s);const a=function(h){if(0!==h.length)return h.map(f=>{return{field:xt((_=f).field),direction:pg(_.dir)};var _})}(e.orderBy);a&&(t.structuredQuery.orderBy=a);const u=lo(r,e.limit);return null!==u&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt={before:(h=e.startAt).inclusive,values:h.position}),e.endAt&&(t.structuredQuery.endAt=function(h){return{before:!h.inclusive,values:h.position}}(e.endAt)),{_t:t,parent:i};var h}function Sc(r){let e=vc(r.parent);const t=r.structuredQuery,n=t.from?t.from.length:0;let i=null;if(n>0){q(1===n);const f=t.from[0];f.allDescendants?i=f.collectionId:e=e.child(f.collectionId)}let s=[];t.where&&(s=function(g){const _=bc(g);return _ instanceof re&&Ys(_)?_.getFilters():[_]}(t.where));let a=[];t.orderBy&&(a=t.orderBy.map(_=>{return new gr(kn((x=_).field),function(D){switch(D){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(x.direction));var x}));let u=null;t.limit&&(u=function(g){let _;return _="object"==typeof g?g.value:g,lr(_)?null:_}(t.limit));let l=null;var g;t.startAt&&(l=new bt((g=t.startAt).values||[],!!g.before));let h=null;return t.endAt&&(h=function(g){return new bt(g.values||[],!g.before)}(t.endAt)),Ul(e,i,a,s,u,"F",l,h)}function bc(r){return void 0!==r.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=kn(t.unaryFilter.field);return Y.create(n,"==",{doubleValue:NaN});case"IS_NULL":const i=kn(t.unaryFilter.field);return Y.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=kn(t.unaryFilter.field);return Y.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=kn(t.unaryFilter.field);return Y.create(a,"!=",{nullValue:"NULL_VALUE"});default:return B()}}(r):void 0!==r.fieldFilter?Y.create(kn((t=r).fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return B()}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==r.compositeFilter?function(t){return re.create(t.compositeFilter.filters.map(n=>bc(n)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return B()}}(t.compositeFilter.op))}(r):B();var t}function pg(r){return ag[r]}function _g(r){return ug[r]}function yg(r){return lg[r]}function xt(r){return{fieldPath:r.canonicalString()}}function kn(r){return ue.fromServerFormat(r.fieldPath)}function xc(r){return r instanceof Y?function(t){if("=="===t.op){if(Al(t.value))return{unaryFilter:{field:xt(t.field),op:"IS_NAN"}};if(vl(t.value))return{unaryFilter:{field:xt(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Al(t.value))return{unaryFilter:{field:xt(t.field),op:"IS_NOT_NAN"}};if(vl(t.value))return{unaryFilter:{field:xt(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:xt(t.field),op:_g(t.op),value:t.value}}}(r):r instanceof re?function(t){const n=t.getFilters().map(i=>xc(i));return 1===n.length?n[0]:{compositeFilter:{op:yg(t.op),filters:n}}}(r):B()}function Ig(r){const e=[];return r.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Cc(r){return r.length>=4&&"projects"===r.get(0)&&"databases"===r.get(2)}class mt{constructor(e,t,n,i,s=K.min(),a=K.min(),u=pe.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=l}withSequenceNumber(e){return new mt(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new mt(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new mt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new mt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Dc{constructor(e){this.ct=e}}function Nc(r,e){const t=e.key,n={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Oi(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())n.document={name:Pr(s=r.ct,(a=e).key),fields:a.data.value.mapValue.fields,updateTime:Nn(s,a.version.toTimestamp()),createTime:Nn(s,a.createTime.toTimestamp())};else if(e.isNoDocument())n.noDocument={path:t.path.toArray(),readTime:Zt(e.version)};else{if(!e.isUnknownDocument())return B();n.unknownDocument={path:t.path.toArray(),version:Zt(e.version)}}var s,a;return n}function Oi(r){const e=r.toTimestamp();return[e.seconds,e.nanoseconds]}function Zt(r){const e=r.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function en(r){const e=new de(r.seconds,r.nanoseconds);return K.fromTimestamp(e)}function tn(r,e){const t=(e.baseMutations||[]).map(s=>mo(r.ct,s));for(let s=0;s<e.mutations.length-1;++s)s+1<e.mutations.length&&void 0!==e.mutations[s+1].transform&&(e.mutations[s].updateTransforms=e.mutations[s+1].transform.fieldTransforms,e.mutations.splice(s+1,1),++s);const n=e.mutations.map(s=>mo(r.ct,s)),i=de.fromMillis(e.localWriteTimeMs);return new so(e.batchId,i,t,n)}function Sr(r){const e=en(r.readTime),t=void 0!==r.lastLimboFreeSnapshotVersion?en(r.lastLimboFreeSnapshotVersion):K.min();let n;return n=void 0!==r.query.documents?(q(1===(s=r.query).documents.length),Ce(Pn(vc(s.documents[0])))):function(s){return Ce(Sc(s))}(r.query),new mt(n,r.targetId,"TargetPurposeListen",r.lastListenSequenceNumber,e,t,pe.fromBase64String(r.resumeToken));var s}function kc(r,e){const t=Zt(e.snapshotVersion),n=Zt(e.lastLimboFreeSnapshotVersion);let i;i=Si(e.target)?Pc(r.ct,e.target):Mi(r.ct,e.target)._t;const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Jt(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:i}}function go(r){const e=Sc({parent:r.parent,structuredQuery:r.structuredQuery});return"LAST"===r.limitType?xi(e,e.limit,"L"):e}function po(r,e){return new ao(e.largestBatchId,mo(r.ct,e.overlayMutation))}function Fc(r,e){const t=e.path.lastSegment();return[r,xe(e.path.popLast()),t]}function Mc(r,e,t,n){return{indexId:r,uid:e,sequenceNumber:t,readTime:Zt(n.readTime),documentKey:xe(n.documentKey.path),largestBatchId:n.largestBatchId}}class Eg{getBundleMetadata(e,t){return Oc(e).get(t).next(n=>{if(n)return{id:(s=n).bundleId,createTime:en(s.createTime),version:s.version};var s})}saveBundleMetadata(e,t){return Oc(e).put({bundleId:(i=t).id,createTime:Zt(Ie(i.createTime)),version:i.version});var i}getNamedQuery(e,t){return Lc(e).get(t).next(n=>{if(n)return{name:(s=n).name,query:go(s.bundledQuery),readTime:en(s.readTime)};var s})}saveNamedQuery(e,t){return Lc(e).put({name:(i=t).name,readTime:Zt(Ie(i.readTime)),bundledQuery:i.bundledQuery});var i}}function Oc(r){return Ee(r,"bundles")}function Lc(r){return Ee(r,"namedQueries")}class Li{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){return new Li(e,t.uid||"")}getOverlay(e,t){return br(e).get(Fc(this.userId,t)).next(n=>n?po(this.serializer,n):null)}getOverlays(e,t){const n=rt();return w.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){const i=[];return n.forEach((s,a)=>{const u=new ao(t,a);i.push(this.ht(e,u))}),w.waitFor(i)}removeOverlaysForBatchId(e,t,n){const i=new Set;t.forEach(a=>i.add(xe(a.getCollectionPath())));const s=[];return i.forEach(a=>{const u=IDBKeyRange.bound([this.userId,a,n],[this.userId,a,n+1],!1,!0);s.push(br(e).j("collectionPathOverlayIndex",u))}),w.waitFor(s)}getOverlaysForCollection(e,t,n){const i=rt(),s=xe(t),a=IDBKeyRange.bound([this.userId,s,n],[this.userId,s,Number.POSITIVE_INFINITY],!0);return br(e).U("collectionPathOverlayIndex",a).next(u=>{for(const l of u){const h=po(this.serializer,l);i.set(h.getKey(),h)}return i})}getOverlaysForCollectionGroup(e,t,n,i){const s=rt();let a;const u=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return br(e).J({index:"collectionGroupOverlayIndex",range:u},(l,h,f)=>{const g=po(this.serializer,h);s.size()<i||g.largestBatchId===a?(s.set(g.getKey(),g),a=g.largestBatchId):f.done()}).next(()=>s)}ht(e,t){return br(e).put(function(i,s,a){const[u,l,h]=Fc(s,a.mutation.key);return{userId:s,collectionPath:l,documentId:h,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:Vr(i.ct,a.mutation)}}(this.serializer,this.userId,t))}}function br(r){return Ee(r,"documentOverlays")}class vg{Pt(e){return Ee(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{const n=null==t?void 0:t.value;return n?pe.fromUint8Array(n):pe.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}}class nn{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(fe(e.integerValue));else if("doubleValue"in e){const n=fe(e.doubleValue);isNaN(n)?this.dt(t,13):(this.dt(t,15),cr(n)?t.At(0):t.At(n))}else if("timestampValue"in e){let n=e.timestampValue;this.dt(t,20),"string"==typeof n&&(n=lt(n)),t.Rt(`${n.seconds||""}`),t.At(n.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(ct(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.dt(t,45),t.At(n.latitude||0),t.At(n.longitude||0)}else"mapValue"in e?wl(e)?this.dt(t,Number.MAX_SAFE_INTEGER):Vi(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):B()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const n=e.fields||{};this.dt(t,55);for(const i of Object.keys(n))this.Vt(i,t),this.Tt(n[i],t)}wt(e,t){var n,i;const s=e.fields||{};this.dt(t,53);const a="value",u=(null===(i=null===(n=s[a].arrayValue)||void 0===n?void 0:n.values)||void 0===i?void 0:i.length)||0;this.dt(t,15),t.At(fe(u)),this.Vt(a,t),this.Tt(s[a],t)}bt(e,t){const n=e.values||[];this.dt(t,50);for(const i of n)this.Tt(i,t)}yt(e,t){this.dt(t,37),L.fromName(e).path.forEach(n=>{this.dt(t,60),this.Dt(n,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}function Ag(r){if(0===r)return 8;let e=0;return!(r>>4)&&(e+=4,r<<=4),!(r>>6)&&(e+=2,r<<=2),!(r>>7)&&(e+=1),e}function Bc(r){const e=64-function(n){let i=0;for(let s=0;s<8;++s){const a=Ag(255&n[s]);if(i+=a,8!==a)break}return i}(r);return Math.ceil(e/8)}nn.vt=new nn;class wg{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ft(n.value),n=t.next();this.Mt()}xt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ot(n.value),n=t.next();this.Nt()}Lt(e){for(const t of e){const n=t.charCodeAt(0);if(n<128)this.Ft(n);else if(n<2048)this.Ft(960|n>>>6),this.Ft(128|63&n);else if(t<"\ud800"||"\udbff"<t)this.Ft(480|n>>>12),this.Ft(128|63&n>>>6),this.Ft(128|63&n);else{const i=t.codePointAt(0);this.Ft(240|i>>>18),this.Ft(128|63&i>>>12),this.Ft(128|63&i>>>6),this.Ft(128|63&i)}}this.Mt()}Bt(e){for(const t of e){const n=t.charCodeAt(0);if(n<128)this.Ot(n);else if(n<2048)this.Ot(960|n>>>6),this.Ot(128|63&n);else if(t<"\ud800"||"\udbff"<t)this.Ot(480|n>>>12),this.Ot(128|63&n>>>6),this.Ot(128|63&n);else{const i=t.codePointAt(0);this.Ot(240|i>>>18),this.Ot(128|63&i>>>12),this.Ot(128|63&i>>>6),this.Ot(128|63&i)}}this.Nt()}kt(e){const t=this.qt(e),n=Bc(t);this.Qt(1+n),this.buffer[this.position++]=255&n;for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=255&t[i]}Kt(e){const t=this.qt(e),n=Bc(t);this.Qt(1+n),this.buffer[this.position++]=~(255&n);for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){const t=function(s){const a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,s,!1),new Uint8Array(a.buffer)}(e),n=!!(128&t[0]);t[0]^=n?255:128;for(let i=1;i<t.length;++i)t[i]^=n?255:0;return t}Ft(e){const t=255&e;0===t?(this.Ut(0),this.Ut(255)):255===t?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){const t=255&e;0===t?(this.Gt(0),this.Gt(255)):255===t?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const i=new Uint8Array(n);i.set(this.buffer),this.buffer=i}}class Rg{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}}class Pg{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}}class xr{constructor(){this.jt=new wg,this.Ht=new Rg(this.jt),this.Jt=new Pg(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return 0===e?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}class rn{constructor(e,t,n,i){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=i}Zt(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new rn(this.indexId,this.documentKey,this.arrayValue,n)}}function Ct(r,e){let t=r.indexId-e.indexId;return 0!==t?t:(t=Uc(r.arrayValue,e.arrayValue),0!==t?t:(t=Uc(r.directionalValue,e.directionalValue),0!==t?t:L.comparator(r.documentKey,e.documentKey)))}function Uc(r,e){for(let t=0;t<r.length&&t<e.length;++t){const n=r[t]-e[t];if(0!==n)return n}return r.length-e.length}class qc{constructor(e){this.Xt=new ie((t,n)=>ue.comparator(t.field,n.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(const t of e.filters){const n=t;n.isInequality()?this.Xt=this.Xt.add(n):this.tn.push(n)}}get nn(){return this.Xt.size>1}rn(e){if(q(e.collectionGroup===this.collectionId),this.nn)return!1;const t=Gs(e);if(void 0!==t&&!this.sn(t))return!1;const n=Qt(e);let i=new Set,s=0,a=0;for(;s<n.length&&this.sn(n[s]);++s)i=i.add(n[s].fieldPath.canonicalString());if(s===n.length)return!0;if(this.Xt.size>0){const u=this.Xt.getIterator().getNext();if(!i.has(u.field.canonicalString())){const l=n[s];if(!this.on(u,l)||!this._n(this.en[a++],l))return!1}++s}for(;s<n.length;++s)if(a>=this.en.length||!this._n(this.en[a++],n[s]))return!1;return!0}an(){if(this.nn)return null;let e=new ie(ue.comparator);const t=[];for(const n of this.tn)if(!n.field.isKeyField())if("array-contains"===n.op||"array-contains-any"===n.op)t.push(new $t(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new $t(n.field,0))}for(const n of this.en)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new $t(n.field,"asc"===n.dir?0:1)));return new En(En.UNKNOWN_ID,this.collectionId,t,vn.empty())}sn(e){for(const t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){return!(void 0===e||!e.field.isEqual(t.fieldPath))&&2===t.kind==("array-contains"===e.op||"array-contains-any"===e.op)}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function Gc(r){var e,t;if(q(r instanceof Y||r instanceof re),r instanceof Y){if(r instanceof Ol){const i=(null===(t=null===(e=r.value.arrayValue)||void 0===e?void 0:e.values)||void 0===t?void 0:t.map(s=>Y.create(r.field,"==",s)))||[];return re.create(i,"or")}return r}const n=r.filters.map(i=>Gc(i));return re.create(n,r.op)}function Vg(r){if(0===r.getFilters().length)return[];const e=Io(Gc(r));return q(Kc(e)),_o(e)||yo(e)?[e]:e.getFilters()}function _o(r){return r instanceof Y}function yo(r){return r instanceof re&&Ys(r)}function Kc(r){return _o(r)||yo(r)||function(t){if(t instanceof re&&Js(t)){for(const n of t.getFilters())if(!_o(n)&&!yo(n))return!1;return!0}return!1}(r)}function Io(r){if(q(r instanceof Y||r instanceof re),r instanceof Y)return r;if(1===r.filters.length)return Io(r.filters[0]);const e=r.filters.map(n=>Io(n));let t=re.create(e,r.op);return t=Bi(t),Kc(t)?t:(q(t instanceof re),q(Rn(t)),q(t.filters.length>1),t.filters.reduce((n,i)=>To(n,i)))}function To(r,e){let t;return q(r instanceof Y||r instanceof re),q(e instanceof Y||e instanceof re),t=r instanceof Y?e instanceof Y?re.create([r,e],"and"):jc(r,e):e instanceof Y?jc(e,r):function(i,s){if(q(i.filters.length>0&&s.filters.length>0),Rn(i)&&Rn(s))return kl(i,s.getFilters());const a=Js(i)?i:s,u=Js(i)?s:i,l=a.filters.map(h=>To(h,u));return re.create(l,"or")}(r,e),Bi(t)}function jc(r,e){if(Rn(e))return kl(e,r.getFilters());{const t=e.filters.map(n=>To(r,n));return re.create(t,"or")}}function Bi(r){if(q(r instanceof Y||r instanceof re),r instanceof Y)return r;const e=r.getFilters();if(1===e.length)return Bi(e[0]);if(Dl(r))return r;const t=e.map(i=>Bi(i)),n=[];return t.forEach(i=>{i instanceof Y?n.push(i):i instanceof re&&(i.op===r.op?n.push(...i.filters):n.push(i))}),1===n.length?n[0]:re.create(n,r.op)}class Sg{constructor(){this.un=new Eo}addToCollectionParentIndex(e,t){return this.un.add(t),w.resolve()}getCollectionParents(e,t){return w.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return w.resolve()}deleteFieldIndex(e,t){return w.resolve()}deleteAllFieldIndexes(e){return w.resolve()}createTargetIndexes(e,t){return w.resolve()}getDocumentsMatchingTarget(e,t){return w.resolve(null)}getIndexType(e,t){return w.resolve(0)}getFieldIndexes(e,t){return w.resolve([])}getNextCollectionGroupToUpdate(e){return w.resolve(null)}getMinOffset(e,t){return w.resolve(Qe.min())}getMinOffsetFromCollectionGroup(e,t){return w.resolve(Qe.min())}updateCollectionGroup(e,t,n){return w.resolve()}updateIndexEntries(e,t){return w.resolve()}}class Eo{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new ie(J.comparator),s=!i.has(n);return this.index[t]=i.add(n),s}has(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new ie(J.comparator)).toArray()}}const Ui=new Uint8Array(0);class bg{constructor(e,t){this.databaseId=t,this.cn=new Eo,this.ln=new dt(n=>Jt(n),(n,i)=>pr(n,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){const n=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});const s={collectionId:n,parent:xe(i)};return zc(e).put(s)}return w.resolve()}getCollectionParents(e,t){const n=[],i=IDBKeyRange.bound([t,""],[tl(t),""],!1,!0);return zc(e).U(i).next(s=>{for(const a of s){if(a.collectionId!==t)break;n.push(tt(a.parent))}return n})}addFieldIndex(e,t){const n=Cr(e),i={indexId:(u=t).indexId,collectionGroup:u.collectionGroup,fields:u.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])};var u;delete i.indexId;const s=n.add(i);if(t.indexState){const a=Mn(e);return s.next(u=>{a.put(Mc(u,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){const n=Cr(e),i=Mn(e),s=Fn(e);return n.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=Cr(e),n=Fn(e),i=Mn(e);return t.j().next(()=>n.j()).next(()=>i.j())}createTargetIndexes(e,t){return w.forEach(this.hn(t),n=>this.getIndexType(e,n).next(i=>{if(0===i||1===i){const s=new qc(n).an();if(null!=s)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){const n=Fn(e);let i=!0;const s=new Map;return w.forEach(this.hn(t),a=>this.Pn(e,a).next(u=>{i&&(i=!!u),s.set(a,u)})).next(()=>{if(i){let a=W();const u=[];return w.forEach(s,(l,h)=>{var G;N("IndexedDbIndexManager",`Using index ${G=l,`id=${G.indexId}|cg=${G.collectionGroup}|f=${G.fields.map(z=>`${z.fieldPath}:${z.kind}`).join(",")}`} to execute ${Jt(t)}`);const f=function(G,z){const X=Gs(z);if(void 0===X)return null;for(const $ of bi(G,X.fieldPath))switch($.op){case"array-contains-any":return $.value.arrayValue.values||[];case"array-contains":return[$.value]}return null}(h,l),g=function(G,z){const X=new Map;for(const $ of Qt(z))for(const T of bi(G,$.fieldPath))switch(T.op){case"==":case"in":X.set($.fieldPath.canonicalString(),T.value);break;case"not-in":case"!=":return X.set($.fieldPath.canonicalString(),T.value),Array.from(X.values())}return null}(h,l),_=function(G,z){const X=[];let $=!0;for(const T of Qt(z)){const p=0===T.kind?Ll(G,T.fieldPath,G.startAt):Bl(G,T.fieldPath,G.startAt);X.push(p.value),$&&($=p.inclusive)}return new bt(X,$)}(h,l),R=function(G,z){const X=[];let $=!0;for(const T of Qt(z)){const p=0===T.kind?Bl(G,T.fieldPath,G.endAt):Ll(G,T.fieldPath,G.endAt);X.push(p.value),$&&($=p.inclusive)}return new bt(X,$)}(h,l),x=this.In(l,h,_),k=this.In(l,h,R),D=this.Tn(l,h,g),U=this.En(l.indexId,f,x,_.inclusive,k,R.inclusive,D);return w.forEach(U,j=>n.G(j,t.limit).next(G=>{G.forEach(z=>{const X=L.fromSegments(z.documentKey);a.has(X)||(a=a.add(X),u.push(X))})}))}).next(()=>u)}return w.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(t=0===e.filters.length?[e]:Vg(re.create(e.filters,"and")).map(n=>Zs(e.path,e.collectionGroup,e.orderBy,n.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,n,i,s,a,u){const l=(null!=t?t.length:1)*Math.max(n.length,s.length),h=l/(null!=t?t.length:1),f=[];for(let g=0;g<l;++g){const _=t?this.dn(t[g/h]):Ui,R=this.An(e,_,n[g%h],i),x=this.Rn(e,_,s[g%h],a),k=u.map(D=>this.An(e,_,D,!0));f.push(...this.createRange(R,x,k))}return f}An(e,t,n,i){const s=new rn(e,L.empty(),t,n);return i?s:s.Zt()}Rn(e,t,n,i){const s=new rn(e,L.empty(),t,n);return i?s.Zt():s}Pn(e,t){const n=new qc(t),i=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let a=null;for(const u of s)n.rn(u)&&(!a||u.fields.length>a.fields.length)&&(a=u);return a})}getIndexType(e,t){let n=2;const i=this.hn(t);return w.forEach(i,s=>this.Pn(e,s).next(a=>{a?0!==n&&a.fields.length<function(l){let h=new ie(ue.comparator),f=!1;for(const g of l.filters)for(const _ of g.getFlattenedFilters())_.field.isKeyField()||("array-contains"===_.op||"array-contains-any"===_.op?f=!0:h=h.add(_.field));for(const g of l.orderBy)g.field.isKeyField()||(h=h.add(g.field));return h.size+(f?1:0)}(s)&&(n=1):n=0})).next(()=>null!==t.limit&&i.length>1&&2===n?1:n)}Vn(e,t){const n=new xr;for(const i of Qt(e)){const s=t.data.field(i.fieldPath);if(null==s)return null;const a=n.Yt(i.kind);nn.vt.It(s,a)}return n.zt()}dn(e){const t=new xr;return nn.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){const n=new xr;return nn.vt.It(Ht(this.databaseId,t),n.Yt(function(s){const a=Qt(s);return 0===a.length?0:a[a.length-1].kind}(e))),n.zt()}Tn(e,t,n){if(null===n)return[];let i=[];i.push(new xr);let s=0;for(const a of Qt(e)){const u=n[s++];for(const l of i)if(this.fn(t,a.fieldPath)&&fr(u))i=this.gn(i,a,u);else{const h=l.Yt(a.kind);nn.vt.It(u,h)}}return this.pn(i)}In(e,t,n){return this.Tn(e,t,n.position)}pn(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].zt();return t}gn(e,t,n){const i=[...e],s=[];for(const a of n.arrayValue.values||[])for(const u of i){const l=new xr;l.seed(u.zt()),nn.vt.It(a,l.Yt(t.kind)),s.push(l)}return s}fn(e,t){return!!e.filters.find(n=>n instanceof Y&&n.field.isEqual(t)&&("in"===n.op||"not-in"===n.op))}getFieldIndexes(e,t){const n=Cr(e),i=Mn(e);return(t?n.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.U()).next(s=>{const a=[];return w.forEach(s,u=>i.get([u.indexId,this.uid]).next(l=>{a.push(function(f,g){const _=g?new vn(g.sequenceNumber,new Qe(en(g.readTime),new L(tt(g.documentKey)),g.largestBatchId)):vn.empty(),R=f.fields.map(([x,k])=>new $t(ue.fromServerFormat(x),k));return new En(f.indexId,f.collectionGroup,R,_)}(u,l))})).next(()=>a)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>0===t.length?null:(t.sort((n,i)=>{const s=n.indexState.sequenceNumber-i.indexState.sequenceNumber;return 0!==s?s:Q(n.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,n){const i=Cr(e),s=Mn(e);return this.yn(e).next(a=>i.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(u=>w.forEach(u,l=>s.put(Mc(l.indexId,this.uid,a,n)))))}updateIndexEntries(e,t){const n=new Map;return w.forEach(t,(i,s)=>{const a=n.get(i.collectionGroup);return(a?w.resolve(a):this.getFieldIndexes(e,i.collectionGroup)).next(u=>(n.set(i.collectionGroup,u),w.forEach(u,l=>this.wn(e,i,l).next(h=>{const f=this.Sn(s,l);return h.isEqual(f)?w.resolve():this.bn(e,s,l,h,f)}))))})}Dn(e,t,n,i){return Fn(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.mn(n,t.key),documentKey:t.key.path.toArray()})}vn(e,t,n,i){return Fn(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.mn(n,t.key),t.key.path.toArray()])}wn(e,t,n){const i=Fn(e);let s=new ie(Ct);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.mn(n,t)])},(a,u)=>{s=s.add(new rn(n.indexId,t,u.arrayValue,u.directionalValue))}).next(()=>s)}Sn(e,t){let n=new ie(Ct);const i=this.Vn(t,e);if(null==i)return n;const s=Gs(t);if(null!=s){const a=e.data.field(s.fieldPath);if(fr(a))for(const u of a.arrayValue.values||[])n=n.add(new rn(t.indexId,e.key,this.dn(u),i))}else n=n.add(new rn(t.indexId,e.key,Ui,i));return n}bn(e,t,n,i,s){N("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const a=[];return function(l,h,f,g,_){const R=l.getIterator(),x=h.getIterator();let k=An(R),D=An(x);for(;k||D;){let U=!1,j=!1;if(k&&D){const G=f(k,D);G<0?j=!0:G>0&&(U=!0)}else null!=k?j=!0:U=!0;U?(g(D),D=An(x)):j?(_(k),k=An(R)):(k=An(R),D=An(x))}}(i,s,Ct,u=>{a.push(this.Dn(e,t,n,u))},u=>{a.push(this.vn(e,t,n,u))}),w.waitFor(a)}yn(e){let t=1;return Mn(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(n,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((a,u)=>Ct(a,u)).filter((a,u,l)=>!u||0!==Ct(a,l[u-1]));const i=[];i.push(e);for(const a of n){const u=Ct(a,e),l=Ct(a,t);if(0===u)i[0]=e.Zt();else if(u>0&&l<0)i.push(a),i.push(a.Zt());else if(l>0)break}i.push(t);const s=[];for(let a=0;a<i.length;a+=2){if(this.Cn(i[a],i[a+1]))return[];s.push(IDBKeyRange.bound([i[a].indexId,this.uid,i[a].arrayValue,i[a].directionalValue,Ui,[]],[i[a+1].indexId,this.uid,i[a+1].arrayValue,i[a+1].directionalValue,Ui,[]]))}return s}Cn(e,t){return Ct(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Qc)}getMinOffset(e,t){return w.mapArray(this.hn(t),n=>this.Pn(e,n).next(i=>i||B())).next(Qc)}}function zc(r){return Ee(r,"collectionParents")}function Fn(r){return Ee(r,"indexEntries")}function Cr(r){return Ee(r,"indexConfiguration")}function Mn(r){return Ee(r,"indexState")}function Qc(r){q(0!==r.length);let e=r[0].indexState.offset,t=e.largestBatchId;for(let n=1;n<r.length;n++){const i=r[n].indexState.offset;Ks(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new Qe(e.readTime,e.documentKey,t)}const $c={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class De{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new De(e,De.DEFAULT_COLLECTION_PERCENTILE,De.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Wc(r,e,t){const n=r.store("mutations"),i=r.store("documentMutations"),s=[],a=IDBKeyRange.only(t.batchId);let u=0;const l=n.J({range:a},(f,g,_)=>(u++,_.delete()));s.push(l.next(()=>{q(1===u)}));const h=[];for(const f of t.mutations){const g=hl(e,f.key.path,t.batchId);s.push(i.delete(g)),h.push(f.key)}return w.waitFor(s).next(()=>h)}function qi(r){if(!r)return 0;let e;if(r.document)e=r.document;else if(r.unknownDocument)e=r.unknownDocument;else{if(!r.noDocument)throw B();e=r.noDocument}return JSON.stringify(e).length}De.DEFAULT_COLLECTION_PERCENTILE=10,De.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,De.DEFAULT=new De(41943040,De.DEFAULT_COLLECTION_PERCENTILE,De.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),De.DISABLED=new De(-1,0,0);class Gi{constructor(e,t,n,i){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=i,this.Fn={}}static lt(e,t,n,i){q(""!==e.uid);const s=e.isAuthenticated()?e.uid:"";return new Gi(s,t,n,i)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Dt(e).J({index:"userMutationsIndex",range:n},(i,s,a)=>{t=!1,a.done()}).next(()=>t)}addMutationBatch(e,t,n,i){const s=On(e),a=Dt(e);return a.add({}).next(u=>{q("number"==typeof u);const l=new so(u,t,n,i),h=function(R,x,k){const D=k.baseMutations.map(j=>Vr(R.ct,j)),U=k.mutations.map(j=>Vr(R.ct,j));return{userId:x,batchId:k.batchId,localWriteTimeMs:k.localWriteTime.toMillis(),baseMutations:D,mutations:U}}(this.serializer,this.userId,l),f=[];let g=new ie((_,R)=>Q(_.canonicalString(),R.canonicalString()));for(const _ of i){const R=hl(this.userId,_.key.path,u);g=g.add(_.key.path.popLast()),f.push(a.put(h)),f.push(s.put(R,pm))}return g.forEach(_=>{f.push(this.indexManager.addToCollectionParentIndex(e,_))}),e.addOnCommittedListener(()=>{this.Fn[u]=l.keys()}),w.waitFor(f).next(()=>l)})}lookupMutationBatch(e,t){return Dt(e).get(t).next(n=>n?(q(n.userId===this.userId),tn(this.serializer,n)):null)}Mn(e,t){return this.Fn[t]?w.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(n=>{if(n){const i=n.keys();return this.Fn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){const n=t+1,i=IDBKeyRange.lowerBound([this.userId,n]);let s=null;return Dt(e).J({index:"userMutationsIndex",range:i},(a,u,l)=>{u.userId===this.userId&&(q(u.batchId>=n),s=tn(this.serializer,u)),l.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return Dt(e).J({index:"userMutationsIndex",range:t,reverse:!0},(i,s,a)=>{n=s.batchId,a.done()}).next(()=>n)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Dt(e).U("userMutationsIndex",t).next(n=>n.map(i=>tn(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=Ti(this.userId,t.path),i=IDBKeyRange.lowerBound(n),s=[];return On(e).J({range:i},(a,u,l)=>{const[h,f,g]=a,_=tt(f);if(h===this.userId&&t.path.isEqual(_))return Dt(e).get(g).next(R=>{if(!R)throw B();q(R.userId===this.userId),s.push(tn(this.serializer,R))});l.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new ie(Q);const i=[];return t.forEach(s=>{const a=Ti(this.userId,s.path),u=IDBKeyRange.lowerBound(a),l=On(e).J({range:u},(h,f,g)=>{const[_,R,x]=h,k=tt(R);_===this.userId&&s.path.isEqual(k)?n=n.add(x):g.done()});i.push(l)}),w.waitFor(i).next(()=>this.xn(e,n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1,s=Ti(this.userId,n),a=IDBKeyRange.lowerBound(s);let u=new ie(Q);return On(e).J({range:a},(l,h,f)=>{const[g,_,R]=l,x=tt(_);g===this.userId&&n.isPrefixOf(x)?x.length===i&&(u=u.add(R)):f.done()}).next(()=>this.xn(e,u))}xn(e,t){const n=[],i=[];return t.forEach(s=>{i.push(Dt(e).get(s).next(a=>{if(null===a)throw B();q(a.userId===this.userId),n.push(tn(this.serializer,a))}))}),w.waitFor(i).next(()=>n)}removeMutationBatch(e,t){return Wc(e._e,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),w.forEach(n,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return w.resolve();const n=IDBKeyRange.lowerBound(function(a){return[a]}(this.userId)),i=[];return On(e).J({range:n},(s,a,u)=>{if(s[0]===this.userId){const l=tt(s[1]);i.push(l)}else u.done()}).next(()=>{q(0===i.length)})})}containsKey(e,t){return Hc(e,this.userId,t)}Nn(e){return Jc(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function Hc(r,e,t){const n=Ti(e,t.path),i=n[1],s=IDBKeyRange.lowerBound(n);let a=!1;return On(r).J({range:s,H:!0},(u,l,h)=>{const[f,g,_]=u;f===e&&g===i&&(a=!0),h.done()}).next(()=>a)}function Dt(r){return Ee(r,"mutations")}function On(r){return Ee(r,"documentMutations")}function Jc(r){return Ee(r,"mutationQueues")}class sn{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new sn(0)}static kn(){return new sn(-1)}}class xg{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{const n=new sn(t.highestTargetId);return t.highestTargetId=n.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>K.fromTimestamp(new de(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.qn(e).next(i=>(i.highestListenSequenceNumber=t,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.Qn(e,i)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(n=>(n.targetCount+=1,this.$n(t,n),this.Qn(e,n))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Ln(e).delete(t.targetId)).next(()=>this.qn(e)).next(n=>(q(n.targetCount>0),n.targetCount-=1,this.Qn(e,n)))}removeTargets(e,t,n){let i=0;const s=[];return Ln(e).J((a,u)=>{const l=Sr(u);l.sequenceNumber<=t&&null===n.get(l.targetId)&&(i++,s.push(this.removeTargetData(e,l)))}).next(()=>w.waitFor(s)).next(()=>i)}forEachTarget(e,t){return Ln(e).J((n,i)=>{const s=Sr(i);t(s)})}qn(e){return Yc(e).get("targetGlobalKey").next(t=>(q(null!==t),t))}Qn(e,t){return Yc(e).put("targetGlobalKey",t)}Kn(e,t){return Ln(e).put(kc(this.serializer,t))}$n(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){const n=Jt(t),i=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let s=null;return Ln(e).J({range:i,index:"queryTargetsIndex"},(a,u,l)=>{const h=Sr(u);pr(t,h.target)&&(s=h,l.done())}).next(()=>s)}addMatchingKeys(e,t,n){const i=[],s=Nt(e);return t.forEach(a=>{const u=xe(a.path);i.push(s.put({targetId:n,path:u})),i.push(this.referenceDelegate.addReference(e,n,a))}),w.waitFor(i)}removeMatchingKeys(e,t,n){const i=Nt(e);return w.forEach(t,s=>{const a=xe(s.path);return w.waitFor([i.delete([n,a]),this.referenceDelegate.removeReference(e,n,s)])})}removeMatchingKeysForTargetId(e,t){const n=Nt(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(i)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),i=Nt(e);let s=W();return i.J({range:n,H:!0},(a,u,l)=>{const h=tt(a[1]),f=new L(h);s=s.add(f)}).next(()=>s)}containsKey(e,t){const n=xe(t.path),i=IDBKeyRange.bound([n],[tl(n)],!1,!0);let s=0;return Nt(e).J({index:"documentTargetsIndex",H:!0,range:i},([a,u],l,h)=>{0!==a&&(s++,h.done())}).next(()=>s>0)}ot(e,t){return Ln(e).get(t).next(n=>n?Sr(n):null)}}function Ln(r){return Ee(r,"targets")}function Yc(r){return Ee(r,"targetGlobal")}function Nt(r){return Ee(r,"targetDocuments")}function Xc([r,e],[t,n]){const i=Q(r,t);return 0===i?Q(e,n):i}class Cg{constructor(e){this.Un=e,this.buffer=new ie(Xc),this.Wn=0}Gn(){return++this.Wn}zn(e){const t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{const n=this.buffer.last();Xc(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Zc{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.jn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return null!==this.jn}Hn(e){var t=this;N("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,b.A)(function*(){t.jn=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(n){At(n)?N("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",n):yield vt(n)}yield t.Hn(3e5)}))}}class Dg{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(n=>Math.floor(t/100*n))}nthSequenceNumber(e,t){if(0===t)return w.resolve($e.oe);const n=new Cg(t);return this.Jn.forEachTarget(e,i=>n.zn(i.sequenceNumber)).next(()=>this.Jn.Zn(e,i=>n.zn(i))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Jn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(N("LruGarbageCollector","Garbage collection skipped; disabled"),w.resolve($c)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(N("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),$c):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let n,i,s,a,u,l,h;const f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(g=>(g>this.params.maximumSequenceNumbersToCollect?(N("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),i=this.params.maximumSequenceNumbersToCollect):i=g,a=Date.now(),this.nthSequenceNumber(e,i))).next(g=>(n=g,u=Date.now(),this.removeTargets(e,n,t))).next(g=>(s=g,l=Date.now(),this.removeOrphanedDocuments(e,n))).next(g=>(h=Date.now(),In()<=Ze.$b.DEBUG&&N("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${a-f}ms\n\tDetermined least recently used ${i} in `+(u-a)+`ms\n\tRemoved ${s} targets in `+(l-u)+`ms\n\tRemoved ${g} documents in `+(h-l)+`ms\nTotal Duration: ${h-f}ms`),w.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:g})))}}class Ng{constructor(e,t){this.db=e,this.garbageCollector=function eh(r,e){return new Dg(r,e)}(this,t)}Yn(e){const t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(n=>t.next(i=>n+i))}er(e){let t=0;return this.Zn(e,n=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(n,i)=>t(i))}addReference(e,t,n){return Ki(e,n)}removeReference(e,t,n){return Ki(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return Ki(e,t)}nr(e,t){return function(i,s){let a=!1;return Jc(i).Y(u=>Hc(i,u,s).next(l=>(l&&(a=!0),w.resolve(!l)))).next(()=>a)}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let s=0;return this.tr(e,(a,u)=>{if(u<=t){const l=this.nr(e,a).next(h=>{if(!h)return s++,n.getEntry(e,a).next(()=>(n.removeEntry(a,K.min()),Nt(e).delete([0,xe(a.path)])))});i.push(l)}}).next(()=>w.waitFor(i)).next(()=>n.apply(e)).next(()=>s)}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return Ki(e,t)}tr(e,t){const n=Nt(e);let i,s=$e.oe;return n.J({index:"documentTargetsIndex"},([a,u],{path:l,sequenceNumber:h})=>{0===a?(s!==$e.oe&&t(new L(tt(i)),s),s=h,i=l):s=$e.oe}).next(()=>{s!==$e.oe&&t(new L(tt(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Ki(r,e){return Nt(r).put((i=r.currentSequenceNumber,{targetId:0,path:xe(e.path),sequenceNumber:i}));var i}class th{constructor(){this.changes=new dt(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,le.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?w.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class kg{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return on(e).put(n)}removeEntry(e,t,n){return on(e).delete(function(s,a){const u=s.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],Oi(a),u[u.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.rr(e,n)))}getEntry(e,t){let n=le.newInvalidDocument(t);return on(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Dr(t))},(i,s)=>{n=this.ir(t,s)}).next(()=>n)}sr(e,t){let n={size:0,document:le.newInvalidDocument(t)};return on(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Dr(t))},(i,s)=>{n={document:this.ir(t,s),size:qi(s)}}).next(()=>n)}getEntries(e,t){let n=Ke();return this._r(e,t,(i,s)=>{const a=this.ir(i,s);n=n.insert(i,a)}).next(()=>n)}ar(e,t){let n=Ke(),i=new ae(L.comparator);return this._r(e,t,(s,a)=>{const u=this.ir(s,a);n=n.insert(s,u),i=i.insert(s,qi(a))}).next(()=>({documents:n,ur:i}))}_r(e,t,n){if(t.isEmpty())return w.resolve();let i=new ie(sh);t.forEach(l=>i=i.add(l));const s=IDBKeyRange.bound(Dr(i.first()),Dr(i.last())),a=i.getIterator();let u=a.getNext();return on(e).J({index:"documentKeyIndex",range:s},(l,h,f)=>{const g=L.fromSegments([...h.prefixPath,h.collectionGroup,h.documentId]);for(;u&&sh(u,g)<0;)n(u,null),u=a.getNext();u&&u.isEqual(g)&&(n(u,h),u=a.hasNext()?a.getNext():null),u?f.$(Dr(u)):f.done()}).next(()=>{for(;u;)n(u,null),u=a.hasNext()?a.getNext():null})}getDocumentsMatchingQuery(e,t,n,i,s){const a=t.path,u=[a.popLast().toArray(),a.lastSegment(),Oi(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],l=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return on(e).U(IDBKeyRange.bound(u,l,!0)).next(h=>{null==s||s.incrementDocumentReadCount(h.length);let f=Ke();for(const g of h){const _=this.ir(L.fromSegments(g.prefixPath.concat(g.collectionGroup,g.documentId)),g);_.isFoundDocument()&&(yr(t,_)||i.has(_.key))&&(f=f.insert(_.key,_))}return f})}getAllFromCollectionGroup(e,t,n,i){let s=Ke();const a=ih(t,n),u=ih(t,Qe.max());return on(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(a,u,!0)},(l,h,f)=>{const g=this.ir(L.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);s=s.insert(g.key,g),s.size===i&&f.done()}).next(()=>s)}newChangeBuffer(e){return new Fg(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return rh(e).get("remoteDocumentGlobalKey").next(t=>(q(!!t),t))}rr(e,t){return rh(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){const n=function Tg(r,e){let t;if(e.document)t=Rc(r.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const n=L.fromSegments(e.noDocument.path),i=en(e.noDocument.readTime);t=le.newNoDocument(n,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return B();{const n=L.fromSegments(e.unknownDocument.path),i=en(e.unknownDocument.version);t=le.newUnknownDocument(n,i)}}return e.readTime&&t.setReadTime(function(i){const s=new de(i[0],i[1]);return K.fromTimestamp(s)}(e.readTime)),t}(this.serializer,t);if(!n.isNoDocument()||!n.version.isEqual(K.min()))return n}return le.newInvalidDocument(e)}}function nh(r){return new kg(r)}class Fg extends th{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new dt(n=>n.toString(),(n,i)=>n.isEqual(i))}applyChanges(e){const t=[];let n=0,i=new ie((s,a)=>Q(s.canonicalString(),a.canonicalString()));return this.changes.forEach((s,a)=>{const u=this.lr.get(s);if(t.push(this.cr.removeEntry(e,s,u.readTime)),a.isValidDocument()){const l=Nc(this.cr.serializer,a);i=i.add(s.path.popLast());const h=qi(l);n+=h-u.size,t.push(this.cr.addEntry(e,s,l))}else if(n-=u.size,this.trackRemovals){const l=Nc(this.cr.serializer,a.convertToNoDocument(K.min()));t.push(this.cr.addEntry(e,s,l))}}),i.forEach(s=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.cr.updateMetadata(e,n)),w.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(n=>(this.lr.set(t,{size:n.size,readTime:n.document.readTime}),n.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:n,ur:i})=>(i.forEach((s,a)=>{this.lr.set(s,{size:a,readTime:n.get(s).readTime})}),n))}}function rh(r){return Ee(r,"remoteDocumentGlobal")}function on(r){return Ee(r,"remoteDocumentsV14")}function Dr(r){const e=r.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function ih(r,e){const t=e.documentKey.path.toArray();return[r,Oi(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function sh(r,e){const t=r.path.toArray(),n=e.path.toArray();let i=0;for(let s=0;s<t.length-2&&s<n.length-2;++s)if(i=Q(t[s],n[s]),i)return i;return i=Q(t.length,n.length),i||(i=Q(t[t.length-2],n[n.length-2]),i||Q(t[t.length-1],n[n.length-1]))}class Mg{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class oh{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(n=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(null!==n&&vr(n.mutation,i,Ge.empty(),de.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,W()).next(()=>n))}getLocalViewOfDocuments(e,t,n=W()){const i=rt();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,n).next(s=>{let a=Ir();return s.forEach((u,l)=>{a=a.insert(u,l.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){const n=rt();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,W()))}populateOverlays(e,t,n){const i=[];return n.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((a,u)=>{t.set(a,u)})})}computeViews(e,t,n,i){let s=Ke();const a=Tr(),u=Tr();return t.forEach((l,h)=>{const f=n.get(h.key);i.has(h.key)&&(void 0===f||f.mutation instanceof ft)?s=s.insert(h.key,h):void 0!==f?(a.set(h.key,f.mutation.getFieldMask()),vr(f.mutation,h,f.mutation.getFieldMask(),de.now())):a.set(h.key,Ge.empty())}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((h,f)=>a.set(h,f)),t.forEach((h,f)=>{var g;return u.set(h,new Mg(f,null!==(g=a.get(h))&&void 0!==g?g:null))}),u))}recalculateAndSaveOverlays(e,t){const n=Tr();let i=new ae((a,u)=>a-u),s=W();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(const u of a)u.keys().forEach(l=>{const h=t.get(l);if(null===h)return;let f=n.get(l)||Ge.empty();f=u.applyToLocalView(h,f),n.set(l,f);const g=(i.get(u.batchId)||W()).add(l);i=i.insert(u.batchId,g)})}).next(()=>{const a=[],u=i.getReverseIterator();for(;u.hasNext();){const l=u.getNext(),h=l.key,f=l.value,g=Hl();f.forEach(_=>{if(!s.has(_)){const R=rc(t.get(_),n.get(_));null!==R&&g.set(_,R),s=s.add(_)}}),a.push(this.documentOverlayCache.saveOverlays(e,h,g))}return w.waitFor(a)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,i){return L.isDocumentKey((a=t).path)&&null===a.collectionGroup&&0===a.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):eo(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,i):this.getDocumentsMatchingCollectionQuery(e,t,n,i);var a}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next(s=>{const a=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-s.size):w.resolve(rt());let u=-1,l=s;return a.next(h=>w.forEach(h,(f,g)=>(u<g.largestBatchId&&(u=g.largestBatchId),s.get(f)?w.resolve():this.remoteDocumentCache.getEntry(e,f).next(_=>{l=l.insert(f,_)}))).next(()=>this.populateOverlays(e,h,s)).next(()=>this.computeViews(e,l,h,W())).next(f=>({batchId:u,changes:Wl(f)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new L(t)).next(n=>{let i=Ir();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,n,i){const s=t.collectionGroup;let a=Ir();return this.indexManager.getCollectionParents(e,s).next(u=>w.forEach(u,l=>{const h=(g=t,_=l.child(s),new ht(_,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt));var g,_;return this.getDocumentsMatchingCollectionQuery(e,h,n,i).next(f=>{f.forEach((g,_)=>{a=a.insert(g,_)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,n,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,s,i))).next(a=>{s.forEach((l,h)=>{const f=h.getKey();null===a.get(f)&&(a=a.insert(f,le.newInvalidDocument(f)))});let u=Ir();return a.forEach((l,h)=>{const f=s.get(l);void 0!==f&&vr(f.mutation,h,Ge.empty(),de.now()),yr(t,h)&&(u=u.insert(l,h))}),u})}}class Og{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return w.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,{id:(i=t).id,version:i.version,createTime:Ie(i.createTime)}),w.resolve();var i}getNamedQuery(e,t){return w.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,{name:(i=t).name,query:go(i.bundledQuery),readTime:Ie(i.readTime)}),w.resolve();var i}}class Lg{constructor(){this.overlays=new ae(L.comparator),this.Ir=new Map}getOverlay(e,t){return w.resolve(this.overlays.get(t))}getOverlays(e,t){const n=rt();return w.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((i,s)=>{this.ht(e,t,s)}),w.resolve()}removeOverlaysForBatchId(e,t,n){const i=this.Ir.get(n);return void 0!==i&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.Ir.delete(n)),w.resolve()}getOverlaysForCollection(e,t,n){const i=rt(),s=t.length+1,a=new L(t.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){const l=u.getNext().value,h=l.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===s&&l.largestBatchId>n&&i.set(l.getKey(),l)}return w.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let s=new ae((h,f)=>h-f);const a=this.overlays.getIterator();for(;a.hasNext();){const h=a.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>n){let f=s.get(h.largestBatchId);null===f&&(f=rt(),s=s.insert(h.largestBatchId,f)),f.set(h.getKey(),h)}}const u=rt(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((h,f)=>u.set(h,f)),!(u.size()>=i)););return w.resolve(u)}ht(e,t,n){const i=this.overlays.get(n.key);if(null!==i){const a=this.Ir.get(i.largestBatchId).delete(n.key);this.Ir.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new ao(t,n));let s=this.Ir.get(t);void 0===s&&(s=W(),this.Ir.set(t,s)),this.Ir.set(t,s.add(n.key))}}class Bg{constructor(){this.sessionToken=pe.EMPTY_BYTE_STRING}getSessionToken(e){return w.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,w.resolve()}}class vo{constructor(){this.Tr=new ie(we.Er),this.dr=new ie(we.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const n=new we(e,t);this.Tr=this.Tr.add(n),this.dr=this.dr.add(n)}Rr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Vr(new we(e,t))}mr(e,t){e.forEach(n=>this.removeReference(n,t))}gr(e){const t=new L(new J([])),n=new we(t,e),i=new we(t,e+1),s=[];return this.dr.forEachInRange([n,i],a=>{this.Vr(a),s.push(a.key)}),s}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new L(new J([])),n=new we(t,e),i=new we(t,e+1);let s=W();return this.dr.forEachInRange([n,i],a=>{s=s.add(a.key)}),s}containsKey(e){const t=new we(e,0),n=this.Tr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class we{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return L.comparator(e.key,t.key)||Q(e.wr,t.wr)}static Ar(e,t){return Q(e.wr,t.wr)||L.comparator(e.key,t.key)}}class Ug{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new ie(we.Er)}checkEmpty(e){return w.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,i){const s=this.Sr;this.Sr++;const a=new so(s,t,n,i);this.mutationQueue.push(a);for(const u of i)this.br=this.br.add(new we(u.key,s)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return w.resolve(a)}lookupMutationBatch(e,t){return w.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const i=this.vr(t+1),s=i<0?0:i;return w.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return w.resolve(0===this.mutationQueue.length?-1:this.Sr-1)}getAllMutationBatches(e){return w.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new we(t,0),i=new we(t,Number.POSITIVE_INFINITY),s=[];return this.br.forEachInRange([n,i],a=>{const u=this.Dr(a.wr);s.push(u)}),w.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new ie(Q);return t.forEach(i=>{const s=new we(i,0),a=new we(i,Number.POSITIVE_INFINITY);this.br.forEachInRange([s,a],u=>{n=n.add(u.wr)})}),w.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1;let s=n;L.isDocumentKey(s)||(s=s.child(""));const a=new we(new L(s),0);let u=new ie(Q);return this.br.forEachWhile(l=>{const h=l.key.path;return!!n.isPrefixOf(h)&&(h.length===i&&(u=u.add(l.wr)),!0)},a),w.resolve(this.Cr(u))}Cr(e){const t=[];return e.forEach(n=>{const i=this.Dr(n);null!==i&&t.push(i)}),t}removeMutationBatch(e,t){q(0===this.Fr(t.batchId,"removed")),this.mutationQueue.shift();let n=this.br;return w.forEach(t.mutations,i=>{const s=new we(i.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.br=n})}On(e){}containsKey(e,t){const n=new we(t,0),i=this.br.firstAfterOrEqual(n);return w.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return w.resolve()}Fr(e,t){return this.vr(e)}vr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class qg{constructor(e){this.Mr=e,this.docs=new ae(L.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,i=this.docs.get(n),s=i?i.size:0,a=this.Mr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return w.resolve(n?n.document.mutableCopy():le.newInvalidDocument(t))}getEntries(e,t){let n=Ke();return t.forEach(i=>{const s=this.docs.get(i);n=n.insert(i,s?s.document.mutableCopy():le.newInvalidDocument(i))}),w.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let s=Ke();const a=t.path,u=new L(a.child("")),l=this.docs.getIteratorFrom(u);for(;l.hasNext();){const{key:h,value:{document:f}}=l.getNext();if(!a.isPrefixOf(h.path))break;h.path.length>a.length+1||Ks(rl(f),n)<=0||(i.has(f.key)||yr(t,f))&&(s=s.insert(f.key,f.mutableCopy()))}return w.resolve(s)}getAllFromCollectionGroup(e,t,n,i){B()}Or(e,t){return w.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new Gg(this)}getSize(e){return w.resolve(this.size)}}class Gg extends th{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?t.push(this.cr.addEntry(e,i)):this.cr.removeEntry(n)}),w.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}class Kg{constructor(e){this.persistence=e,this.Nr=new dt(t=>Jt(t),pr),this.lastRemoteSnapshotVersion=K.min(),this.highestTargetId=0,this.Lr=0,this.Br=new vo,this.targetCount=0,this.kr=sn.Bn()}forEachTarget(e,t){return this.Nr.forEach((n,i)=>t(i)),w.resolve()}getLastRemoteSnapshotVersion(e){return w.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return w.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),w.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Lr&&(this.Lr=t),w.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new sn(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,w.resolve()}updateTargetData(e,t){return this.Kn(t),w.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,w.resolve()}removeTargets(e,t,n){let i=0;const s=[];return this.Nr.forEach((a,u)=>{u.sequenceNumber<=t&&null===n.get(u.targetId)&&(this.Nr.delete(a),s.push(this.removeMatchingKeysForTargetId(e,u.targetId)),i++)}),w.waitFor(s).next(()=>i)}getTargetCount(e){return w.resolve(this.targetCount)}getTargetData(e,t){const n=this.Nr.get(t)||null;return w.resolve(n)}addMatchingKeys(e,t,n){return this.Br.Rr(t,n),w.resolve()}removeMatchingKeys(e,t,n){this.Br.mr(t,n);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(a=>{s.push(i.markPotentiallyOrphaned(e,a))}),w.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),w.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Br.yr(t);return w.resolve(n)}containsKey(e,t){return w.resolve(this.Br.containsKey(t))}}class Ao{constructor(e,t){this.qr={},this.overlays={},this.Qr=new $e(0),this.Kr=!1,this.Kr=!0,this.$r=new Bg,this.referenceDelegate=e(this),this.Ur=new Kg(this),this.indexManager=new Sg,this.remoteDocumentCache=new qg(n=>this.referenceDelegate.Wr(n)),this.serializer=new Dc(t),this.Gr=new Og(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Lg,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.qr[e.toKey()];return n||(n=new Ug(t,this.referenceDelegate),this.qr[e.toKey()]=n),n}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,n){N("MemoryPersistence","Starting transaction:",e);const i=new jg(this.Qr.next());return this.referenceDelegate.zr(),n(i).next(s=>this.referenceDelegate.jr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Hr(e,t){return w.or(Object.values(this.qr).map(n=>()=>n.containsKey(e,t)))}}class jg extends sl{constructor(e){super(),this.currentSequenceNumber=e}}class ji{constructor(e){this.persistence=e,this.Jr=new vo,this.Yr=null}static Zr(e){return new ji(e)}get Xr(){if(this.Yr)return this.Yr;throw B()}addReference(e,t,n){return this.Jr.addReference(n,t),this.Xr.delete(n.toString()),w.resolve()}removeReference(e,t,n){return this.Jr.removeReference(n,t),this.Xr.add(n.toString()),w.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),w.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(i=>this.Xr.add(i.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Xr.add(s.toString()))}).next(()=>n.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return w.forEach(this.Xr,n=>{const i=L.fromPath(n);return this.ei(e,i).next(s=>{s||t.removeEntry(i,K.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(n=>{n?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return w.or([()=>w.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}class zg{constructor(e){this.serializer=e}O(e,t,n,i){const s=new Ii("createOrUpgrade",t);var l;n<1&&i>=1&&(e.createObjectStore("owner"),(l=e).createObjectStore("mutationQueues",{keyPath:"userId"}),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",cl,{unique:!0}),l.createObjectStore("documentMutations"),ah(e),function(l){l.createObjectStore("remoteDocuments")}(e));let a=w.resolve();return n<3&&i>=3&&(0!==n&&(function(l){l.deleteObjectStore("targetDocuments"),l.deleteObjectStore("targets"),l.deleteObjectStore("targetGlobal")}(e),ah(e)),a=a.next(()=>function(l){const h=l.store("targetGlobal"),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:K.min().toTimestamp(),targetCount:0};return h.put("targetGlobalKey",f)}(s))),n<4&&i>=4&&(0!==n&&(a=a.next(()=>function(l,h){return h.store("mutations").U().next(f=>{l.deleteObjectStore("mutations"),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",cl,{unique:!0});const g=h.store("mutations"),_=f.map(R=>g.put(R));return w.waitFor(_)})}(e,s))),a=a.next(()=>{!function(l){l.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),n<5&&i>=5&&(a=a.next(()=>this.ni(s))),n<6&&i>=6&&(a=a.next(()=>(function(l){l.createObjectStore("remoteDocumentGlobal")}(e),this.ri(s)))),n<7&&i>=7&&(a=a.next(()=>this.ii(s))),n<8&&i>=8&&(a=a.next(()=>this.si(e,s))),n<9&&i>=9&&(a=a.next(()=>{!function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")}(e)})),n<10&&i>=10&&(a=a.next(()=>this.oi(s))),n<11&&i>=11&&(a=a.next(()=>{(function(l){l.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(l){l.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),n<12&&i>=12&&(a=a.next(()=>{!function(l){const h=l.createObjectStore("documentOverlays",{keyPath:Sm});h.createIndex("collectionPathOverlayIndex",bm,{unique:!1}),h.createIndex("collectionGroupOverlayIndex",xm,{unique:!1})}(e)})),n<13&&i>=13&&(a=a.next(()=>function(l){const h=l.createObjectStore("remoteDocumentsV14",{keyPath:_m});h.createIndex("documentKeyIndex",ym),h.createIndex("collectionGroupIndex",Im)}(e)).next(()=>this._i(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),n<14&&i>=14&&(a=a.next(()=>this.ai(e,s))),n<15&&i>=15&&(a=a.next(()=>function(l){l.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),l.createObjectStore("indexState",{keyPath:wm}).createIndex("sequenceNumberIndex",Rm,{unique:!1}),l.createObjectStore("indexEntries",{keyPath:Pm}).createIndex("documentKeyIndex",Vm,{unique:!1})}(e))),n<16&&i>=16&&(a=a.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),n<17&&i>=17&&(a=a.next(()=>{!function(l){l.createObjectStore("globals",{keyPath:"name"})}(e)})),a}ri(e){let t=0;return e.store("remoteDocuments").J((n,i)=>{t+=qi(i)}).next(()=>{const n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)})}ni(e){const t=e.store("mutationQueues"),n=e.store("mutations");return t.U().next(i=>w.forEach(i,s=>{const a=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return n.U("userMutationsIndex",a).next(u=>w.forEach(u,l=>{q(l.userId===s.userId);const h=tn(this.serializer,l);return Wc(e,s.userId,h).next(()=>{})}))}))}ii(e){const t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const s=[];return n.J((a,u)=>{const l=new J(a),h=[0,xe(l)];s.push(t.get(h).next(f=>f?w.resolve():t.put({targetId:0,path:xe(l),sequenceNumber:i.highestListenSequenceNumber})))}).next(()=>w.waitFor(s))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:Am});const n=t.store("collectionParents"),i=new Eo,s=a=>{if(i.add(a)){const u=a.lastSegment(),l=a.popLast();return n.put({collectionId:u,parent:xe(l)})}};return t.store("remoteDocuments").J({H:!0},(a,u)=>{const l=new J(a);return s(l.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([a,u,l],h)=>{const f=tt(u);return s(f.popLast())}))}oi(e){const t=e.store("targets");return t.J((n,i)=>{const s=Sr(i),a=kc(this.serializer,s);return t.put(a)})}_i(e,t){const n=t.store("remoteDocuments"),i=[];return n.J((s,a)=>{const u=t.store("remoteDocumentsV14"),l=(g=a,g.document?new L(J.fromString(g.document.name).popFirst(5)):g.noDocument?L.fromSegments(g.noDocument.path):g.unknownDocument?L.fromSegments(g.unknownDocument.path):B()).path.toArray(),h={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};var g;i.push(u.put(h))}).next(()=>w.waitFor(i))}ai(e,t){const n=t.store("mutations"),i=nh(this.serializer),s=new Ao(ji.Zr,this.serializer.ct);return n.U().next(a=>{const u=new Map;return a.forEach(l=>{var h;let f=null!==(h=u.get(l.userId))&&void 0!==h?h:W();tn(this.serializer,l).keys().forEach(g=>f=f.add(g)),u.set(l.userId,f)}),w.forEach(u,(l,h)=>{const f=new ve(h),g=Li.lt(this.serializer,f),_=s.getIndexManager(f),R=Gi.lt(f,this.serializer,_,s.referenceDelegate);return new oh(i,R,g,_).recalculateAndSaveOverlaysForDocumentKeys(new $s(t,$e.oe),l).next()})})}}function ah(r){r.createObjectStore("targetDocuments",{keyPath:Em}).createIndex("documentTargetsIndex",vm,{unique:!0}),r.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Tm,{unique:!0}),r.createObjectStore("targetGlobal")}const wo="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Ro{constructor(e,t,n,i,s,a,u,l,h,f,g=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.ui=s,this.window=a,this.document=u,this.ci=h,this.li=f,this.hi=g,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=_=>Promise.resolve(),!Ro.D())throw new C(V.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Ng(this,i),this.Ai=t+"main",this.serializer=new Dc(l),this.Ri=new et(this.Ai,this.hi,new zg(this.serializer)),this.$r=new vg,this.Ur=new xg(this.referenceDelegate,this.serializer),this.remoteDocumentCache=nh(this.serializer),this.Gr=new Eg,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,!1===f&&ye("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new C(V.FAILED_PRECONDITION,wo);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new $e(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){var t=this;return this.di=function(){var n=(0,b.A)(function*(i){if(t.started)return e(i)});return function(i){return n.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(function(){var t=(0,b.A)(function*(n){null===n.newVersion&&(yield e())});return function(n){return t.apply(this,arguments)}}())}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget((0,b.A)(function*(){t.started&&(yield t.mi())})))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Qi(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(At(e))return N("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return N("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return Nr(e).get("owner").next(t=>w.resolve(this.vi(t)))}Ci(e){return Qi(e).delete(this.clientId)}Fi(){var e=this;return(0,b.A)(function*(){if(e.isPrimary&&!e.Mi(e.Ei,18e5)){e.Ei=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",n=>{const i=Ee(n,"clientMetadata");return i.U().next(s=>{const a=e.xi(s,18e5),u=s.filter(l=>-1===a.indexOf(l));return w.forEach(u,l=>i.delete(l.clientId)).next(()=>u)})}).catch(()=>[]);if(e.Vi)for(const n of t)e.Vi.removeItem(e.Oi(n.clientId))}})()}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?w.resolve(!0):Nr(e).get("owner").next(t=>{if(null!==t&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new C(V.FAILED_PRECONDITION,wo);return!1}}return!(!this.networkEnabled||!this.inForeground)||Qi(e).U().next(n=>void 0===this.xi(n,5e3).find(i=>!(this.clientId===i.clientId||!(!this.networkEnabled&&i.networkEnabled||!this.inForeground&&i.inForeground&&this.networkEnabled===i.networkEnabled))))}).next(t=>(this.isPrimary!==t&&N("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,b.A)(function*(){e.Kr=!1,e.Li(),e.Ti&&(e.Ti.cancel(),e.Ti=null),e.Bi(),e.ki(),yield e.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{const n=new $s(t,$e.oe);return e.bi(n).next(()=>e.Ci(n))}),e.Ri.close(),e.qi()})()}xi(e,t){return e.filter(n=>this.Mi(n.updateTimeMs,t)&&!this.Ni(n.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>Qi(e).U().next(t=>this.xi(t,18e5).map(n=>n.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return Gi.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new bg(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return Li.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,n){N("IndexedDbPersistence","Starting transaction:",e);const i="readonly"===t?"readonly":"readwrite",s=17===(l=this.hi)?Nm:16===l?Dm:15===l?Qs:14===l?ml:13===l?fl:12===l?Cm:11===l?dl:void B();var l;let a;return this.Ri.runTransaction(e,i,s,u=>(a=new $s(u,this.Qr?this.Qr.next():$e.oe),"readwrite-primary"===t?this.wi(a).next(l=>!!l||this.Si(a)).next(l=>{if(!l)throw ye(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new C(V.FAILED_PRECONDITION,il);return n(a)}).next(l=>this.Di(a).next(()=>l)):this.Ki(a).next(()=>n(a)))).then(u=>(a.raiseOnCommittedEvent(),u))}Ki(e){return Nr(e).get("owner").next(t=>{if(null!==t&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new C(V.FAILED_PRECONDITION,wo)})}Di(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Nr(e).put("owner",t)}static D(){return et.D()}bi(e){const t=Nr(e);return t.get("owner").next(n=>this.vi(n)?(N("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):w.resolve())}Mi(e,t){const n=Date.now();return!(e<n-t||e>n&&(ye(`Detected an update time that is in the future: ${e} > ${n}`),1))}fi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground="visible"===this.document.visibilityState)}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Pi=()=>{this.Li();const t=/(?:Version|Mobile)\/1[456]/;(0,ne.nr)()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{const n=null!==(null===(t=this.Vi)||void 0===t?void 0:t.getItem(this.Oi(e)));return N("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(n){return ye("IndexedDbPersistence","Failed to get zombied client id.",n),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){ye("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Nr(r){return Ee(r,"owner")}function Qi(r){return Ee(r,"clientMetadata")}function Po(r,e){let t=r.projectId;return r.isDefaultDatabase||(t+="."+r.database),"firestore/"+e+"/"+t+"/"}class Vo{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.$i=n,this.Ui=i}static Wi(e,t){let n=W(),i=W();for(const s of t.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new Vo(e,t.fromCache,n,i)}}class Qg{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class uh{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=(0,ne.nr)()?8:ol((0,ne.ZQ)())>0?6:4}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,n,i){const s={result:null};return this.Yi(e,t).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.Zi(e,t,i,n).next(a=>{s.result=a})}).next(()=>{if(s.result)return;const a=new Qg;return this.Xi(e,t,a).next(u=>{if(s.result=u,this.zi)return this.es(e,t,a,u.size)})}).next(()=>s.result)}es(e,t,n,i){return n.documentReadCount<this.ji?(In()<=Ze.$b.DEBUG&&N("QueryEngine","SDK will not create cache indexes for query:",Sn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),w.resolve()):(In()<=Ze.$b.DEBUG&&N("QueryEngine","Query:",Sn(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.Hi*i?(In()<=Ze.$b.DEBUG&&N("QueryEngine","The SDK decides to create cache indexes for query:",Sn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ce(t))):w.resolve())}Yi(e,t){if(ql(t))return w.resolve(null);let n=Ce(t);return this.indexManager.getIndexType(e,n).next(i=>0===i?null:(null!==t.limit&&1===i&&(t=xi(t,null,"F"),n=Ce(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(s=>{const a=W(...s);return this.Ji.getDocuments(e,a).next(u=>this.indexManager.getMinOffset(e,n).next(l=>{const h=this.ts(t,u);return this.ns(t,h,a,l.readTime)?this.Yi(e,xi(t,null,"F")):this.rs(e,h,t,l)}))})))}Zi(e,t,n,i){return ql(t)||i.isEqual(K.min())?w.resolve(null):this.Ji.getDocuments(e,n).next(s=>{const a=this.ts(t,s);return this.ns(t,a,n,i)?w.resolve(null):(In()<=Ze.$b.DEBUG&&N("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Sn(t)),this.rs(e,a,t,nl(i,-1)).next(u=>u))})}ts(e,t){let n=new ie(Ql(e));return t.forEach((i,s)=>{yr(e,s)&&(n=n.add(s))}),n}ns(e,t,n,i){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Xi(e,t,n){return In()<=Ze.$b.DEBUG&&N("QueryEngine","Using full collection scan to execute query:",Sn(t)),this.Ji.getDocumentsMatchingQuery(e,t,Qe.min(),n)}rs(e,t,n,i){return this.Ji.getDocumentsMatchingQuery(e,n,i).next(s=>(t.forEach(a=>{s=s.insert(a.key,a)}),s))}}class $g{constructor(e,t,n,i){this.persistence=e,this.ss=t,this.serializer=i,this.os=new ae(Q),this._s=new dt(s=>Jt(s),pr),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(n)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new oh(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function lh(r,e,t,n){return new $g(r,e,t,n)}function ch(r,e){return So.apply(this,arguments)}function So(){return(So=(0,b.A)(function*(r,e){const t=M(r);return yield t.persistence.runTransaction("Handle user change","readonly",n=>{let i;return t.mutationQueue.getAllMutationBatches(n).next(s=>(i=s,t.ls(e),t.mutationQueue.getAllMutationBatches(n))).next(s=>{const a=[],u=[];let l=W();for(const h of i){a.push(h.batchId);for(const f of h.mutations)l=l.add(f.key)}for(const h of s){u.push(h.batchId);for(const f of h.mutations)l=l.add(f.key)}return t.localDocuments.getDocuments(n,l).next(h=>({hs:h,removedBatchIds:a,addedBatchIds:u}))})})})).apply(this,arguments)}function hh(r){const e=M(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function dh(r,e,t){let n=W(),i=W();return t.forEach(s=>n=n.add(s)),e.getEntries(r,n).next(s=>{let a=Ke();return t.forEach((u,l)=>{const h=s.get(u);l.isFoundDocument()!==h.isFoundDocument()&&(i=i.add(u)),l.isNoDocument()&&l.version.isEqual(K.min())?(e.removeEntry(u,l.readTime),a=a.insert(u,l)):!h.isValidDocument()||l.version.compareTo(h.version)>0||0===l.version.compareTo(h.version)&&h.hasPendingWrites?(e.addEntry(l),a=a.insert(u,l)):N("LocalStore","Ignoring outdated watch update for ",u,". Current version:",h.version," Watch version:",l.version)}),{Ps:a,Is:i}})}function Jg(r,e){const t=M(r);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function Bn(r,e){const t=M(r);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let i;return t.Ur.getTargetData(n,e).next(s=>s?(i=s,w.resolve(i)):t.Ur.allocateTargetId(n).next(a=>(i=new mt(e,a,"TargetPurposeListen",n.currentSequenceNumber),t.Ur.addTargetData(n,i).next(()=>i))))}).then(n=>{const i=t.os.get(n.targetId);return(null===i||n.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.os=t.os.insert(n.targetId,n),t._s.set(e,n.targetId)),n})}function Un(r,e,t){return bo.apply(this,arguments)}function bo(){return(bo=(0,b.A)(function*(r,e,t){const n=M(r),i=n.os.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield n.persistence.runTransaction("Release target",s,a=>n.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(!At(a))throw a;N("LocalStore",`Failed to update sequence numbers for target ${e}: ${a}`)}n.os=n.os.remove(e),n._s.delete(i.target)})).apply(this,arguments)}function $i(r,e,t){const n=M(r);let i=K.min(),s=W();return n.persistence.runTransaction("Execute query","readwrite",a=>function(l,h,f){const g=M(l),_=g._s.get(f);return void 0!==_?w.resolve(g.os.get(_)):g.Ur.getTargetData(h,f)}(n,a,Ce(e)).next(u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,n.Ur.getMatchingKeysForTargetId(a,u.targetId).next(l=>{s=l})}).next(()=>n.ss.getDocumentsMatchingQuery(a,e,t?i:K.min(),t?s:W())).next(u=>(gh(n,zl(e),u),{documents:u,Ts:s})))}function fh(r,e){const t=M(r),n=M(t.Ur),i=t.os.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>n.ot(s,e).next(a=>a?a.target:null))}function mh(r,e){const t=M(r),n=t.us.get(e)||K.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.cs.getAllFromCollectionGroup(i,e,nl(n,-1),Number.MAX_SAFE_INTEGER)).then(i=>(gh(t,e,i),i))}function gh(r,e,t){let n=r.us.get(e)||K.min();t.forEach((i,s)=>{s.readTime.compareTo(n)>0&&(n=s.readTime)}),r.us.set(e,n)}function xo(){return(xo=(0,b.A)(function*(r,e,t,n){const i=M(r);let s=W(),a=Ke();for(const h of t){const f=e.Es(h.metadata.name);h.document&&(s=s.add(f));const g=e.ds(h);g.setReadTime(e.As(h.metadata.readTime)),a=a.insert(f,g)}const u=i.cs.newChangeBuffer({trackRemovals:!0}),l=yield Bn(i,(f=n,Ce(Pn(J.fromString(`__bundle__/docs/${f}`)))));var f;return i.persistence.runTransaction("Apply bundle documents","readwrite",h=>dh(h,u,a).next(f=>(u.apply(h),f)).next(f=>i.Ur.removeMatchingKeysForTargetId(h,l.targetId).next(()=>i.Ur.addMatchingKeys(h,s,l.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(h,f.Ps,f.Is)).next(()=>f.Ps)))})).apply(this,arguments)}function Xg(r,e){return Co.apply(this,arguments)}function Co(){return(Co=(0,b.A)(function*(r,e,t=W()){const n=yield Bn(r,Ce(go(e.bundledQuery))),i=M(r);return i.persistence.runTransaction("Save named query","readwrite",s=>{const a=Ie(e.readTime);if(n.snapshotVersion.compareTo(a)>=0)return i.Gr.saveNamedQuery(s,e);const u=n.withResumeToken(pe.EMPTY_BYTE_STRING,a);return i.os=i.os.insert(u.targetId,u),i.Ur.updateTargetData(s,u).next(()=>i.Ur.removeMatchingKeysForTargetId(s,n.targetId)).next(()=>i.Ur.addMatchingKeys(s,t,n.targetId)).next(()=>i.Gr.saveNamedQuery(s,e))})})).apply(this,arguments)}function ph(r,e){return`firestore_clients_${r}_${e}`}function _h(r,e,t){let n=`firestore_mutations_${r}_${t}`;return e.isAuthenticated()&&(n+=`_${e.uid}`),n}function Do(r,e){return`firestore_targets_${r}_${e}`}class Wi{constructor(e,t,n,i){this.user=e,this.batchId=t,this.state=n,this.error=i}static Rs(e,t,n){const i=JSON.parse(n);let s,a="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return a&&i.error&&(a="string"==typeof i.error.message&&"string"==typeof i.error.code,a&&(s=new C(i.error.code,i.error.message))),a?new Wi(e,t,i.state,s):(ye("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class kr{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Rs(e,t){const n=JSON.parse(t);let i,s="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return s&&n.error&&(s="string"==typeof n.error.message&&"string"==typeof n.error.code,s&&(i=new C(n.error.code,n.error.message))),s?new kr(e,n.state,i):(ye("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Hi{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){const n=JSON.parse(t);let i="object"==typeof n&&n.activeTargetIds instanceof Array,s=no();for(let a=0;i&&a<n.activeTargetIds.length;++a)i=ul(n.activeTargetIds[a]),s=s.add(n.activeTargetIds[a]);return i?new Hi(e,s):(ye("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class No{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new No(t.clientId,t.onlineState):(ye("SharedClientState",`Failed to parse online state: ${e}`),null)}}class ko{constructor(){this.activeTargetIds=no()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Fo{constructor(e,t,n,i,s){this.window=e,this.ui=t,this.persistenceKey=n,this.ps=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new ae(Q),this.started=!1,this.bs=[];const a=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Ds=ph(this.persistenceKey,this.ps),this.vs=`firestore_sequence_number_${this.persistenceKey}`,this.Ss=this.Ss.insert(this.ps,new ko),this.Cs=new RegExp(`^firestore_clients_${a}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${a}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${a}_(\\d+)$`),this.xs=`firestore_online_state_${this.persistenceKey}`,this.Os=function(l){return`firestore_bundle_loaded_v2_${l}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,b.A)(function*(){const t=yield e.syncEngine.Qi();for(const i of t){if(i===e.ps)continue;const s=e.getItem(ph(e.persistenceKey,i));if(s){const a=Hi.Rs(i,s);a&&(e.Ss=e.Ss.insert(a.clientId,a))}}e.Ns();const n=e.storage.getItem(e.xs);if(n){const i=e.Ls(n);i&&e.Bs(i)}for(const i of e.bs)e.ws(i);e.bs=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((n,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,n){this.qs(e,t,n),this.Qs(e)}addLocalQueryTarget(e,t=!0){let n="not-current";if(this.isActiveQueryTarget(e)){const i=this.storage.getItem(Do(this.persistenceKey,e));if(i){const s=kr.Rs(e,i);s&&(n=s.state)}}return t&&this.Ks.fs(e),this.Ns(),n}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Do(this.persistenceKey,e))}updateQueryState(e,t,n){this.$s(e,t,n)}handleUserChange(e,t,n){t.forEach(i=>{this.Qs(i)}),this.currentUser=e,n.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return N("SharedClientState","READ",e,t),t}setItem(e,t){N("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){N("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){var t=this;const n=e;if(n.storageArea===this.storage){if(N("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Ds)return void ye("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable((0,b.A)(function*(){if(t.started){if(null!==n.key)if(t.Cs.test(n.key)){if(null==n.newValue){const i=t.Gs(n.key);return t.zs(i,null)}{const i=t.js(n.key,n.newValue);if(i)return t.zs(i.clientId,i)}}else if(t.Fs.test(n.key)){if(null!==n.newValue){const i=t.Hs(n.key,n.newValue);if(i)return t.Js(i)}}else if(t.Ms.test(n.key)){if(null!==n.newValue){const i=t.Ys(n.key,n.newValue);if(i)return t.Zs(i)}}else if(n.key===t.xs){if(null!==n.newValue){const i=t.Ls(n.newValue);if(i)return t.Bs(i)}}else if(n.key===t.vs){const i=function(a){let u=$e.oe;if(null!=a)try{const l=JSON.parse(a);q("number"==typeof l),u=l}catch(l){ye("SharedClientState","Failed to read sequence number from WebStorage",l)}return u}(n.newValue);i!==$e.oe&&t.sequenceNumberHandler(i)}else if(n.key===t.Os){const i=t.Xs(n.newValue);yield Promise.all(i.map(s=>t.syncEngine.eo(s)))}}else t.bs.push(n)}))}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,n){const i=new Wi(this.currentUser,e,t,n),s=_h(this.persistenceKey,this.currentUser,e);this.setItem(s,i.Vs())}Qs(e){const t=_h(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){this.storage.setItem(this.xs,JSON.stringify({clientId:this.ps,onlineState:e}))}$s(e,t,n){const i=Do(this.persistenceKey,e),s=new kr(e,t,n);this.setItem(i,s.Vs())}Ws(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){const t=this.Cs.exec(e);return t?t[1]:null}js(e,t){const n=this.Gs(e);return Hi.Rs(n,t)}Hs(e,t){const n=this.Fs.exec(e),i=Number(n[1]);return Wi.Rs(new ve(void 0!==n[2]?n[2]:null),i,t)}Ys(e,t){const n=this.Ms.exec(e),i=Number(n[1]);return kr.Rs(i,t)}Ls(e){return No.Rs(e)}Xs(e){return JSON.parse(e)}Js(e){var t=this;return(0,b.A)(function*(){if(e.user.uid===t.currentUser.uid)return t.syncEngine.no(e.batchId,e.state,e.error);N("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){const n=t?this.Ss.insert(e,t):this.Ss.remove(e),i=this.ks(this.Ss),s=this.ks(n),a=[],u=[];return s.forEach(l=>{i.has(l)||a.push(l)}),i.forEach(l=>{s.has(l)||u.push(l)}),this.syncEngine.io(a,u).then(()=>{this.Ss=n})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=no();return e.forEach((n,i)=>{t=t.unionWith(i.activeTargetIds)}),t}}class yh{constructor(){this.so=new ko,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,n){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new ko,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Zg{_o(e){}shutdown(){}}class Ih{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){N("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){N("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Ji=null;function Mo(){return null===Ji?Ji=268435456+Math.round(2147483648*Math.random()):Ji++,"0x"+Ji.toString(16)}const ep={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class tp{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}const Ne="WebChannelConnection";class np extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const n=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Do=n+"://"+t.host,this.vo=`projects/${i}/databases/${s}`,this.Co="(default)"===this.databaseId.database?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get Fo(){return!1}Mo(t,n,i,s,a){const u=Mo(),l=this.xo(t,n.toUriEncodedString());N("RestConnection",`Sending RPC '${t}' ${u}:`,l,i);const h={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(h,s,a),this.No(t,l,h,i).then(f=>(N("RestConnection",`Received RPC '${t}' ${u}: `,f),f),f=>{throw ze("RestConnection",`RPC '${t}' ${u} failed with error: `,f,"url: ",l,"request:",i),f})}Lo(t,n,i,s,a,u){return this.Mo(t,n,i,s,a)}Oo(t,n,i){t["X-Goog-Api-Client"]="gl-js/ fire/"+yn,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((s,a)=>t[a]=s),i&&i.headers.forEach((s,a)=>t[a]=s)}xo(t,n){return`${this.Do}/v1/${n}:${ep[t]}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,n,i){const s=Mo();return new Promise((a,u)=>{const l=new Qu;l.setWithCredentials(!0),l.listenOnce($u.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case yi.NO_ERROR:const f=l.getResponseJson();N(Ne,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(f)),a(f);break;case yi.TIMEOUT:N(Ne,`RPC '${e}' ${s} timed out`),u(new C(V.DEADLINE_EXCEEDED,"Request time out"));break;case yi.HTTP_ERROR:const g=l.getStatus();if(N(Ne,`RPC '${e}' ${s} failed with status:`,g,"response text:",l.getResponseText()),g>0){let _=l.getResponseJson();Array.isArray(_)&&(_=_[0]);const R=null==_?void 0:_.error;if(R&&R.status&&R.message){const x=function(D){const U=D.toLowerCase().replace(/_/g,"-");return Object.values(V).indexOf(U)>=0?U:V.UNKNOWN}(R.status);u(new C(x,R.message))}else u(new C(V.UNKNOWN,"Server responded with status "+l.getStatus()))}else u(new C(V.UNAVAILABLE,"Connection failed."));break;default:B()}}finally{N(Ne,`RPC '${e}' ${s} completed.`)}});const h=JSON.stringify(i);N(Ne,`RPC '${e}' ${s} sending request:`,i),l.send(t,"POST",h,n,15)})}Bo(e,t,n){const i=Mo(),s=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=Ju(),u=Hu(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;void 0!==h&&(l.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Oo(l.initMessageHeaders,t,n),l.encodeInitMessageHeaders=!0;const f=s.join("");N(Ne,`Creating RPC '${e}' stream ${i}: ${f}`,l);const g=a.createWebChannel(f,l);let _=!1,R=!1;const x=new tp({Io:D=>{R?N(Ne,`Not sending because RPC '${e}' stream ${i} is closed:`,D):(_||(N(Ne,`Opening RPC '${e}' stream ${i} transport.`),g.open(),_=!0),N(Ne,`RPC '${e}' stream ${i} sending:`,D),g.send(D))},To:()=>g.close()}),k=(D,U,j)=>{D.listen(U,G=>{try{j(G)}catch(z){setTimeout(()=>{throw z},0)}})};return k(g,or.EventType.OPEN,()=>{R||(N(Ne,`RPC '${e}' stream ${i} transport opened.`),x.yo())}),k(g,or.EventType.CLOSE,()=>{R||(R=!0,N(Ne,`RPC '${e}' stream ${i} transport closed`),x.So())}),k(g,or.EventType.ERROR,D=>{R||(R=!0,ze(Ne,`RPC '${e}' stream ${i} transport errored:`,D),x.So(new C(V.UNAVAILABLE,"The operation could not be completed")))}),k(g,or.EventType.MESSAGE,D=>{var U;if(!R){const j=D.data[0];q(!!j);const z=j.error||(null===(U=j[0])||void 0===U?void 0:U.error);if(z){N(Ne,`RPC '${e}' stream ${i} received error:`,z);const X=z.status;let $=function(I){const E=Te[I];if(void 0!==E)return cc(E)}(X),T=z.message;void 0===$&&($=V.INTERNAL,T="Unknown error status: "+X+" with message "+z.message),R=!0,x.So(new C($,T)),g.close()}else N(Ne,`RPC '${e}' stream ${i} received:`,j),x.bo(j)}}),k(u,Wu.STAT_EVENT,D=>{D.stat===Us.PROXY?N(Ne,`RPC '${e}' stream ${i} detected buffering proxy`):D.stat===Us.NOPROXY&&N(Ne,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{x.wo()},0),x}}function Th(){return typeof window<"u"?window:null}function Yi(){return typeof document<"u"?document:null}function Fr(r){return new cg(r,!0)}class Oo{constructor(e,t,n=1e3,i=1.5,s=6e4){this.ui=e,this.timerId=t,this.ko=n,this.qo=i,this.Qo=s,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),n=Math.max(0,Date.now()-this.Uo),i=Math.max(0,t-n);i>0&&N("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,i,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){null!==this.$o&&(this.$o.skipDelay(),this.$o=null)}cancel(){null!==this.$o&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}class Eh{constructor(e,t,n,i,s,a,u,l){this.ui=e,this.Ho=n,this.Jo=i,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=l,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Oo(e,t)}n_(){return 1===this.state||5===this.state||this.r_()}r_(){return 2===this.state||3===this.state}start(){this.e_=0,4!==this.state?this.auth():this.i_()}stop(){var e=this;return(0,b.A)(function*(){e.n_()&&(yield e.close(0))})()}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&null===this.Zo&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}__(){var e=this;return(0,b.A)(function*(){if(e.r_())return e.close(0)})()}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}close(e,t){var n=this;return(0,b.A)(function*(){n.u_(),n.c_(),n.t_.cancel(),n.Yo++,4!==e?n.t_.reset():t&&t.code===V.RESOURCE_EXHAUSTED?(ye(t.toString()),ye("Using maximum backoff delay to prevent overloading the backend."),n.t_.Wo()):t&&t.code===V.UNAUTHENTICATED&&3!==n.state&&(n.authCredentialsProvider.invalidateToken(),n.appCheckCredentialsProvider.invalidateToken()),null!==n.stream&&(n.l_(),n.stream.close(),n.stream=null),n.state=e,yield n.listener.mo(t)})()}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,i])=>{this.Yo===t&&this.P_(n,i)},n=>{e(()=>{const i=new C(V.UNKNOWN,"Fetching auth token failed: "+n.message);return this.I_(i)})})}P_(e,t){const n=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{n(()=>this.listener.Eo())}),this.stream.Ro(()=>{n(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(i=>{n(()=>this.I_(i))}),this.stream.onMessage(i=>{n(()=>1==++this.e_?this.E_(i):this.onNext(i))})}i_(){var e=this;this.state=5,this.t_.Go((0,b.A)(function*(){e.state=0,e.start()}))}I_(e){return N("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(N("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class rp extends Eh{constructor(e,t,n,i,s,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,a),this.serializer=s}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=function fg(r,e){let t;if("targetChange"in e){const n="NO_CHANGE"===(h=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===h?1:"REMOVE"===h?2:"CURRENT"===h?3:"RESET"===h?4:B(),i=e.targetChange.targetIds||[],s=function(h,f){return h.useProto3Json?(q(void 0===f||"string"==typeof f),pe.fromBase64String(f||"")):(q(void 0===f||f instanceof Buffer||f instanceof Uint8Array),pe.fromUint8Array(f||new Uint8Array))}(r,e.targetChange.resumeToken),a=e.targetChange.cause,u=a&&function(h){const f=void 0===h.code?V.UNKNOWN:cc(h.code);return new C(f,h.message||"")}(a);t=new gc(n,i,s,u||null)}else if("documentChange"in e){const n=e.documentChange,i=it(r,n.document.name),s=Ie(n.document.updateTime),a=n.document.createTime?Ie(n.document.createTime):K.min(),u=new Pe({mapValue:{fields:n.document.fields}}),l=le.newFoundDocument(i,s,a,u);t=new Fi(n.targetIds||[],n.removedTargetIds||[],l.key,l)}else if("documentDelete"in e){const n=e.documentDelete,i=it(r,n.document),s=n.readTime?Ie(n.readTime):K.min(),a=le.newNoDocument(i,s);t=new Fi([],n.removedTargetIds||[],a.key,a)}else if("documentRemove"in e){const n=e.documentRemove,i=it(r,n.document);t=new Fi([],n.removedTargetIds||[],i,null)}else{if(!("filter"in e))return B();{const n=e.filter,{count:i=0,unchangedNames:s}=n,a=new ig(i,s);t=new mc(n.targetId,a)}}var h;return t}(this.serializer,e),n=function(s){if(!("targetChange"in s))return K.min();const a=s.targetChange;return a.targetIds&&a.targetIds.length?K.min():a.readTime?Ie(a.readTime):K.min()}(e);return this.listener.d_(t,n)}A_(e){const t={};t.database=fo(this.serializer),t.addTarget=function(s,a){let u;const l=a.target;if(u=Si(l)?{documents:Pc(s,l)}:{query:Mi(s,l)._t},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=Ic(s,a.resumeToken);const h=lo(s,a.expectedCount);null!==h&&(u.expectedCount=h)}else if(a.snapshotVersion.compareTo(K.min())>0){u.readTime=Nn(s,a.snapshotVersion.toTimestamp());const h=lo(s,a.expectedCount);null!==h&&(u.expectedCount=h)}return u}(this.serializer,e);const n=function gg(r,e){const t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return B()}}(e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);n&&(t.labels=n),this.a_(t)}R_(e){const t={};t.database=fo(this.serializer),t.removeTarget=e,this.a_(t)}}class ip extends Eh{constructor(e,t,n,i,s,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,a),this.serializer=s}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return q(!!e.streamToken),this.lastStreamToken=e.streamToken,q(!e.writeResults||0===e.writeResults.length),this.listener.f_()}onNext(e){q(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=function mg(r,e){return r&&r.length>0?(q(void 0!==e),r.map(t=>function(i,s){let a=Ie(i.updateTime?i.updateTime:s);return a.isEqual(K.min())&&(a=Ie(s)),new tg(a,i.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),n=Ie(e.commitTime);return this.listener.g_(n,t)}p_(){const e={};e.database=fo(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(n=>Vr(this.serializer,n))};this.a_(t)}}class sp extends class{}{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.y_=!1}w_(){if(this.y_)throw new C(V.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,n,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Mo(e,ho(t,n),i,s,a)).catch(s=>{throw"FirebaseError"===s.name?(s.code===V.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new C(V.UNKNOWN,s.toString())})}Lo(e,t,n,i,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,u])=>this.connection.Lo(e,ho(t,n),i,a,u,s)).catch(a=>{throw"FirebaseError"===a.name?(a.code===V.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new C(V.UNKNOWN,a.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class op{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){0===this.S_&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){"Online"===this.state?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,"Online"===e&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(ye(t),this.D_=!1):N("OnlineStateTracker",t)}x_(){null!==this.b_&&(this.b_.cancel(),this.b_=null)}}class ap{constructor(e,t,n,i,s){var a=this;this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=s,this.k_._o(u=>{n.enqueueAndForget((0,b.A)(function*(){var l;kt(a)&&(N("RemoteStore","Restarting streams for network reachability change."),yield(l=(0,b.A)(function*(f){const g=M(f);g.L_.add(4),yield qn(g),g.q_.set("Unknown"),g.L_.delete(4),yield Mr(g)}),function h(f){return l.apply(this,arguments)})(a))}))}),this.q_=new op(n,i)}}function Mr(r){return Lo.apply(this,arguments)}function Lo(){return(Lo=(0,b.A)(function*(r){if(kt(r))for(const e of r.B_)yield e(!0)})).apply(this,arguments)}function qn(r){return Bo.apply(this,arguments)}function Bo(){return(Bo=(0,b.A)(function*(r){for(const e of r.B_)yield e(!1)})).apply(this,arguments)}function Xi(r,e){const t=M(r);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Go(t)?qo(t):jn(t).r_()&&Uo(t,e))}function Gn(r,e){const t=M(r),n=jn(t);t.N_.delete(e),n.r_()&&vh(t,e),0===t.N_.size&&(n.r_()?n.o_():kt(t)&&t.q_.set("Unknown"))}function Uo(r,e){if(r.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(K.min())>0){const t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}jn(r).A_(e)}function vh(r,e){r.Q_.xe(e),jn(r).R_(e)}function qo(r){r.Q_=new og({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>r.N_.get(e)||null,tt:()=>r.datastore.serializer.databaseId}),jn(r).start(),r.q_.v_()}function Go(r){return kt(r)&&!jn(r).n_()&&r.N_.size>0}function kt(r){return 0===M(r).L_.size}function Ah(r){r.Q_=void 0}function up(r){return Ko.apply(this,arguments)}function Ko(){return(Ko=(0,b.A)(function*(r){r.q_.set("Online")})).apply(this,arguments)}function lp(r){return jo.apply(this,arguments)}function jo(){return(jo=(0,b.A)(function*(r){r.N_.forEach((e,t)=>{Uo(r,e)})})).apply(this,arguments)}function cp(r,e){return zo.apply(this,arguments)}function zo(){return(zo=(0,b.A)(function*(r,e){Ah(r),Go(r)?(r.q_.M_(e),qo(r)):r.q_.set("Unknown")})).apply(this,arguments)}function hp(r,e,t){return Qo.apply(this,arguments)}function Qo(){return Qo=(0,b.A)(function*(r,e,t){if(r.q_.set("Online"),e instanceof gc&&2===e.state&&e.cause)try{yield(n=(0,b.A)(function*(s,a){const u=a.cause;for(const l of a.targetIds)s.N_.has(l)&&(yield s.remoteSyncer.rejectListen(l,u),s.N_.delete(l),s.Q_.removeTarget(l))}),function i(s,a){return n.apply(this,arguments)})(r,e)}catch(n){N("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),yield Zi(r,n)}else if(e instanceof Fi?r.Q_.Ke(e):e instanceof mc?r.Q_.He(e):r.Q_.We(e),!t.isEqual(K.min()))try{const n=yield hh(r.localStore);t.compareTo(n)>=0&&(yield function(s,a){const u=s.Q_.rt(a);return u.targetChanges.forEach((l,h)=>{if(l.resumeToken.approximateByteSize()>0){const f=s.N_.get(h);f&&s.N_.set(h,f.withResumeToken(l.resumeToken,a))}}),u.targetMismatches.forEach((l,h)=>{const f=s.N_.get(l);if(!f)return;s.N_.set(l,f.withResumeToken(pe.EMPTY_BYTE_STRING,f.snapshotVersion)),vh(s,l);const g=new mt(f.target,l,h,f.sequenceNumber);Uo(s,g)}),s.remoteSyncer.applyRemoteEvent(u)}(r,t))}catch(n){N("RemoteStore","Failed to raise snapshot:",n),yield Zi(r,n)}var n}),Qo.apply(this,arguments)}function Zi(r,e,t){return $o.apply(this,arguments)}function $o(){return($o=(0,b.A)(function*(r,e,t){if(!At(e))throw e;r.L_.add(1),yield qn(r),r.q_.set("Offline"),t||(t=()=>hh(r.localStore)),r.asyncQueue.enqueueRetryable((0,b.A)(function*(){N("RemoteStore","Retrying IndexedDB access"),yield t(),r.L_.delete(1),yield Mr(r)}))})).apply(this,arguments)}function wh(r,e){return e().catch(t=>Zi(r,t,e))}function Kn(r){return Wo.apply(this,arguments)}function Wo(){return(Wo=(0,b.A)(function*(r){const e=M(r),t=Ft(e);let n=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;dp(e);)try{const i=yield Jg(e.localStore,n);if(null===i){0===e.O_.length&&t.o_();break}n=i.batchId,fp(e,i)}catch(i){yield Zi(e,i)}Rh(e)&&Ph(e)})).apply(this,arguments)}function dp(r){return kt(r)&&r.O_.length<10}function fp(r,e){r.O_.push(e);const t=Ft(r);t.r_()&&t.V_&&t.m_(e.mutations)}function Rh(r){return kt(r)&&!Ft(r).n_()&&r.O_.length>0}function Ph(r){Ft(r).start()}function mp(r){return Ho.apply(this,arguments)}function Ho(){return(Ho=(0,b.A)(function*(r){Ft(r).p_()})).apply(this,arguments)}function gp(r){return Jo.apply(this,arguments)}function Jo(){return(Jo=(0,b.A)(function*(r){const e=Ft(r);for(const t of r.O_)e.m_(t.mutations)})).apply(this,arguments)}function pp(r,e,t){return Yo.apply(this,arguments)}function Yo(){return(Yo=(0,b.A)(function*(r,e,t){const n=r.O_.shift(),i=oo.from(n,e,t);yield wh(r,()=>r.remoteSyncer.applySuccessfulWrite(i)),yield Kn(r)})).apply(this,arguments)}function _p(r,e){return Xo.apply(this,arguments)}function Xo(){return Xo=(0,b.A)(function*(r,e){var t;e&&Ft(r).V_&&(yield(t=(0,b.A)(function*(i,s){if(lc(u=s.code)&&u!==V.ABORTED){const a=i.O_.shift();Ft(i).s_(),yield wh(i,()=>i.remoteSyncer.rejectFailedWrite(a.batchId,s)),yield Kn(i)}var u}),function n(i,s){return t.apply(this,arguments)})(r,e)),Rh(r)&&Ph(r)}),Xo.apply(this,arguments)}function Vh(r,e){return Zo.apply(this,arguments)}function Zo(){return(Zo=(0,b.A)(function*(r,e){const t=M(r);t.asyncQueue.verifyOperationInProgress(),N("RemoteStore","RemoteStore received new credentials");const n=kt(t);t.L_.add(3),yield qn(t),n&&t.q_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),yield Mr(t)})).apply(this,arguments)}function ea(r,e){return ta.apply(this,arguments)}function ta(){return(ta=(0,b.A)(function*(r,e){const t=M(r);e?(t.L_.delete(2),yield Mr(t)):e||(t.L_.add(2),yield qn(t),t.q_.set("Unknown"))})).apply(this,arguments)}function jn(r){return r.K_||(r.K_=function(t,n,i){const s=M(t);return s.w_(),new rp(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Eo:up.bind(null,r),Ro:lp.bind(null,r),mo:cp.bind(null,r),d_:hp.bind(null,r)}),r.B_.push(function(){var e=(0,b.A)(function*(t){t?(r.K_.s_(),Go(r)?qo(r):r.q_.set("Unknown")):(yield r.K_.stop(),Ah(r))});return function(t){return e.apply(this,arguments)}}())),r.K_}function Ft(r){return r.U_||(r.U_=function(t,n,i){const s=M(t);return s.w_(),new ip(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Eo:()=>Promise.resolve(),Ro:mp.bind(null,r),mo:_p.bind(null,r),f_:gp.bind(null,r),g_:pp.bind(null,r)}),r.B_.push(function(){var e=(0,b.A)(function*(t){t?(r.U_.s_(),yield Kn(r)):(yield r.U_.stop(),r.O_.length>0&&(N("RemoteStore",`Stopping write stream with ${r.O_.length} pending writes`),r.O_=[]))});return function(t){return e.apply(this,arguments)}}())),r.U_}class na{constructor(e,t,n,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new Ae,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,s){const a=Date.now()+n,u=new na(e,t,a,i,s);return u.start(n),u}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new C(V.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function zn(r,e){if(ye("AsyncQueue",`${e}: ${r}`),At(r))return new C(V.UNAVAILABLE,`${e}: ${r}`);throw r}class Qn{constructor(e){this.comparator=e?(t,n)=>e(t,n)||L.comparator(t.key,n.key):(t,n)=>L.comparator(t.key,n.key),this.keyedMap=Ir(),this.sortedSet=new ae(this.comparator)}static emptySet(e){return new Qn(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Qn)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=n.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Qn;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Sh{constructor(){this.W_=new ae(L.comparator)}track(e){const t=e.doc.key,n=this.W_.get(t);n?0!==e.type&&3===n.type?this.W_=this.W_.insert(t,e):3===e.type&&1!==n.type?this.W_=this.W_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.W_=this.W_.remove(t):1===e.type&&2===n.type?this.W_=this.W_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):B():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,n)=>{e.push(n)}),e}}class $n{constructor(e,t,n,i,s,a,u,l,h){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=l,this.hasCachedResults=h}static fromInitialDocuments(e,t,n,i,s){const a=[];return t.forEach(u=>{a.push({type:0,doc:u})}),new $n(e,t,Qn.emptySet(t),a,n,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&_r(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==n[i].type||!t[i].doc.isEqual(n[i].doc))return!1;return!0}}class yp{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class Ip{constructor(){this.queries=bh(),this.onlineState="Unknown",this.Y_=new Set}terminate(){!function(t,n){const i=M(t),s=i.queries;i.queries=bh(),s.forEach((a,u)=>{for(const l of u.j_)l.onError(n)})}(this,new C(V.ABORTED,"Firestore shutting down"))}}function bh(){return new dt(r=>jl(r),_r)}function ra(r,e){return ia.apply(this,arguments)}function ia(){return(ia=(0,b.A)(function*(r,e){const t=M(r);let n=3;const i=e.query;let s=t.queries.get(i);s?!s.H_()&&e.J_()&&(n=2):(s=new yp,n=e.J_()?0:1);try{switch(n){case 0:s.z_=yield t.onListen(i,!0);break;case 1:s.z_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(a){const u=zn(a,`Initialization of query '${Sn(e.query)}' failed`);return void e.onError(u)}t.queries.set(i,s),s.j_.push(e),e.Z_(t.onlineState),s.z_&&e.X_(s.z_)&&aa(t)})).apply(this,arguments)}function sa(r,e){return oa.apply(this,arguments)}function oa(){return(oa=(0,b.A)(function*(r,e){const t=M(r),n=e.query;let i=3;const s=t.queries.get(n);if(s){const a=s.j_.indexOf(e);a>=0&&(s.j_.splice(a,1),0===s.j_.length?i=e.J_()?0:1:!s.H_()&&e.J_()&&(i=2))}switch(i){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}})).apply(this,arguments)}function Tp(r,e){const t=M(r);let n=!1;for(const i of e){const a=t.queries.get(i.query);if(a){for(const u of a.j_)u.X_(i)&&(n=!0);a.z_=i}}n&&aa(t)}function Ep(r,e,t){const n=M(r),i=n.queries.get(e);if(i)for(const s of i.j_)s.onError(t);n.queries.delete(e)}function aa(r){r.Y_.forEach(e=>{e.next()})}var ua,xh;(xh=ua||(ua={})).ea="default",xh.Cache="cache";class la{constructor(e,t,n){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=n||{}}X_(e){if(!this.options.includeMetadataChanges){const n=[];for(const i of e.docChanges)3!==i.type&&n.push(i);e=new $n(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){return!e.fromCache||!this.J_()||(!this.options._a||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}ia(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}oa(e){e=$n.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==ua.Cache}}class vp{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}}class Ch{constructor(e){this.serializer=e}Es(e){return it(this.serializer,e)}ds(e){return e.metadata.exists?Rc(this.serializer,e.document,!1):le.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return Ie(e)}}class Ap{constructor(e,t,n){this.ca=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Dh(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;const n=J.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){const t=new Map,n=new Ch(this.serializer);for(const i of e)if(i.metadata.queries){const s=n.Es(i.metadata.name);for(const a of i.metadata.queries){const u=(t.get(a)||W()).add(s);t.set(a,u)}}return t}complete(){var e=this;return(0,b.A)(function*(){const t=yield function Yg(r,e,t,n){return xo.apply(this,arguments)}(e.localStore,new Ch(e.serializer),e.documents,e.ca.id),n=e.ha(e.documents);for(const i of e.queries)yield Xg(e.localStore,i,n.get(i.name));return e.progress.taskState="Success",{progress:e.progress,Pa:e.collectionGroups,Ia:t}})()}}function Dh(r){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:r.totalDocuments,totalBytes:r.totalBytes}}class Nh{constructor(e){this.key=e}}class kh{constructor(e){this.key=e}}class Fh{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=W(),this.mutatedKeys=W(),this.Aa=Ql(e),this.Ra=new Qn(this.Aa)}get Va(){return this.Ta}ma(e,t){const n=t?t.fa:new Sh,i=t?t.Ra:this.Ra;let s=t?t.mutatedKeys:this.mutatedKeys,a=i,u=!1;const l="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,h="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((f,g)=>{const _=i.get(f),R=yr(this.query,g)?g:null,x=!!_&&this.mutatedKeys.has(_.key),k=!!R&&(R.hasLocalMutations||this.mutatedKeys.has(R.key)&&R.hasCommittedMutations);let D=!1;_&&R?_.data.isEqual(R.data)?x!==k&&(n.track({type:3,doc:R}),D=!0):this.ga(_,R)||(n.track({type:2,doc:R}),D=!0,(l&&this.Aa(R,l)>0||h&&this.Aa(R,h)<0)&&(u=!0)):!_&&R?(n.track({type:0,doc:R}),D=!0):_&&!R&&(n.track({type:1,doc:_}),D=!0,(l||h)&&(u=!0)),D&&(R?(a=a.add(R),s=k?s.add(f):s.delete(f)):(a=a.delete(f),s=s.delete(f)))}),null!==this.query.limit)for(;a.size>this.query.limit;){const f="F"===this.query.limitType?a.last():a.first();a=a.delete(f.key),s=s.delete(f.key),n.track({type:1,doc:f})}return{Ra:a,fa:n,ns:u,mutatedKeys:s}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,i){const s=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const a=e.fa.G_();a.sort((f,g)=>function(R,x){const k=D=>{switch(D){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return B()}};return k(R)-k(x)}(f.type,g.type)||this.Aa(f.doc,g.doc)),this.pa(n),i=null!=i&&i;const u=t&&!i?this.ya():[],l=0===this.da.size&&this.current&&!i?1:0,h=l!==this.Ea;return this.Ea=l,0!==a.length||h?{snapshot:new $n(this.query,e.Ra,s,a,e.mutatedKeys,0===l,h,!1,!!n&&n.resumeToken.approximateByteSize()>0),wa:u}:{wa:u}}Z_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new Sh,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=W(),this.Ra.forEach(n=>{this.Sa(n.key)&&(this.da=this.da.add(n.key))});const t=[];return e.forEach(n=>{this.da.has(n)||t.push(new kh(n))}),this.da.forEach(n=>{e.has(n)||t.push(new Nh(n))}),t}ba(e){this.Ta=e.Ts,this.da=W();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return $n.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,0===this.Ea,this.hasCachedResults)}}class wp{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Rp{constructor(e){this.key=e,this.va=!1}}class Pp{constructor(e,t,n,i,s,a){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.Ca={},this.Fa=new dt(u=>jl(u),_r),this.Ma=new Map,this.xa=new Set,this.Oa=new ae(L.comparator),this.Na=new Map,this.La=new vo,this.Ba={},this.ka=new Map,this.qa=sn.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return!0===this.Qa}}function Vp(r,e){return ca.apply(this,arguments)}function ca(){return(ca=(0,b.A)(function*(r,e,t=!0){const n=es(r);let i;const s=n.Fa.get(e);return s?(n.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.Da()):i=yield Mh(n,e,t,!0),i})).apply(this,arguments)}function Sp(r,e){return ha.apply(this,arguments)}function ha(){return(ha=(0,b.A)(function*(r,e){const t=es(r);yield Mh(t,e,!0,!1)})).apply(this,arguments)}function Mh(r,e,t,n){return da.apply(this,arguments)}function da(){return(da=(0,b.A)(function*(r,e,t,n){const i=yield Bn(r.localStore,Ce(e)),s=i.targetId,a=r.sharedClientState.addLocalQueryTarget(s,t);let u;return n&&(u=yield fa(r,e,s,"current"===a,i.resumeToken)),r.isPrimaryClient&&t&&Xi(r.remoteStore,i),u})).apply(this,arguments)}function fa(r,e,t,n,i){return ma.apply(this,arguments)}function ma(){return ma=(0,b.A)(function*(r,e,t,n,i){r.Ka=(g,_,R)=>{return(x=(0,b.A)(function*(D,U,j,G){let z=U.view.ma(j);z.ns&&(z=yield $i(D.localStore,U.query,!1).then(({documents:p})=>U.view.ma(p,z)));const X=G&&G.targetChanges.get(U.targetId),$=G&&null!=G.targetMismatches.get(U.targetId),T=U.view.applyChanges(z,D.isPrimaryClient,X,$);return Ra(D,U.targetId,T.wa),T.snapshot}),function k(D,U,j,G){return x.apply(this,arguments)})(r,g,_,R);var x};const s=yield $i(r.localStore,e,!0),a=new Fh(e,s.Ts),u=a.ma(s.documents),l=Rr.createSynthesizedTargetChangeForCurrentChange(t,n&&"Offline"!==r.onlineState,i),h=a.applyChanges(u,r.isPrimaryClient,l);Ra(r,t,h.wa);const f=new wp(e,t,a);return r.Fa.set(e,f),r.Ma.has(t)?r.Ma.get(t).push(e):r.Ma.set(t,[e]),h.snapshot}),ma.apply(this,arguments)}function bp(r,e,t){return ga.apply(this,arguments)}function ga(){return(ga=(0,b.A)(function*(r,e,t){const n=M(r),i=n.Fa.get(e),s=n.Ma.get(i.targetId);if(s.length>1)return n.Ma.set(i.targetId,s.filter(a=>!_r(a,e))),void n.Fa.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Un(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),t&&Gn(n.remoteStore,i.targetId),Wn(n,i.targetId)}).catch(vt))):(Wn(n,i.targetId),yield Un(n.localStore,i.targetId,!0))})).apply(this,arguments)}function xp(r,e){return pa.apply(this,arguments)}function pa(){return(pa=(0,b.A)(function*(r,e){const t=M(r),n=t.Fa.get(e),i=t.Ma.get(n.targetId);t.isPrimaryClient&&1===i.length&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),Gn(t.remoteStore,n.targetId))})).apply(this,arguments)}function _a(){return(_a=(0,b.A)(function*(r,e,t){const n=Ma(r);try{const i=yield function(a,u){const l=M(a),h=de.now(),f=u.reduce((R,x)=>R.add(x.key),W());let g,_;return l.persistence.runTransaction("Locally write mutations","readwrite",R=>{let x=Ke(),k=W();return l.cs.getEntries(R,f).next(D=>{x=D,x.forEach((U,j)=>{j.isValidDocument()||(k=k.add(U))})}).next(()=>l.localDocuments.getOverlayedDocuments(R,x)).next(D=>{g=D;const U=[];for(const j of u){const G=rg(j,g.get(j.key).overlayedDocument);null!=G&&U.push(new ft(j.key,G,Sl(G.value.mapValue),me.exists(!0)))}return l.mutationQueue.addMutationBatch(R,h,U,u)}).next(D=>{_=D;const U=D.applyToLocalDocumentSet(g,k);return l.documentOverlayCache.saveOverlays(R,D.batchId,U)})}).then(()=>({batchId:_.batchId,changes:Wl(g)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(i.batchId),function(a,u,l){let h=a.Ba[a.currentUser.toKey()];h||(h=new ae(Q)),h=h.insert(u,l),a.Ba[a.currentUser.toKey()]=h}(n,i.batchId,t),yield gt(n,i.changes),yield Kn(n.remoteStore)}catch(i){const s=zn(i,"Failed to persist write");t.reject(s)}})).apply(this,arguments)}function Oh(r,e){return ya.apply(this,arguments)}function ya(){return(ya=(0,b.A)(function*(r,e){const t=M(r);try{const n=yield function Hg(r,e){const t=M(r),n=e.snapshotVersion;let i=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const a=t.cs.newChangeBuffer({trackRemovals:!0});i=t.os;const u=[];e.targetChanges.forEach((f,g)=>{const _=i.get(g);if(!_)return;u.push(t.Ur.removeMatchingKeys(s,f.removedDocuments,g).next(()=>t.Ur.addMatchingKeys(s,f.addedDocuments,g)));let R=_.withSequenceNumber(s.currentSequenceNumber);var k,D,U;null!==e.targetMismatches.get(g)?R=R.withResumeToken(pe.EMPTY_BYTE_STRING,K.min()).withLastLimboFreeSnapshotVersion(K.min()):f.resumeToken.approximateByteSize()>0&&(R=R.withResumeToken(f.resumeToken,n)),i=i.insert(g,R),D=R,U=f,(0===(k=_).resumeToken.approximateByteSize()||D.snapshotVersion.toMicroseconds()-k.snapshotVersion.toMicroseconds()>=3e8||U.addedDocuments.size+U.modifiedDocuments.size+U.removedDocuments.size>0)&&u.push(t.Ur.updateTargetData(s,R))});let l=Ke(),h=W();if(e.documentUpdates.forEach(f=>{e.resolvedLimboDocuments.has(f)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(s,f))}),u.push(dh(s,a,e.documentUpdates).next(f=>{l=f.Ps,h=f.Is})),!n.isEqual(K.min())){const f=t.Ur.getLastRemoteSnapshotVersion(s).next(g=>t.Ur.setTargetsMetadata(s,s.currentSequenceNumber,n));u.push(f)}return w.waitFor(u).next(()=>a.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,l,h)).next(()=>l)}).then(s=>(t.os=i,s))}(t.localStore,e);e.targetChanges.forEach((i,s)=>{const a=t.Na.get(s);a&&(q(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?a.va=!0:i.modifiedDocuments.size>0?q(a.va):i.removedDocuments.size>0&&(q(a.va),a.va=!1))}),yield gt(t,n,e)}catch(n){yield vt(n)}})).apply(this,arguments)}function Lh(r,e,t){const n=M(r);if(n.isPrimaryClient&&0===t||!n.isPrimaryClient&&1===t){const i=[];n.Fa.forEach((s,a)=>{const u=a.view.Z_(e);u.snapshot&&i.push(u.snapshot)}),function(a,u){const l=M(a);l.onlineState=u;let h=!1;l.queries.forEach((f,g)=>{for(const _ of g.j_)_.Z_(u)&&(h=!0)}),h&&aa(l)}(n.eventManager,e),i.length&&n.Ca.d_(i),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}function Dp(r,e,t){return Ia.apply(this,arguments)}function Ia(){return(Ia=(0,b.A)(function*(r,e,t){const n=M(r);n.sharedClientState.updateQueryState(e,"rejected",t);const i=n.Na.get(e),s=i&&i.key;if(s){let a=new ae(L.comparator);a=a.insert(s,le.newNoDocument(s,K.min()));const u=W().add(s),l=new wr(K.min(),new Map,new ae(Q),a,u);yield Oh(n,l),n.Oa=n.Oa.remove(s),n.Na.delete(e),Pa(n)}else yield Un(n.localStore,e,!1).then(()=>Wn(n,e,t)).catch(vt)})).apply(this,arguments)}function Np(r,e){return Ta.apply(this,arguments)}function Ta(){return(Ta=(0,b.A)(function*(r,e){const t=M(r),n=e.batch.batchId;try{const i=yield function Wg(r,e){const t=M(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{const i=e.batch.keys(),s=t.cs.newChangeBuffer({trackRemovals:!0});return function(u,l,h,f){const g=h.batch,_=g.keys();let R=w.resolve();return _.forEach(x=>{R=R.next(()=>f.getEntry(l,x)).next(k=>{const D=h.docVersions.get(x);q(null!==D),k.version.compareTo(D)<0&&(g.applyToRemoteDocument(k,h),k.isValidDocument()&&(k.setReadTime(h.commitVersion),f.addEntry(k)))})}),R.next(()=>u.mutationQueue.removeMutationBatch(l,g))}(t,n,e,s).next(()=>s.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(u){let l=W();for(let h=0;h<u.mutationResults.length;++h)u.mutationResults[h].transformResults.length>0&&(l=l.add(u.batch.mutations[h].key));return l}(e))).next(()=>t.localDocuments.getDocuments(n,i))})}(t.localStore,e);wa(t,n,null),Aa(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),yield gt(t,i)}catch(i){yield vt(i)}})).apply(this,arguments)}function kp(r,e,t){return Ea.apply(this,arguments)}function Ea(){return(Ea=(0,b.A)(function*(r,e,t){const n=M(r);try{const i=yield function(a,u){const l=M(a);return l.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let f;return l.mutationQueue.lookupMutationBatch(h,u).next(g=>(q(null!==g),f=g.keys(),l.mutationQueue.removeMutationBatch(h,g))).next(()=>l.mutationQueue.performConsistencyCheck(h)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(h,f,u)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,f)).next(()=>l.localDocuments.getDocuments(h,f))})}(n.localStore,e);wa(n,e,t),Aa(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),yield gt(n,i)}catch(i){yield vt(i)}})).apply(this,arguments)}function va(){return(va=(0,b.A)(function*(r,e){const t=M(r);kt(t.remoteStore)||N("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const n=yield function(a){const u=M(a);return u.persistence.runTransaction("Get highest unacknowledged batch id","readonly",l=>u.mutationQueue.getHighestUnacknowledgedBatchId(l))}(t.localStore);if(-1===n)return void e.resolve();const i=t.ka.get(n)||[];i.push(e),t.ka.set(n,i)}catch(n){const i=zn(n,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})).apply(this,arguments)}function Aa(r,e){(r.ka.get(e)||[]).forEach(t=>{t.resolve()}),r.ka.delete(e)}function wa(r,e,t){const n=M(r);let i=n.Ba[n.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),n.Ba[n.currentUser.toKey()]=i}}function Wn(r,e,t=null){r.sharedClientState.removeLocalQueryTarget(e);for(const n of r.Ma.get(e))r.Fa.delete(n),t&&r.Ca.$a(n,t);r.Ma.delete(e),r.isPrimaryClient&&r.La.gr(e).forEach(n=>{r.La.containsKey(n)||Bh(r,n)})}function Bh(r,e){r.xa.delete(e.path.canonicalString());const t=r.Oa.get(e);null!==t&&(Gn(r.remoteStore,t),r.Oa=r.Oa.remove(e),r.Na.delete(t),Pa(r))}function Ra(r,e,t){for(const n of t)n instanceof Nh?(r.La.addReference(n.key,e),Mp(r,n)):n instanceof kh?(N("SyncEngine","Document no longer in limbo: "+n.key),r.La.removeReference(n.key,e),r.La.containsKey(n.key)||Bh(r,n.key)):B()}function Mp(r,e){const t=e.key,n=t.path.canonicalString();r.Oa.get(t)||r.xa.has(n)||(N("SyncEngine","New document in limbo: "+t),r.xa.add(n),Pa(r))}function Pa(r){for(;r.xa.size>0&&r.Oa.size<r.maxConcurrentLimboResolutions;){const e=r.xa.values().next().value;r.xa.delete(e);const t=new L(J.fromString(e)),n=r.qa.next();r.Na.set(n,new Rp(t)),r.Oa=r.Oa.insert(t,n),Xi(r.remoteStore,new mt(Ce(Pn(t.path)),n,"TargetPurposeLimboResolution",$e.oe))}}function gt(r,e,t){return Va.apply(this,arguments)}function Va(){return Va=(0,b.A)(function*(r,e,t){const n=M(r),i=[],s=[],a=[];var u;n.Fa.isEmpty()||(n.Fa.forEach((u,l)=>{a.push(n.Ka(l,e,t).then(h=>{var f;if((h||t)&&n.isPrimaryClient){const g=h?!h.fromCache:null===(f=null==t?void 0:t.targetChanges.get(l.targetId))||void 0===f?void 0:f.current;n.sharedClientState.updateQueryState(l.targetId,g?"current":"not-current")}if(h){i.push(h);const g=Vo.Wi(l.targetId,h);s.push(g)}}))}),yield Promise.all(a),n.Ca.d_(i),yield(u=(0,b.A)(function*(h,f){const g=M(h);try{yield g.persistence.runTransaction("notifyLocalViewChanges","readwrite",_=>w.forEach(f,R=>w.forEach(R.$i,x=>g.persistence.referenceDelegate.addReference(_,R.targetId,x)).next(()=>w.forEach(R.Ui,x=>g.persistence.referenceDelegate.removeReference(_,R.targetId,x)))))}catch(_){if(!At(_))throw _;N("LocalStore","Failed to update sequence numbers: "+_)}for(const _ of f){const R=_.targetId;if(!_.fromCache){const x=g.os.get(R),D=x.withLastLimboFreeSnapshotVersion(x.snapshotVersion);g.os=g.os.insert(R,D)}}}),function l(h,f){return u.apply(this,arguments)})(n.localStore,s))}),Va.apply(this,arguments)}function Op(r,e){return Sa.apply(this,arguments)}function Sa(){return(Sa=(0,b.A)(function*(r,e){const t=M(r);if(!t.currentUser.isEqual(e)){N("SyncEngine","User change. New user:",e.toKey());const n=yield ch(t.localStore,e);t.currentUser=e,(s=t).ka.forEach(u=>{u.forEach(l=>{l.reject(new C(V.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),s.ka.clear(),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),yield gt(t,n.hs)}var s})).apply(this,arguments)}function Lp(r,e){const t=M(r),n=t.Na.get(e);if(n&&n.va)return W().add(n.key);{let i=W();const s=t.Ma.get(e);if(!s)return i;for(const a of s){const u=t.Fa.get(a);i=i.unionWith(u.view.Va)}return i}}function Bp(r,e){return ba.apply(this,arguments)}function ba(){return(ba=(0,b.A)(function*(r,e){const t=M(r),n=yield $i(t.localStore,e.query,!0),i=e.view.ba(n);return t.isPrimaryClient&&Ra(t,e.targetId,i.wa),i})).apply(this,arguments)}function Up(r,e){return xa.apply(this,arguments)}function xa(){return(xa=(0,b.A)(function*(r,e){const t=M(r);return mh(t.localStore,e).then(n=>gt(t,n))})).apply(this,arguments)}function qp(r,e,t,n){return Ca.apply(this,arguments)}function Ca(){return(Ca=(0,b.A)(function*(r,e,t,n){const i=M(r),s=yield function(u,l){const h=M(u),f=M(h.mutationQueue);return h.persistence.runTransaction("Lookup mutation documents","readonly",g=>f.Mn(g,l).next(_=>_?h.localDocuments.getDocuments(g,_):w.resolve(null)))}(i.localStore,e);var l;null!==s?("pending"===t?yield Kn(i.remoteStore):"acknowledged"===t||"rejected"===t?(wa(i,e,n||null),Aa(i,e),l=e,M(M(i.localStore).mutationQueue).On(l)):B(),yield gt(i,s)):N("SyncEngine","Cannot apply mutation batch with id: "+e)})).apply(this,arguments)}function Da(){return(Da=(0,b.A)(function*(r,e){const t=M(r);if(es(t),Ma(t),!0===e&&!0!==t.Qa){const n=t.sharedClientState.getAllActiveQueryTargets(),i=yield Uh(t,n.toArray());t.Qa=!0,yield ea(t.remoteStore,!0);for(const s of i)Xi(t.remoteStore,s)}else if(!1===e&&!1!==t.Qa){const n=[];let i=Promise.resolve();t.Ma.forEach((s,a)=>{t.sharedClientState.isLocalQueryTarget(a)?n.push(a):i=i.then(()=>(Wn(t,a),Un(t.localStore,a,!0))),Gn(t.remoteStore,a)}),yield i,yield Uh(t,n),function(a){const u=M(a);u.Na.forEach((l,h)=>{Gn(u.remoteStore,h)}),u.La.pr(),u.Na=new Map,u.Oa=new ae(L.comparator)}(t),t.Qa=!1,yield ea(t.remoteStore,!1)}})).apply(this,arguments)}function Uh(r,e,t){return Na.apply(this,arguments)}function Na(){return(Na=(0,b.A)(function*(r,e,t){const n=M(r),i=[],s=[];for(const a of e){let u;const l=n.Ma.get(a);if(l&&0!==l.length){u=yield Bn(n.localStore,Ce(l[0]));for(const h of l){const f=n.Fa.get(h),g=yield Bp(n,f);g.snapshot&&s.push(g.snapshot)}}else{const h=yield fh(n.localStore,a);u=yield Bn(n.localStore,h),yield fa(n,qh(h),a,!1,u.resumeToken)}i.push(u)}return n.Ca.d_(s),i})).apply(this,arguments)}function qh(r){return Ul(r.path,r.collectionGroup,r.orderBy,r.filters,r.limit,"F",r.startAt,r.endAt)}function Kp(r){return t=M(r).localStore,M(M(t).persistence).Qi();var t}function jp(r,e,t,n){return ka.apply(this,arguments)}function ka(){return(ka=(0,b.A)(function*(r,e,t,n){const i=M(r);if(i.Qa)return void N("SyncEngine","Ignoring unexpected query state notification.");const s=i.Ma.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{const a=yield mh(i.localStore,zl(s[0])),u=wr.createSynthesizedRemoteEventForCurrentChange(e,"current"===t,pe.EMPTY_BYTE_STRING);yield gt(i,a,u);break}case"rejected":yield Un(i.localStore,e,!0),Wn(i,e,n);break;default:B()}})).apply(this,arguments)}function zp(r,e,t){return Fa.apply(this,arguments)}function Fa(){return(Fa=(0,b.A)(function*(r,e,t){const n=es(r);if(n.Qa){for(const i of e){if(n.Ma.has(i)&&n.sharedClientState.isActiveQueryTarget(i)){N("SyncEngine","Adding an already active target "+i);continue}const s=yield fh(n.localStore,i),a=yield Bn(n.localStore,s);yield fa(n,qh(s),a.targetId,!1,a.resumeToken),Xi(n.remoteStore,a)}for(const i of t)n.Ma.has(i)&&(yield Un(n.localStore,i,!1).then(()=>{Gn(n.remoteStore,i),Wn(n,i)}).catch(vt))}})).apply(this,arguments)}function es(r){const e=M(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=Oh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Lp.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Dp.bind(null,e),e.Ca.d_=Tp.bind(null,e.eventManager),e.Ca.$a=Ep.bind(null,e.eventManager),e}function Ma(r){const e=M(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Np.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=kp.bind(null,e),e}let Hn=(()=>{class r{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){var n=this;return(0,b.A)(function*(){n.serializer=Fr(t.databaseInfo.databaseId),n.sharedClientState=n.Wa(t),n.persistence=n.Ga(t),yield n.persistence.start(),n.localStore=n.za(t),n.gcScheduler=n.ja(t,n.localStore),n.indexBackfillerScheduler=n.Ha(t,n.localStore)})()}ja(t,n){return null}Ha(t,n){return null}za(t){return lh(this.persistence,new uh,t.initialUser,this.serializer)}Ga(t){return new Ao(ji.Zr,this.serializer)}Wa(t){return new yh}terminate(){var t=this;return(0,b.A)(function*(){var n,i;null===(n=t.gcScheduler)||void 0===n||n.stop(),null===(i=t.indexBackfillerScheduler)||void 0===i||i.stop(),t.sharedClientState.shutdown(),yield t.persistence.shutdown()})()}}return r.provider={build:()=>new r},r})();class Oa extends Hn{constructor(e,t,n){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,n=this;return(0,b.A)(function*(){yield t().call(n,e),yield n.Ja.initialize(n,e),yield Ma(n.Ja.syncEngine),yield Kn(n.Ja.remoteStore),yield n.persistence.yi(()=>(n.gcScheduler&&!n.gcScheduler.started&&n.gcScheduler.start(),n.indexBackfillerScheduler&&!n.indexBackfillerScheduler.started&&n.indexBackfillerScheduler.start(),Promise.resolve()))})()}za(e){return lh(this.persistence,new uh,e.initialUser,this.serializer)}ja(e,t){return new Zc(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Ha(e,t){const n=new mm(t,this.persistence);return new fm(e.asyncQueue,n)}Ga(e){const t=Po(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?De.withCacheSize(this.cacheSizeBytes):De.DEFAULT;return new Ro(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,Th(),Yi(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new yh}}class Gh extends Oa{constructor(e,t){super(e,t,!1),this.Ja=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){var t=()=>super.initialize,n=this;return(0,b.A)(function*(){yield t().call(n,e);const i=n.Ja.syncEngine;n.sharedClientState instanceof Fo&&(n.sharedClientState.syncEngine={no:qp.bind(null,i),ro:jp.bind(null,i),io:zp.bind(null,i),Qi:Kp.bind(null,i),eo:Up.bind(null,i)},yield n.sharedClientState.start()),yield n.persistence.yi(function(){var s=(0,b.A)(function*(a){yield function Gp(r,e){return Da.apply(this,arguments)}(n.Ja.syncEngine,a),n.gcScheduler&&(a&&!n.gcScheduler.started?n.gcScheduler.start():a||n.gcScheduler.stop()),n.indexBackfillerScheduler&&(a&&!n.indexBackfillerScheduler.started?n.indexBackfillerScheduler.start():a||n.indexBackfillerScheduler.stop())});return function(a){return s.apply(this,arguments)}}())})()}Wa(e){const t=Th();if(!Fo.D(t))throw new C(V.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=Po(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Fo(t,e.asyncQueue,n,e.clientId,e.initialUser)}}let Jn=(()=>{class r{initialize(t,n){var i=this;return(0,b.A)(function*(){i.localStore||(i.localStore=t.localStore,i.sharedClientState=t.sharedClientState,i.datastore=i.createDatastore(n),i.remoteStore=i.createRemoteStore(n),i.eventManager=i.createEventManager(n),i.syncEngine=i.createSyncEngine(n,!t.synchronizeTabs),i.sharedClientState.onlineStateHandler=s=>Lh(i.syncEngine,s,1),i.remoteStore.remoteSyncer.handleCredentialChange=Op.bind(null,i.syncEngine),yield ea(i.remoteStore,i.syncEngine.isPrimaryClient))})()}createEventManager(t){return new Ip}createDatastore(t){const n=Fr(t.databaseInfo.databaseId),i=new np(t.databaseInfo);return new sp(t.authCredentials,t.appCheckCredentials,i,n)}createRemoteStore(t){return i=this.localStore,s=this.datastore,a=t.asyncQueue,u=n=>Lh(this.syncEngine,n,0),l=Ih.D()?new Ih:new Zg,new ap(i,s,a,u,l);var i,s,a,u,l}createSyncEngine(t,n){return function(s,a,u,l,h,f,g){const _=new Pp(s,a,u,l,h,f);return g&&(_.Qa=!0),_}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,n)}terminate(){var t=this;return(0,b.A)(function*(){var n,i,s;yield(s=(0,b.A)(function*(u){const l=M(u);N("RemoteStore","RemoteStore shutting down."),l.L_.add(5),yield qn(l),l.k_.shutdown(),l.q_.set("Unknown")}),function a(u){return s.apply(this,arguments)})(t.remoteStore),null===(n=t.datastore)||void 0===n||n.terminate(),null===(i=t.eventManager)||void 0===i||i.terminate()})()}}return r.provider={build:()=>new r},r})();function Kh(r,e=10240){let t=0;return{read:()=>(0,b.A)(function*(){if(t<r.byteLength){const n={value:r.slice(t,t+e),done:!1};return t+=e,n}return{done:!0}})(),cancel:()=>(0,b.A)(function*(){})(),releaseLock(){},closed:Promise.resolve()}}class ts{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):ye("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}class Wp{constructor(e,t){this.Xa=e,this.serializer=t,this.metadata=new Ae,this.buffer=new Uint8Array,this.eu=new TextDecoder("utf-8"),this.tu().then(n=>{n&&n.ua()?this.metadata.resolve(n.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==n?void 0:n.aa)}`))},n=>this.metadata.reject(n))}close(){return this.Xa.cancel()}getMetadata(){var e=this;return(0,b.A)(function*(){return e.metadata.promise})()}Ua(){var e=this;return(0,b.A)(function*(){return yield e.getMetadata(),e.tu()})()}tu(){var e=this;return(0,b.A)(function*(){const t=yield e.nu();if(null===t)return null;const n=e.eu.decode(t),i=Number(n);isNaN(i)&&e.ru(`length string (${n}) is not valid number`);const s=yield e.iu(i);return new vp(JSON.parse(s),t.length+i)})()}su(){return this.buffer.findIndex(e=>123===e)}nu(){var e=this;return(0,b.A)(function*(){for(;e.su()<0&&!(yield e.ou()););if(0===e.buffer.length)return null;const t=e.su();t<0&&e.ru("Reached the end of bundle when a length string is expected.");const n=e.buffer.slice(0,t);return e.buffer=e.buffer.slice(t),n})()}iu(e){var t=this;return(0,b.A)(function*(){for(;t.buffer.length<e;)(yield t.ou())&&t.ru("Reached the end of bundle when more is expected.");const n=t.eu.decode(t.buffer.slice(0,e));return t.buffer=t.buffer.slice(e),n})()}ru(e){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${e}`)}ou(){var e=this;return(0,b.A)(function*(){const t=yield e.Xa.read();if(!t.done){const n=new Uint8Array(e.buffer.length+t.value.length);n.set(e.buffer),n.set(t.value,e.buffer.length),e.buffer=n}return t.done})()}}class Hp{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){var t=this;return(0,b.A)(function*(){if(t.ensureCommitNotCalled(),t.mutations.length>0)throw t.lastTransactionError=new C(V.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),t.lastTransactionError;const n=yield(i=(0,b.A)(function*(a,u){const l=M(a),h={documents:u.map(R=>Pr(l.serializer,R))},f=yield l.Lo("BatchGetDocuments",l.serializer.databaseId,J.emptyPath(),h,u.length),g=new Map;f.forEach(R=>{const x=function dg(r,e){return"found"in e?function(n,i){q(!!i.found);const s=it(n,i.found.name),a=Ie(i.found.updateTime),u=i.found.createTime?Ie(i.found.createTime):K.min(),l=new Pe({mapValue:{fields:i.found.fields}});return le.newFoundDocument(s,a,u,l)}(r,e):"missing"in e?function(n,i){q(!!i.missing),q(!!i.readTime);const s=it(n,i.missing),a=Ie(i.readTime);return le.newNoDocument(s,a)}(r,e):B()}(l.serializer,R);g.set(x.key.toString(),x)});const _=[];return u.forEach(R=>{const x=g.get(R.toString());q(!!x),_.push(x)}),_}),function s(a,u){return i.apply(this,arguments)})(t.datastore,e);var i;return n.forEach(i=>t.recordVersion(i)),n})()}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(n){this.lastTransactionError=n}this.writtenDocs.add(e.toString())}delete(e){this.write(new Dn(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,b.A)(function*(){if(e.ensureCommitNotCalled(),e.lastTransactionError)throw e.lastTransactionError;const t=e.readVersions;var n;e.mutations.forEach(n=>{t.delete(n.key.toString())}),t.forEach((n,i)=>{const s=L.fromPath(i);e.mutations.push(new io(s,e.precondition(s)))}),yield(n=(0,b.A)(function*(s,a){const u=M(s),l={writes:a.map(h=>Vr(u.serializer,h))};yield u.Mo("Commit",u.serializer.databaseId,J.emptyPath(),l)}),function i(s,a){return n.apply(this,arguments)})(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw B();t=K.min()}const n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new C(V.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(K.min())?me.exists(!1):me.updateTime(t):me.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(K.min()))throw new C(V.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return me.updateTime(t)}return me.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class Jp{constructor(e,t,n,i,s){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=i,this.deferred=s,this._u=n.maxAttempts,this.t_=new Oo(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){var e=this;this.t_.Go((0,b.A)(function*(){const t=new Hp(e.datastore),n=e.cu(t);n&&n.then(i=>{e.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{e.deferred.resolve(i)}).catch(s=>{e.lu(s)}))}).catch(i=>{e.lu(i)})}))}cu(e){try{const t=this.updateFunction(e);return!lr(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}lu(e){this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(e)}hu(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!lc(t)}return!1}}class Yp{constructor(e,t,n,i,s){var a=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=ve.UNAUTHENTICATED,this.clientId=el.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(n,function(){var u=(0,b.A)(function*(l){N("FirestoreClient","Received user=",l.uid),yield a.authCredentialListener(l),a.user=l});return function(l){return u.apply(this,arguments)}}()),this.appCheckCredentials.start(n,u=>(N("FirestoreClient","Received new app check token=",u),this.appCheckCredentialListener(u,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new Ae;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,b.A)(function*(){try{e._onlineComponents&&(yield e._onlineComponents.terminate()),e._offlineComponents&&(yield e._offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(n){const i=zn(n,"Failed to shutdown persistence");t.reject(i)}})),t.promise}}function La(r,e){return Ba.apply(this,arguments)}function Ba(){return Ba=(0,b.A)(function*(r,e){r.asyncQueue.verifyOperationInProgress(),N("FirestoreClient","Initializing OfflineComponentProvider");const t=r.configuration;yield e.initialize(t);let n=t.initialUser;r.setCredentialChangeListener(function(){var i=(0,b.A)(function*(s){n.isEqual(s)||(yield ch(e.localStore,s),n=s)});return function(s){return i.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=e}),Ba.apply(this,arguments)}function jh(r,e){return Ua.apply(this,arguments)}function Ua(){return(Ua=(0,b.A)(function*(r,e){r.asyncQueue.verifyOperationInProgress();const t=yield qa(r);N("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,r.configuration),r.setCredentialChangeListener(n=>Vh(e.remoteStore,n)),r.setAppCheckTokenChangeListener((n,i)=>Vh(e.remoteStore,i)),r._onlineComponents=e})).apply(this,arguments)}function qa(r){return Ga.apply(this,arguments)}function Ga(){return(Ga=(0,b.A)(function*(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){N("FirestoreClient","Using user provided OfflineComponentProvider");try{yield La(r,r._uninitializedComponentsProvider._offline)}catch(e){if(!("FirebaseError"===(i=e).name?i.code===V.FAILED_PRECONDITION||i.code===V.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||22===i.code||20===i.code||11===i.code))throw e;ze("Error using user provided cache. Falling back to memory cache: "+e),yield La(r,new Hn)}}else N("FirestoreClient","Using default OfflineComponentProvider"),yield La(r,new Hn);var i;return r._offlineComponents})).apply(this,arguments)}function ns(r){return Ka.apply(this,arguments)}function Ka(){return(Ka=(0,b.A)(function*(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(N("FirestoreClient","Using user provided OnlineComponentProvider"),yield jh(r,r._uninitializedComponentsProvider._online)):(N("FirestoreClient","Using default OnlineComponentProvider"),yield jh(r,new Jn))),r._onlineComponents})).apply(this,arguments)}function zh(r){return qa(r).then(e=>e.persistence)}function Yn(r){return qa(r).then(e=>e.localStore)}function Qh(r){return ns(r).then(e=>e.remoteStore)}function ja(r){return ns(r).then(e=>e.syncEngine)}function Xn(r){return za.apply(this,arguments)}function za(){return(za=(0,b.A)(function*(r){const e=yield ns(r),t=e.eventManager;return t.onListen=Vp.bind(null,e.syncEngine),t.onUnlisten=bp.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Sp.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=xp.bind(null,e.syncEngine),t})).apply(this,arguments)}function Wh(r,e,t={}){const n=new Ae;return r.asyncQueue.enqueueAndForget((0,b.A)(function*(){return function(s,a,u,l,h){const f=new ts({next:_=>{f.Za(),a.enqueueAndForget(()=>sa(s,g));const R=_.docs.has(u);!R&&_.fromCache?h.reject(new C(V.UNAVAILABLE,"Failed to get document because the client is offline.")):R&&_.fromCache&&l&&"server"===l.source?h.reject(new C(V.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(_)},error:_=>h.reject(_)}),g=new la(Pn(u.path),f,{includeMetadataChanges:!0,_a:!0});return ra(s,g)}(yield Xn(r),r.asyncQueue,e,t,n)})),n.promise}function Hh(r,e,t={}){const n=new Ae;return r.asyncQueue.enqueueAndForget((0,b.A)(function*(){return function(s,a,u,l,h){const f=new ts({next:_=>{f.Za(),a.enqueueAndForget(()=>sa(s,g)),_.fromCache&&"server"===l.source?h.reject(new C(V.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(_)},error:_=>h.reject(_)}),g=new la(u,f,{includeMetadataChanges:!0,_a:!0});return ra(s,g)}(yield Xn(r),r.asyncQueue,e,t,n)})),n.promise}function Jh(r){const e={};return void 0!==r.timeoutSeconds&&(e.timeoutSeconds=r.timeoutSeconds),e}const Yh=new Map;function Qa(r,e,t){if(!t)throw new C(V.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function Xh(r,e,t,n){if(!0===e&&!0===n)throw new C(V.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)}function Zh(r){if(!L.isDocumentKey(r))throw new C(V.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function ed(r){if(L.isDocumentKey(r))throw new C(V.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function rs(r){if(void 0===r)return"undefined";if(null===r)return"null";if("string"==typeof r)return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if("number"==typeof r||"boolean"==typeof r)return""+r;if("object"==typeof r){if(r instanceof Array)return"an array";{const e=(n=r).constructor?n.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var n;return"function"==typeof r?"a function":B()}function H(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new C(V.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=rs(r);throw new C(V.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}function td(r,e){if(e<=0)throw new C(V.INVALID_ARGUMENT,`Function ${r}() requires a positive number, but it was: ${e}.`)}class nd{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new C(V.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new C(V.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Xh("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==e.experimentalAutoDetectLongPolling&&!e.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=Jh(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(s){if(void 0!==s.timeoutSeconds){if(isNaN(s.timeoutSeconds))throw new C(V.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new C(V.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new C(V.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===e.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Or{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new nd({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new C(V.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new C(V.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new nd(e),void 0!==e.credentials&&(this._authCredentials=function(n){if(!n)return new tm;switch(n.type){case"firstParty":return new sm(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new C(V.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){var e=this;return(0,b.A)(function*(){"notTerminated"===e._terminateTask?yield e._terminate():e._terminateTask="notTerminated"})()}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const n=Yh.get(t);n&&(N("ComponentProvider","Removing Datastore"),Yh.delete(t),n.terminate())}(this),Promise.resolve()}}class Ve{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Ve(this.firestore,e,this._query)}}class ce{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new st(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new ce(this.firestore,e,this._key)}}class st extends Ve{constructor(e,t,n){super(e,t,Pn(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new ce(this.firestore,null,new L(e))}withConverter(e){return new st(this.firestore,e,this._path)}}function id(r,e,...t){if(r=(0,ne.Ku)(r),Qa("collection","path",e),r instanceof Or){const n=J.fromString(e,...t);return ed(n),new st(r,null,n)}{if(!(r instanceof ce||r instanceof st))throw new C(V.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(J.fromString(e,...t));return ed(n),new st(r.firestore,null,n)}}function is(r,e,...t){if(r=(0,ne.Ku)(r),1===arguments.length&&(e=el.newId()),Qa("doc","path",e),r instanceof Or){const n=J.fromString(e,...t);return Zh(n),new ce(r,null,new L(n))}{if(!(r instanceof ce||r instanceof st))throw new C(V.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(J.fromString(e,...t));return Zh(n),new ce(r.firestore,r instanceof st?r.converter:null,new L(n))}}function sd(r,e){return r=(0,ne.Ku)(r),e=(0,ne.Ku)(e),(r instanceof ce||r instanceof st)&&(e instanceof ce||e instanceof st)&&r.firestore===e.firestore&&r.path===e.path&&r.converter===e.converter}function $a(r,e){return r=(0,ne.Ku)(r),e=(0,ne.Ku)(e),r instanceof Ve&&e instanceof Ve&&r.firestore===e.firestore&&_r(r._query,e._query)&&r.converter===e.converter}class od{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new Oo(this,"async_queue_retry"),this.Vu=()=>{const n=Yi();n&&N("AsyncQueue","Visibility state changed to "+n.visibilityState),this.t_.jo()},this.mu=e;const t=Yi();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=Yi();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new Ae;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}pu(){var e=this;return(0,b.A)(function*(){if(0!==e.Pu.length){try{yield e.Pu[0](),e.Pu.shift(),e.t_.reset()}catch(t){if(!At(t))throw t;N("AsyncQueue","Operation failed with retryable error: "+t)}e.Pu.length>0&&e.t_.Go(()=>e.pu())}})()}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(n=>{throw this.Eu=n,this.du=!1,ye("INTERNAL UNHANDLED ERROR: ",function(a){let u=a.message||"";return a.stack&&(u=a.stack.includes(a.message)?a.stack:a.message+"\n"+a.stack),u}(n)),n}).then(n=>(this.du=!1,n))));return this.mu=t,t}enqueueAfterDelay(e,t,n){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const i=na.createAndSchedule(this,e,t,n,s=>this.yu(s));return this.Tu.push(i),i}fu(){this.Eu&&B()}verifyOperationInProgress(){}wu(){var e=this;return(0,b.A)(function*(){let t;do{t=e.mu,yield t}while(t!==e.mu)})()}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}function Wa(r){return function(t){if("object"!=typeof t||null===t)return!1;const i=t;for(const s of["next","error","complete"])if(s in i&&"function"==typeof i[s])return!0;return!1}(r)}class c_{constructor(){this._progressObserver={},this._taskCompletionResolver=new Ae,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class se extends Or{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new od,this._persistenceKey=(null==i?void 0:i.name)||"[DEFAULT]"}_terminate(){var e=this;return(0,b.A)(function*(){if(e._firestoreClient){const t=e._firestoreClient.terminate();e._queue=new od(t),e._firestoreClient=void 0,yield t}})()}}function ge(r){if(r._terminated)throw new C(V.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||ad(r),r._firestoreClient}function ad(r){var e,t,n;const i=r._freezeSettings(),s=(l=(null===(e=r._app)||void 0===e?void 0:e.options.appId)||"",new Mm(r._databaseId,l,r._persistenceKey,(f=i).host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,Jh(f.experimentalLongPollingOptions),f.useFetchStreams));var l,f;r._componentsProvider||!(null===(t=i.localCache)||void 0===t)&&t._offlineComponentProvider&&!(null===(n=i.localCache)||void 0===n)&&n._onlineComponentProvider&&(r._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),r._firestoreClient=new Yp(r._authCredentials,r._appCheckCredentials,r._queue,s,r._componentsProvider&&function(u){const l=null==u?void 0:u._online.build();return{_offline:null==u?void 0:u._offline.build(l),_online:l}}(r._componentsProvider))}function Ha(){return(Ha=(0,b.A)(function*(r){ze("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=r._freezeSettings();ud(r,Jn.provider,{build:t=>new Gh(t,e.cacheSizeBytes)})})).apply(this,arguments)}function ud(r,e,t){if((r=H(r,se))._firestoreClient||r._terminated)throw new C(V.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(r._componentsProvider||r._getSettings().localCache)throw new C(V.FAILED_PRECONDITION,"SDK cache is already specified.");r._componentsProvider={_online:e,_offline:t},ad(r)}class ot{constructor(e){this._byteString=e}static fromBase64String(e){try{return new ot(pe.fromBase64String(e))}catch(t){throw new C(V.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new ot(pe.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class pt{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new C(V.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ue(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class an{constructor(e){this._methodName=e}}class ss{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new C(V.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new C(V.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Q(this._lat,e._lat)||Q(this._long,e._long)}}class os{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(n,i){if(n.length!==i.length)return!1;for(let s=0;s<n.length;++s)if(n[s]!==i[s])return!1;return!0}(this._values,e._values)}}const E_=/^__.*__$/;class v_{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new ft(e,this.data,this.fieldMask,t,this.fieldTransforms):new Cn(e,this.data,t,this.fieldTransforms)}}class ld{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new ft(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function cd(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw B()}}class as{constructor(e,t,n,i,s,a){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,void 0===s&&this.vu(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new as(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.Fu({path:n,xu:!1});return i.Ou(e),i}Nu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.Fu({path:n,xu:!1});return i.vu(),i}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return cs(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(0===e.length)throw this.Bu("Document fields must not be empty");if(cd(this.Cu)&&E_.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class A_{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Fr(e)}Qu(e,t,n,i=!1){return new as({Cu:e,methodName:t,qu:n,path:ue.emptyPath(),xu:!1,ku:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function un(r){const e=r._freezeSettings(),t=Fr(r._databaseId);return new A_(r._databaseId,!!e.ignoreUndefinedProperties,t)}function us(r,e,t,n,i,s={}){const a=r.Qu(s.merge||s.mergeFields?2:0,e,t,i);nu("Data must be an object, but it was:",a,n);const u=fd(n,a);let l,h;if(s.merge)l=new Ge(a.fieldMask),h=a.fieldTransforms;else if(s.mergeFields){const f=[];for(const g of s.mergeFields){const _=Ur(e,g,t);if(!a.contains(_))throw new C(V.INVALID_ARGUMENT,`Field '${_}' is specified in your field mask but missing from your input data.`);gd(f,_)||f.push(_)}l=new Ge(f),h=a.fieldTransforms.filter(g=>l.covers(g.field))}else l=null,h=a.fieldTransforms;return new v_(new Pe(u),l,h)}class Br extends an{_toFieldTransform(e){if(2!==e.Cu)throw e.Bu(1===e.Cu?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Br}}function hd(r,e,t){return new as({Cu:3,qu:e.settings.qu,methodName:r._methodName,xu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class Ja extends an{_toFieldTransform(e){return new Er(e.path,new bn)}isEqual(e){return e instanceof Ja}}class Ya extends an{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=hd(this,e,!0),n=this.Ku.map(s=>ln(s,t)),i=new Yt(n);return new Er(e.path,i)}isEqual(e){return e instanceof Ya&&(0,ne.bD)(this.Ku,e.Ku)}}class Xa extends an{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=hd(this,e,!0),n=this.Ku.map(s=>ln(s,t)),i=new Xt(n);return new Er(e.path,i)}isEqual(e){return e instanceof Xa&&(0,ne.bD)(this.Ku,e.Ku)}}class Za extends an{constructor(e,t){super(e),this.$u=t}_toFieldTransform(e){const t=new xn(e.serializer,Yl(e.serializer,this.$u));return new Er(e.path,t)}isEqual(e){return e instanceof Za&&this.$u===e.$u}}function eu(r,e,t,n){const i=r.Qu(1,e,t);nu("Data must be an object, but it was:",i,n);const s=[],a=Pe.empty();wt(n,(l,h)=>{const f=ls(e,l,t);h=(0,ne.Ku)(h);const g=i.Nu(f);if(h instanceof Br)s.push(f);else{const _=ln(h,g);null!=_&&(s.push(f),a.set(f,_))}});const u=new Ge(s);return new ld(a,u,i.fieldTransforms)}function tu(r,e,t,n,i,s){const a=r.Qu(1,e,t),u=[Ur(e,n,t)],l=[i];if(s.length%2!=0)throw new C(V.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let _=0;_<s.length;_+=2)u.push(Ur(e,s[_])),l.push(s[_+1]);const h=[],f=Pe.empty();for(let _=u.length-1;_>=0;--_)if(!gd(h,u[_])){const R=u[_];let x=l[_];x=(0,ne.Ku)(x);const k=a.Nu(R);if(x instanceof Br)h.push(R);else{const D=ln(x,k);null!=D&&(h.push(R),f.set(R,D))}}const g=new Ge(h);return new ld(f,g,a.fieldTransforms)}function dd(r,e,t,n=!1){return ln(t,r.Qu(n?4:3,e))}function ln(r,e){if(md(r=(0,ne.Ku)(r)))return nu("Unsupported field value:",e,r),fd(r,e);if(r instanceof an)return function(n,i){if(!cd(i.Cu))throw i.Bu(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Bu(`${n._methodName}() is not currently supported inside arrays`);const s=n._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(r,e),null;if(void 0===r&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.xu&&4!==e.Cu)throw e.Bu("Nested arrays are not supported");return function(n,i){const s=[];let a=0;for(const u of n){let l=ln(u,i.Lu(a));null==l&&(l={nullValue:"NULL_VALUE"}),s.push(l),a++}return{arrayValue:{values:s}}}(r,e)}return function(n,i){if(null===(n=(0,ne.Ku)(n)))return{nullValue:"NULL_VALUE"};if("number"==typeof n)return Yl(i.serializer,n);if("boolean"==typeof n)return{booleanValue:n};if("string"==typeof n)return{stringValue:n};if(n instanceof Date){const s=de.fromDate(n);return{timestampValue:Nn(i.serializer,s)}}if(n instanceof de){const s=new de(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Nn(i.serializer,s)}}if(n instanceof ss)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof ot)return{bytesValue:Ic(i.serializer,n._byteString)};if(n instanceof ce){const s=i.databaseId,a=n.firestore._databaseId;if(!a.isEqual(s))throw i.Bu(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:co(n.firestore._databaseId||i.databaseId,n._key.path)}}if(n instanceof os)return u=i,{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:n.toArray().map(l=>{if("number"!=typeof l)throw u.Bu("VectorValues must only contain numeric values.");return ro(u.serializer,l)})}}}}};var u;throw i.Bu(`Unsupported field value: ${rs(n)}`)}(r,e)}function fd(r,e){const t={};return _l(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):wt(r,(n,i)=>{const s=ln(i,e.Mu(n));null!=s&&(t[n]=s)}),{mapValue:{fields:t}}}function md(r){return!("object"!=typeof r||null===r||r instanceof Array||r instanceof Date||r instanceof de||r instanceof ss||r instanceof ot||r instanceof ce||r instanceof an||r instanceof os)}function nu(r,e,t){if(!md(t)||"object"!=typeof(i=t)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i)){const n=rs(t);throw e.Bu("an object"===n?r+" a custom object":r+" "+n)}var i}function Ur(r,e,t){if((e=(0,ne.Ku)(e))instanceof pt)return e._internalPath;if("string"==typeof e)return ls(r,e);throw cs("Field path arguments must be of type string or ",r,!1,void 0,t)}const w_=new RegExp("[~\\*/\\[\\]]");function ls(r,e,t){if(e.search(w_)>=0)throw cs(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new pt(...e.split("."))._internalPath}catch{throw cs(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function cs(r,e,t,n,i){const s=n&&!n.isEmpty(),a=void 0!==i;let u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${n}`),a&&(l+=` in document ${i}`),l+=")"),new C(V.INVALID_ARGUMENT,u+r+l)}function gd(r,e){return r.some(t=>t.isEqual(e))}class qr{constructor(e,t,n,i,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new ce(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new R_(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(hs("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class R_ extends qr{data(){return super.data()}}function hs(r,e){return"string"==typeof e?ls(r,e):e instanceof pt?e._internalPath:e._delegate._internalPath}function pd(r){if("L"===r.limitType&&0===r.explicitOrderBy.length)throw new C(V.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class ru{}class Gr extends ru{}function Mt(r,e,...t){let n=[];e instanceof ru&&n.push(e),n=n.concat(t),function(s){const a=s.filter(l=>l instanceof Zn).length,u=s.filter(l=>l instanceof Kr).length;if(a>1||a>0&&u>0)throw new C(V.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const i of n)r=i._apply(r);return r}class Kr extends Gr{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new Kr(e,t,n)}_apply(e){const t=this._parse(e);return Td(e._query,t),new Ve(e.firestore,e.converter,to(e._query,t))}_parse(e){const t=un(e.firestore);return function(s,a,u,l,h,f,g){let _;if(h.isKeyField()){if("array-contains"===f||"array-contains-any"===f)throw new C(V.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if("in"===f||"not-in"===f){Id(g,f);const R=[];for(const x of g)R.push(yd(l,s,x));_={arrayValue:{values:R}}}else _=yd(l,s,g)}else"in"!==f&&"not-in"!==f&&"array-contains-any"!==f||Id(g,f),_=dd(u,"where",g,"in"===f||"not-in"===f);return Y.create(h,f,_)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}class Zn extends ru{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Zn(e,t)}_parse(e){const t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return 1===t.length?t[0]:re.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(i,s){let a=i;const u=s.getFlattenedFilters();for(const l of u)Td(a,l),a=to(a,l)}(e._query,t),new Ve(e.firestore,e.converter,to(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class iu extends Gr{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new iu(e,t)}_apply(e){const t=function(i,s,a){if(null!==i.startAt)throw new C(V.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==i.endAt)throw new C(V.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new gr(s,a)}(e._query,this._field,this._direction);return new Ve(e.firestore,e.converter,function(i,s){const a=i.explicitOrderBy.concat([s]);return new ht(i.path,i.collectionGroup,a,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}}class ds extends Gr{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new ds(e,t,n)}_apply(e){return new Ve(e.firestore,e.converter,xi(e._query,this._limit,this._limitType))}}class fs extends Gr{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new fs(e,t,n)}_apply(e){const t=_d(e,this.type,this._docOrFields,this._inclusive);return new Ve(e.firestore,e.converter,(s=t,new ht((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)));var i,s}}class ms extends Gr{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new ms(e,t,n)}_apply(e){const t=_d(e,this.type,this._docOrFields,this._inclusive);return new Ve(e.firestore,e.converter,(s=t,new ht((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)));var i,s}}function _d(r,e,t,n){if(t[0]=(0,ne.Ku)(t[0]),t[0]instanceof qr)return function(s,a,u,l,h){if(!l)throw new C(V.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${u}().`);const f=[];for(const g of Vn(s))if(g.field.isKeyField())f.push(Ht(a,l.key));else{const _=l.data.field(g.field);if(vi(_))throw new C(V.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+g.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===_){const R=g.field.canonicalString();throw new C(V.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${R}' (used as the orderBy) does not exist.`)}f.push(_)}return new bt(f,h)}(r._query,r.firestore._databaseId,e,t[0]._document,n);{const i=un(r.firestore);return function(a,u,l,h,f,g){const _=a.explicitOrderBy;if(f.length>_.length)throw new C(V.INVALID_ARGUMENT,`Too many arguments provided to ${h}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const R=[];for(let x=0;x<f.length;x++){const k=f[x];if(_[x].field.isKeyField()){if("string"!=typeof k)throw new C(V.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${h}(), but got a ${typeof k}`);if(!eo(a)&&-1!==k.indexOf("/"))throw new C(V.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${h}() must be a plain document ID, but '${k}' contains a slash.`);const D=a.path.child(J.fromString(k));if(!L.isDocumentKey(D))throw new C(V.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${h}() must result in a valid document path, but '${D}' is not because it contains an odd number of segments.`);const U=new L(D);R.push(Ht(u,U))}else{const D=dd(l,h,k);R.push(D)}}return new bt(R,g)}(r._query,r.firestore._databaseId,i,e,t,n)}}function yd(r,e,t){if("string"==typeof(t=(0,ne.Ku)(t))){if(""===t)throw new C(V.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!eo(e)&&-1!==t.indexOf("/"))throw new C(V.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const n=e.path.child(J.fromString(t));if(!L.isDocumentKey(n))throw new C(V.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return Ht(r,new L(n))}if(t instanceof ce)return Ht(r,t._key);throw new C(V.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${rs(t)}.`)}function Id(r,e){if(!Array.isArray(r)||0===r.length)throw new C(V.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Td(r,e){const t=function(i,s){for(const a of i)for(const u of a.getFlattenedFilters())if(s.indexOf(u.op)>=0)return u.op;return null}(r.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new C(V.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class su{convertValue(e,t="none"){switch(Vt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return fe(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ct(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw B()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return wt(e,(i,s)=>{n[i]=this.convertValue(s,t)}),n}convertVectorValue(e){var t,n,i;const s=null===(i=null===(n=null===(t=e.fields)||void 0===t?void 0:t.value.arrayValue)||void 0===n?void 0:n.values)||void 0===i?void 0:i.map(a=>fe(a.doubleValue));return new os(s)}convertGeoPoint(e){return new ss(fe(e.latitude),fe(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Ai(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(hr(e));default:return null}}convertTimestamp(e){const t=lt(e);return new de(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=J.fromString(e);q(Cc(n));const i=new Rt(n.get(1),n.get(3)),s=new L(n.popFirst(5));return i.isEqual(t)||ye(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function gs(r,e,t){let n;return n=r?t&&(t.merge||t.mergeFields)?r.toFirestore(e,t):r.toFirestore(e):e,n}class k_ extends su{constructor(e){super(),this.firestore=e}convertBytes(e){return new ot(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new ce(this.firestore,null,t)}}class cn{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class _t extends qr{constructor(e,t,n,i,s,a){super(e,t,n,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new jr(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(hs("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class jr extends _t{data(e={}){return super.data(e)}}class Ot{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new cn(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new jr(this._firestore,this._userDataWriter,n.key,n,new cn(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new C(V.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(u=>({type:"added",doc:new jr(i._firestore,i._userDataWriter,u.doc.key,u.doc,new cn(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:a++}))}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(u=>s||3!==u.type).map(u=>{const l=new jr(i._firestore,i._userDataWriter,u.doc.key,u.doc,new cn(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);let h=-1,f=-1;return 0!==u.type&&(h=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),1!==u.type&&(a=a.add(u.doc),f=a.indexOf(u.doc.key)),{type:M_(u.type),doc:l,oldIndex:h,newIndex:f}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function M_(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return B()}}function vd(r,e){return r instanceof _t&&e instanceof _t?r._firestore===e._firestore&&r._key.isEqual(e._key)&&(null===r._document?null===e._document:r._document.isEqual(e._document))&&r._converter===e._converter:r instanceof Ot&&e instanceof Ot&&r._firestore===e._firestore&&$a(r.query,e.query)&&r.metadata.isEqual(e.metadata)&&r._snapshot.isEqual(e._snapshot)}class Lt extends su{constructor(e){super(),this.firestore=e}convertBytes(e){return new ot(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new ce(this.firestore,null,t)}}function Ad(r,e,t){r=H(r,ce);const n=H(r.firestore,se),i=gs(r.converter,e,t);return er(n,[us(un(n),"setDoc",r._key,i,null!==r.converter,t).toMutation(r._key,me.none())])}function wd(r,e,t,...n){r=H(r,ce);const i=H(r.firestore,se),s=un(i);let a;return a="string"==typeof(e=(0,ne.Ku)(e))||e instanceof pt?tu(s,"updateDoc",r._key,e,t,n):eu(s,"updateDoc",r._key,e),er(i,[a.toMutation(r._key,me.exists(!0))])}function Rd(r,...e){var t,n,i;r=(0,ne.Ku)(r);let s={includeMetadataChanges:!1,source:"default"},a=0;"object"!=typeof e[a]||Wa(e[a])||(s=e[a],a++);const u={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Wa(e[a])){const g=e[a];e[a]=null===(t=g.next)||void 0===t?void 0:t.bind(g),e[a+1]=null===(n=g.error)||void 0===n?void 0:n.bind(g),e[a+2]=null===(i=g.complete)||void 0===i?void 0:i.bind(g)}let l,h,f;if(r instanceof ce)h=H(r.firestore,se),f=Pn(r._key.path),l={next:g=>{e[a]&&e[a](ou(h,r,g))},error:e[a+1],complete:e[a+2]};else{const g=H(r,Ve);h=H(g.firestore,se),f=g._query;const _=new Lt(h);l={next:R=>{e[a]&&e[a](new Ot(h,_,g,R))},error:e[a+1],complete:e[a+2]},pd(r._query)}return function(_,R,x,k){const D=new ts(k),U=new la(R,D,x);return _.asyncQueue.enqueueAndForget((0,b.A)(function*(){return ra(yield Xn(_),U)})),()=>{D.Za(),_.asyncQueue.enqueueAndForget((0,b.A)(function*(){return sa(yield Xn(_),U)}))}}(ge(h),f,u,l)}function er(r,e){return function(n,i){const s=new Ae;return n.asyncQueue.enqueueAndForget((0,b.A)(function*(){return function Cp(r,e,t){return _a.apply(this,arguments)}(yield ja(n),i,s)})),s.promise}(ge(r),e)}function ou(r,e,t){const n=t.docs.get(e._key),i=new Lt(r);return new _t(r,i,e._key,n,new cn(t.hasPendingWrites,t.fromCache),e.converter)}const ey={maxAttempts:5};class Pd{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=un(e)}set(e,t,n){this._verifyNotCommitted();const i=Bt(e,this._firestore),s=gs(i.converter,t,n),a=us(this._dataReader,"WriteBatch.set",i._key,s,null!==i.converter,n);return this._mutations.push(a.toMutation(i._key,me.none())),this}update(e,t,n,...i){this._verifyNotCommitted();const s=Bt(e,this._firestore);let a;return a="string"==typeof(t=(0,ne.Ku)(t))||t instanceof pt?tu(this._dataReader,"WriteBatch.update",s._key,t,n,i):eu(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(a.toMutation(s._key,me.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Bt(e,this._firestore);return this._mutations=this._mutations.concat(new Dn(t._key,me.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new C(V.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Bt(r,e){if((r=(0,ne.Ku)(r)).firestore!==e)throw new C(V.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return r}class ty extends class{constructor(t,n){this._firestore=t,this._transaction=n,this._dataReader=un(t)}get(t){const n=Bt(t,this._firestore),i=new k_(this._firestore);return this._transaction.lookup([n._key]).then(s=>{if(!s||1!==s.length)return B();const a=s[0];if(a.isFoundDocument())return new qr(this._firestore,i,a.key,a,n.converter);if(a.isNoDocument())return new qr(this._firestore,i,n._key,null,n.converter);throw B()})}set(t,n,i){const s=Bt(t,this._firestore),a=gs(s.converter,n,i),u=us(this._dataReader,"Transaction.set",s._key,a,null!==s.converter,i);return this._transaction.set(s._key,u),this}update(t,n,i,...s){const a=Bt(t,this._firestore);let u;return u="string"==typeof(n=(0,ne.Ku)(n))||n instanceof pt?tu(this._dataReader,"Transaction.update",a._key,n,i,s):eu(this._dataReader,"Transaction.update",a._key,n),this._transaction.update(a._key,u),this}delete(t){const n=Bt(t,this._firestore);return this._transaction.delete(n._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Bt(e,this._firestore),n=new Lt(this._firestore);return super.get(e).then(i=>new _t(this._firestore,n,t._key,i._document,new cn(!1,!1),t.converter))}}function uu(r,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new C("invalid-argument",`Invalid options passed to function ${r}(): You cannot specify both "merge" and "mergeFields".`);return e}function xd(){if(typeof Uint8Array>"u")throw new C("unimplemented","Uint8Arrays are not available in this environment.")}function Cd(){if(!function km(){return typeof atob<"u"}())throw new C("unimplemented","Blobs are unavailable in Firestore in this environment.")}!function(e,t=!0){yn=pi.SDK_VERSION,(0,pi._registerComponent)(new Gu.uA("firestore",(n,{instanceIdentifier:i,options:s})=>{const a=n.getProvider("app").getImmediate(),u=new se(new rm(n.getProvider("auth-internal")),new om(n.getProvider("app-check-internal")),function(h,f){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new C(V.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Rt(h.options.projectId,f)}(a,i),a);return s=Object.assign({useFetchStreams:t},s),u._setSettings(s),u},"PUBLIC").setMultipleInstances(!0)),(0,pi.registerVersion)(Yu,"4.7.3",e),(0,pi.registerVersion)(Yu,"4.7.3","esm2017")}();class zr{constructor(e){this._delegate=e}static fromBase64String(e){return Cd(),new zr(ot.fromBase64String(e))}static fromUint8Array(e){return xd(),new zr(ot.fromUint8Array(e))}toBase64(){return Cd(),this._delegate.toBase64()}toUint8Array(){return xd(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function lu(r){return function hy(r,e){if("object"!=typeof r||null===r)return!1;const t=r;for(const n of e)if(n in t&&"function"==typeof t[n])return!0;return!1}(r,["next","error","complete"])}class dy{enableIndexedDbPersistence(e,t){return function d_(r,e){ze("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=r._freezeSettings();return ud(r,Jn.provider,{build:n=>new Oa(n,t.cacheSizeBytes,null==e?void 0:e.forceOwnership)}),Promise.resolve()}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function f_(r){return Ha.apply(this,arguments)}(e._delegate)}clearIndexedDbPersistence(e){return function m_(r){if(r._initialized&&!r._terminated)throw new C(V.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Ae;return r._queue.enqueueAndForgetEvenWhileRestricted((0,b.A)(function*(){try{yield(t=(0,b.A)(function*(i){if(!et.D())return Promise.resolve();const s=i+"main";yield et.delete(s)}),function n(i){return t.apply(this,arguments)})(Po(r._databaseId,r._persistenceKey)),e.resolve()}catch(t){e.reject(t)}var t})),e.promise}(e._delegate)}}class Dd{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof Rt||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&ze("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,n={}){!function rd(r,e,t,n={}){var i;const s=(r=H(r,Or))._getSettings(),a=`${e}:${t}`;if("firestore.googleapis.com"!==s.host&&s.host!==a&&ze("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),r._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),n.mockUserToken){let u,l;if("string"==typeof n.mockUserToken)u=n.mockUserToken,l=ve.MOCK_USER;else{u=(0,ne.Fy)(n.mockUserToken,null===(i=r._app)||void 0===i?void 0:i.options.projectId);const h=n.mockUserToken.sub||n.mockUserToken.user_id;if(!h)throw new C(V.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new ve(h)}r._authCredentials=new nm(new Xu(u,l))}}(this._delegate,e,t,n)}enableNetwork(){return function p_(r){return function Xp(r){return r.asyncQueue.enqueue((0,b.A)(function*(){const e=yield zh(r),t=yield Qh(r);return e.setNetworkEnabled(!0),function(i){const s=M(i);return s.L_.delete(0),Mr(s)}(t)}))}(ge(r=H(r,se)))}(this._delegate)}disableNetwork(){return function __(r){return function Zp(r){return r.asyncQueue.enqueue((0,b.A)(function*(){const e=yield zh(r),t=yield Qh(r);return e.setNetworkEnabled(!1),(n=(0,b.A)(function*(s){const a=M(s);a.L_.add(0),yield qn(a),a.q_.set("Offline")}),function i(s){return n.apply(this,arguments)})(t);var n}))}(ge(r=H(r,se)))}(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,Xh("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function g_(r){return function(t){const n=new Ae;return t.asyncQueue.enqueueAndForget((0,b.A)(function*(){return function Fp(r,e){return va.apply(this,arguments)}(yield ja(t),n)})),n.promise}(ge(r=H(r,se)))}(this._delegate)}onSnapshotsInSync(e){return function z_(r,e){return function r_(r,e){const t=new ts(e);return r.asyncQueue.enqueueAndForget((0,b.A)(function*(){return i=yield Xn(r),s=t,M(i).Y_.add(s),void s.next();var i,s})),()=>{t.Za(),r.asyncQueue.enqueueAndForget((0,b.A)(function*(){return i=yield Xn(r),s=t,void M(i).Y_.delete(s);var i,s}))}}(ge(r=H(r,se)),Wa(e)?e:{next:e})}(this._delegate,e)}get app(){if(!this._appCompat)throw new C("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new tr(this,id(this._delegate,e))}catch(t){throw Le(t,"collection()","Firestore.collection()")}}doc(e){try{return new Je(this,is(this._delegate,e))}catch(t){throw Le(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Be(this,function l_(r,e){if(r=H(r,Or),Qa("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new C(V.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Ve(r,null,(n=e,new ht(J.emptyPath(),n)));var n}(this._delegate,e))}catch(t){throw Le(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function ny(r,e,t){r=H(r,se);const n=Object.assign(Object.assign({},ey),t);return function(s){if(s.maxAttempts<1)throw new C(V.INVALID_ARGUMENT,"Max attempts must be at least 1")}(n),function(s,a,u){const l=new Ae;return s.asyncQueue.enqueueAndForget((0,b.A)(function*(){const h=yield function $h(r){return ns(r).then(e=>e.datastore)}(s);new Jp(s.asyncQueue,h,u,a,l).au()})),l.promise}(ge(r),i=>e(new ty(r,i)),n)}(this._delegate,t=>e(new Nd(this,t)))}batch(){return ge(this._delegate),new kd(new Pd(this._delegate,e=>er(this._delegate,e)))}loadBundle(e){return function y_(r,e){const t=ge(r=H(r,se)),n=new c_;return function i_(r,e,t,n){const i=function(a,u){let l;return l="string"==typeof a?hc().encode(a):a,f=function(f,g){if(f instanceof Uint8Array)return Kh(f,g);if(f instanceof ArrayBuffer)return Kh(new Uint8Array(f),g);if(f instanceof ReadableStream)return f.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(l),new Wp(f,u);var f}(t,Fr(e));r.asyncQueue.enqueueAndForget((0,b.A)(function*(){!function Qp(r,e,t){const n=M(r);var i;(i=(0,b.A)(function*(a,u,l){try{const h=yield u.getMetadata();if(yield function(x,k){const D=M(x),U=Ie(k.createTime);return D.persistence.runTransaction("hasNewerBundle","readonly",j=>D.Gr.getBundleMetadata(j,k.id)).then(j=>!!j&&j.createTime.compareTo(U)>=0)}(a.localStore,h))return yield u.close(),l._completeWith({taskState:"Success",documentsLoaded:(x=h).totalDocuments,bytesLoaded:x.totalBytes,totalDocuments:x.totalDocuments,totalBytes:x.totalBytes}),Promise.resolve(new Set);l._updateProgress(Dh(h));const f=new Ap(h,a.localStore,u.serializer);let g=yield u.Ua();for(;g;){const R=yield f.la(g);R&&l._updateProgress(R),g=yield u.Ua()}const _=yield f.complete();return yield gt(a,_.Ia,void 0),yield function(x,k){const D=M(x);return D.persistence.runTransaction("Save bundle","readwrite",U=>D.Gr.saveBundleMetadata(U,k))}(a.localStore,h),l._completeWith(_.progress),Promise.resolve(_.Pa)}catch(h){return ze("SyncEngine",`Loading bundle failed with ${h}`),l._failWith(h),Promise.resolve(new Set)}var x}),function s(a,u,l){return i.apply(this,arguments)})(n,e,t).then(i=>{n.sharedClientState.notifyBundleLoaded(i)})}(yield ja(r),i,n)}))}(t,r._databaseId,e,n),n}(this._delegate,e)}namedQuery(e){return function I_(r,e){return function s_(r,e){return r.asyncQueue.enqueue((0,b.A)(function*(){return function(n,i){const s=M(n);return s.persistence.runTransaction("Get named query","readonly",a=>s.Gr.getNamedQuery(a,i))}(yield Yn(r),e)}))}(ge(r=H(r,se)),e).then(t=>t?new Ve(r,null,t.query):null)}(this._delegate,e).then(t=>t?new Be(this,t):null)}}class _s extends su{constructor(e){super(),this.firestore=e}convertBytes(e){return new zr(new ot(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return Je.forKey(t,this.firestore,null)}}class Nd{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new _s(e)}get(e){const t=dn(e);return this._delegate.get(t).then(n=>new Qr(this._firestore,new _t(this._firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,t.converter)))}set(e,t,n){const i=dn(e);return n?(uu("Transaction.set",n),this._delegate.set(i,t,n)):this._delegate.set(i,t),this}update(e,t,n,...i){const s=dn(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,n,...i),this}delete(e){const t=dn(e);return this._delegate.delete(t),this}}class kd{constructor(e){this._delegate=e}set(e,t,n){const i=dn(e);return n?(uu("WriteBatch.set",n),this._delegate.set(i,t,n)):this._delegate.set(i,t),this}update(e,t,n,...i){const s=dn(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,n,...i),this}delete(e){const t=dn(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class hn{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){const n=new jr(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new $r(this._firestore,n),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=hn.INSTANCES;let i=n.get(e);i||(i=new WeakMap,n.set(e,i));let s=i.get(t);return s||(s=new hn(e,new _s(e),t),i.set(t,s)),s}}hn.INSTANCES=new WeakMap;class Je{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new _s(e)}static forPath(e,t,n){if(e.length%2!=0)throw new C("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new Je(t,new ce(t._delegate,n,new L(e)))}static forKey(e,t,n){return new Je(t,new ce(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new tr(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new tr(this.firestore,id(this._delegate,e))}catch(t){throw Le(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,ne.Ku)(e))instanceof ce&&sd(this._delegate,e)}set(e,t){t=uu("DocumentReference.set",t);try{return t?Ad(this._delegate,e,t):Ad(this._delegate,e)}catch(n){throw Le(n,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?wd(this._delegate,e):wd(this._delegate,e,t,...n)}catch(i){throw Le(i,"updateDoc()","DocumentReference.update()")}}delete(){return function K_(r){return er(H(r.firestore,se),[new Dn(r._key,me.none())])}(this._delegate)}onSnapshot(...e){const t=Fd(e),n=Md(e,i=>new Qr(this.firestore,new _t(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return Rd(this._delegate,t,n)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function L_(r){r=H(r,ce);const e=H(r.firestore,se),t=ge(e),n=new Lt(e);return function e_(r,e){const t=new Ae;return r.asyncQueue.enqueueAndForget((0,b.A)(function*(){return(n=(0,b.A)(function*(s,a,u){try{const l=yield function(f,g){const _=M(f);return _.persistence.runTransaction("read document","readonly",R=>_.localDocuments.getDocument(R,g))}(s,a);l.isFoundDocument()?u.resolve(l):l.isNoDocument()?u.resolve(null):u.reject(new C(V.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(l){const h=zn(l,`Failed to get document '${a} from cache`);u.reject(h)}}),function i(s,a,u){return n.apply(this,arguments)})(yield Yn(r),e,t);var n})),t.promise}(t,r._key).then(i=>new _t(e,n,r._key,i,new cn(null!==i&&i.hasLocalMutations,!0),r.converter))}(this._delegate):"server"===(null==e?void 0:e.source)?function B_(r){r=H(r,ce);const e=H(r.firestore,se);return Wh(ge(e),r._key,{source:"server"}).then(t=>ou(e,r,t))}(this._delegate):function O_(r){r=H(r,ce);const e=H(r.firestore,se);return Wh(ge(e),r._key).then(t=>ou(e,r,t))}(this._delegate),t.then(n=>new Qr(this.firestore,new _t(this.firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,this._delegate.converter)))}withConverter(e){return new Je(this.firestore,this._delegate.withConverter(e?hn.getInstance(this.firestore,e):null))}}function Le(r,e,t){return r.message=r.message.replace(e,t),r}function Fd(r){for(const e of r)if("object"==typeof e&&!lu(e))return e;return{}}function Md(r,e){var t,n;let i;return i=lu(r[0])?r[0]:lu(r[1])?r[1]:"function"==typeof r[0]?{next:r[0],error:r[1],complete:r[2]}:{next:r[1],error:r[2],complete:r[3]},{next:s=>{i.next&&i.next(e(s))},error:null===(t=i.error)||void 0===t?void 0:t.bind(i),complete:null===(n=i.complete)||void 0===n?void 0:n.bind(i)}}class Qr{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Je(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return vd(this._delegate,e._delegate)}}class $r extends Qr{data(e){const t=this._delegate.data(e);return this._delegate._converter||function em(r){r||B()}(void 0!==t),t}}class Be{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new _s(e)}where(e,t,n){try{return new Be(this.firestore,Mt(this._delegate,function P_(r,e,t){const n=e,i=hs("where",r);return Kr._create(i,n,t)}(e,t,n)))}catch(i){throw Le(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new Be(this.firestore,Mt(this._delegate,function V_(r,e="asc"){const t=e,n=hs("orderBy",r);return iu._create(n,t)}(e,t)))}catch(n){throw Le(n,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new Be(this.firestore,Mt(this._delegate,function S_(r){return td("limit",r),ds._create("limit",r,"F")}(e)))}catch(t){throw Le(t,"limit()","Query.limit()")}}limitToLast(e){try{return new Be(this.firestore,Mt(this._delegate,function b_(r){return td("limitToLast",r),ds._create("limitToLast",r,"L")}(e)))}catch(t){throw Le(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new Be(this.firestore,Mt(this._delegate,function x_(...r){return fs._create("startAt",r,!0)}(...e)))}catch(t){throw Le(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new Be(this.firestore,Mt(this._delegate,function C_(...r){return fs._create("startAfter",r,!1)}(...e)))}catch(t){throw Le(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new Be(this.firestore,Mt(this._delegate,function D_(...r){return ms._create("endBefore",r,!1)}(...e)))}catch(t){throw Le(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new Be(this.firestore,Mt(this._delegate,function N_(...r){return ms._create("endAt",r,!0)}(...e)))}catch(t){throw Le(t,"endAt()","Query.endAt()")}}isEqual(e){return $a(this._delegate,e._delegate)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function q_(r){r=H(r,Ve);const e=H(r.firestore,se),t=ge(e),n=new Lt(e);return function t_(r,e){const t=new Ae;return r.asyncQueue.enqueueAndForget((0,b.A)(function*(){return(n=(0,b.A)(function*(s,a,u){try{const l=yield $i(s,a,!0),h=new Fh(a,l.Ts),f=h.ma(l.documents),g=h.applyChanges(f,!1);u.resolve(g.snapshot)}catch(l){const h=zn(l,`Failed to execute query '${a} against cache`);u.reject(h)}}),function i(s,a,u){return n.apply(this,arguments)})(yield Yn(r),e,t);var n})),t.promise}(t,r._query).then(i=>new Ot(e,n,r,i))}(this._delegate):"server"===(null==e?void 0:e.source)?function G_(r){r=H(r,Ve);const e=H(r.firestore,se),t=ge(e),n=new Lt(e);return Hh(t,r._query,{source:"server"}).then(i=>new Ot(e,n,r,i))}(this._delegate):function U_(r){r=H(r,Ve);const e=H(r.firestore,se),t=ge(e),n=new Lt(e);return pd(r._query),Hh(t,r._query).then(i=>new Ot(e,n,r,i))}(this._delegate),t.then(n=>new cu(this.firestore,new Ot(this.firestore._delegate,this._userDataWriter,this._delegate,n._snapshot)))}onSnapshot(...e){const t=Fd(e),n=Md(e,i=>new cu(this.firestore,new Ot(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return Rd(this._delegate,t,n)}withConverter(e){return new Be(this.firestore,this._delegate.withConverter(e?hn.getInstance(this.firestore,e):null))}}class my{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new $r(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class cu{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Be(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new $r(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new my(this._firestore,t))}forEach(e,t){this._delegate.forEach(n=>{e.call(t,new $r(this._firestore,n))})}isEqual(e){return vd(this._delegate,e._delegate)}}class tr extends Be{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new Je(this.firestore,e):null}doc(e){try{return new Je(this.firestore,void 0===e?is(this._delegate):is(this._delegate,e))}catch(t){throw Le(t,"doc()","CollectionReference.doc()")}}add(e){return function j_(r,e){const t=H(r.firestore,se),n=is(r),i=gs(r.converter,e);return er(t,[us(un(r.firestore),"addDoc",n._key,i,null!==r.converter,{}).toMutation(n._key,me.exists(!1))]).then(()=>n)}(this._delegate,e).then(t=>new Je(this.firestore,t))}isEqual(e){return sd(this._delegate,e._delegate)}withConverter(e){return new tr(this.firestore,this._delegate.withConverter(e?hn.getInstance(this.firestore,e):null))}}function dn(r){return H(r,ce)}class hu{constructor(...e){this._delegate=new pt(...e)}static documentId(){return new hu(ue.keyField().canonicalString())}isEqual(e){return(e=(0,ne.Ku)(e))instanceof pt&&this._delegate._internalPath.isEqual(e._internalPath)}}class fn{constructor(e){this._delegate=e}static serverTimestamp(){const e=function iy(){return new Ja("serverTimestamp")}();return e._methodName="FieldValue.serverTimestamp",new fn(e)}static delete(){const e=function ry(){return new Br("deleteField")}();return e._methodName="FieldValue.delete",new fn(e)}static arrayUnion(...e){const t=function sy(...r){return new Ya("arrayUnion",r)}(...e);return t._methodName="FieldValue.arrayUnion",new fn(t)}static arrayRemove(...e){const t=function oy(...r){return new Xa("arrayRemove",r)}(...e);return t._methodName="FieldValue.arrayRemove",new fn(t)}static increment(e){const t=function ay(r){return new Za("increment",r)}(e);return t._methodName="FieldValue.increment",new fn(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const gy={Firestore:Dd,GeoPoint:ss,Timestamp:de,Blob:zr,Transaction:Nd,WriteBatch:kd,DocumentReference:Je,DocumentSnapshot:Qr,Query:Be,QueryDocumentSnapshot:$r,QuerySnapshot:cu,CollectionReference:tr,FieldPath:hu,FieldValue:fn,setLogLevel:function fy(r){!function Zf(r){Et.setLogLevel(r)}(r)},CACHE_SIZE_UNLIMITED:-1};function Od(r,e){return function yy(r,e=Qf.E){return new $f.c(t=>{let n;return null!=e?e.schedule(()=>{n=r.onSnapshot({includeMetadataChanges:!0},t)}):n=r.onSnapshot({includeMetadataChanges:!0},t),()=>{null!=n&&n()}})}(r,e)}function du(r,e){return Od(r,e).pipe((0,Xe.T)(t=>({payload:t,type:"query"})))}!function _y(r){(function py(r,e){r.INTERNAL.registerComponent(new Gu.uA("firestore-compat",t=>{const n=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(n,i)},"PUBLIC").setServiceProps(Object.assign({},gy)))})(r,(e,t)=>new Dd(e,t,new dy)),r.registerVersion("@firebase/firestore-compat","0.3.38")}(Yf.A),te(762);class Ld{constructor(e,t){(0,He.A)(this,"ref",void 0),(0,He.A)(this,"afs",void 0),this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){const n=this.ref.collection(e),{ref:i,query:s}=Gd(n,t);return new qd(i,s,this.afs)}snapshotChanges(){return function Iy(r,e){return Od(r,e).pipe((0,Os.Z)(void 0),Ls(),(0,Xe.T)(t=>{const[n,i]=t;return i.exists?null!=n&&n.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}(this.ref,this.afs.schedulers.outsideAngular).pipe(je.U0)}valueChanges(e={}){return this.snapshotChanges().pipe((0,Xe.T)(({payload:t})=>e.idField?{...t.data(),[e.idField]:t.id}:t.data()))}get(e){return(0,gi.H)(this.ref.get(e)).pipe(je.U0)}}function ys(r,e){return du(r,e).pipe((0,Os.Z)(void 0),Ls(),(0,Xe.T)(t=>{const[n,i]=t,s=i.payload.docChanges(),a=s.map(u=>({type:u.type,payload:u}));return n&&JSON.stringify(n.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((u,l)=>{const h=s.find(g=>g.doc.ref.isEqual(u.ref)),f=null==n?void 0:n.payload.docs.find(g=>g.ref.isEqual(u.ref));h&&JSON.stringify(h.doc.metadata)===JSON.stringify(u.metadata)||!h&&f&&JSON.stringify(f.metadata)===JSON.stringify(u.metadata)||a.push({type:"modified",payload:{oldIndex:l,newIndex:l,type:"modified",doc:u}})}),a}))}function Bd(r,e,t){return ys(r,t).pipe((0,Bs.S)((n,i)=>function Ty(r,e,t){return e.forEach(n=>{t.indexOf(n.type)>-1&&(r=function Ey(r,e){switch(e.type){case"added":if(!r[e.newIndex]||!r[e.newIndex].doc.ref.isEqual(e.doc.ref))return fu(r,e.newIndex,0,e);break;case"modified":if(null==r[e.oldIndex]||r[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const t=r.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}return fu(r,e.newIndex,1,e)}break;case"removed":if(r[e.oldIndex]&&r[e.oldIndex].doc.ref.isEqual(e.doc.ref))return fu(r,e.oldIndex,1)}return r}(r,n))}),r}(n,i.map(s=>s.payload),e),[]),(0,Jf.F)(),(0,Xe.T)(n=>n.map(i=>({type:i.type,payload:i}))))}function fu(r,e,t,...n){const i=r.slice();return i.splice(e,t,...n),i}function Ud(r){return(!r||0===r.length)&&(r=["added","removed","modified"]),r}class qd{constructor(e,t,n){(0,He.A)(this,"ref",void 0),(0,He.A)(this,"query",void 0),(0,He.A)(this,"afs",void 0),this.ref=e,this.query=t,this.afs=n}stateChanges(e){let t=ys(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe((0,Xe.T)(n=>n.filter(i=>e.indexOf(i.type)>-1)))),t.pipe((0,Os.Z)(void 0),Ls(),(0,qu.p)(([n,i])=>i.length>0||!n),(0,Xe.T)(([,n])=>n),je.U0)}auditTrail(e){return this.stateChanges(e).pipe((0,Bs.S)((t,n)=>[...t,...n],[]))}snapshotChanges(e){const t=Ud(e);return Bd(this.query,t,this.afs.schedulers.outsideAngular).pipe(je.U0)}valueChanges(e={}){return du(this.query,this.afs.schedulers.outsideAngular).pipe((0,Xe.T)(t=>t.payload.docs.map(n=>e.idField?{...n.data(),[e.idField]:n.id}:n.data())),je.U0)}get(e){return(0,gi.H)(this.query.get(e)).pipe(je.U0)}add(e){return this.ref.add(e)}doc(e){return new Ld(this.ref.doc(e),this.afs)}}class vy{constructor(e,t){(0,He.A)(this,"query",void 0),(0,He.A)(this,"afs",void 0),this.query=e,this.afs=t}stateChanges(e){return e&&0!==e.length?ys(this.query,this.afs.schedulers.outsideAngular).pipe((0,Xe.T)(t=>t.filter(n=>e.indexOf(n.type)>-1)),(0,qu.p)(t=>t.length>0),je.U0):ys(this.query,this.afs.schedulers.outsideAngular).pipe(je.U0)}auditTrail(e){return this.stateChanges(e).pipe((0,Bs.S)((t,n)=>[...t,...n],[]))}snapshotChanges(e){const t=Ud(e);return Bd(this.query,t,this.afs.schedulers.outsideAngular).pipe(je.U0)}valueChanges(e={}){return du(this.query,this.afs.schedulers.outsideAngular).pipe((0,Xe.T)(n=>n.payload.docs.map(i=>e.idField?{[e.idField]:i.id,...i.data()}:i.data())),je.U0)}get(e){return(0,gi.H)(this.query.get(e)).pipe(je.U0)}}const Ay=new F.nKC("angularfire2.enableFirestorePersistence"),wy=new F.nKC("angularfire2.firestore.persistenceSettings"),Ry=new F.nKC("angularfire2.firestore.settings"),Py=new F.nKC("angularfire2.firestore.use-emulator");function Gd(r,e=t=>t){return{query:e(r),ref:r}}let Vy=(()=>{var r;class e{constructor(n,i,s,a,u,l,h,f,g,_,R,x,k,D,U,j,G){(0,He.A)(this,"schedulers",void 0),(0,He.A)(this,"firestore",void 0),(0,He.A)(this,"persistenceEnabled$",void 0),this.schedulers=h;const z=(0,mi.iB)(n,l,i),X=g;_&&(0,at.gF)(z,l,R,k,D,U,x,j),[this.firestore,this.persistenceEnabled$]=(0,mi.BM)(`${z.name}.firestore`,"AngularFirestore",z.name,()=>{const $=l.runOutsideAngular(()=>z.firestore());if(a&&$.settings(a),X&&$.useEmulator(...X),s&&!(0,Ms.Vy)(u)){const T=()=>{try{return(0,gi.H)($.enablePersistence(f||void 0).then(()=>!0,()=>!1))}catch(p){return typeof console<"u"&&console.warn(p),(0,Uu.of)(!1)}};return[$,l.runOutsideAngular(T)]}return[$,(0,Uu.of)(!1)]},[a,X,s])}collection(n,i){let s;s="string"==typeof n?this.firestore.collection(n):n;const{ref:a,query:u}=Gd(s,i),l=this.schedulers.ngZone.run(()=>a);return new qd(l,u,this)}collectionGroup(n,i){const s=i||(u=>u),a=this.firestore.collectionGroup(n);return new vy(s(a),this)}doc(n){let i;i="string"==typeof n?this.firestore.doc(n):n;const s=this.schedulers.ngZone.run(()=>i);return new Ld(s,this)}createId(){return this.firestore.collection("_").doc().id}}return r=e,(0,He.A)(e,"\u0275fac",function(n){return new(n||r)(F.KVO(mi.rx),F.KVO(mi.uP,8),F.KVO(Ay,8),F.KVO(Ry,8),F.KVO(F.Agw),F.KVO(F.SKi),F.KVO(je.u0),F.KVO(wy,8),F.KVO(Py,8),F.KVO(at.DS,8),F.KVO(at.CP,8),F.KVO(at.yy,8),F.KVO(at.ZP,8),F.KVO(at.$z,8),F.KVO(at.AU,8),F.KVO(at.UB,8),F.KVO(je.Jv,8))}),(0,He.A)(e,"\u0275prov",F.jDH({token:r,factory:r.\u0275fac,providedIn:"any"})),e})();function Sy(r,e){if(1&r){const t=F.RV6();F.j41(0,"ion-input",14),F.mxI("ngModelChange",function(i){F.eBV(t);const s=F.XpG();return F.DH7(s.usr.departamento,i)||(s.usr.departamento=i),F.Njj(i)}),F.k0s()}if(2&r){const t=F.XpG();F.R50("ngModel",t.usr.departamento)}}const by=[{path:"",component:(()=>{var r;class e{constructor(n,i,s,a,u){this.auths=n,this.router=i,this.alertCtrl=s,this.AFAuth=a,this.firestore=u,this.usr={id:Date.now().toString(),usuario:"",email:"",password:"",role:"",departamento:""},this.isProfesor=!1}ngOnInit(){}onRoleChange(){this.isProfesor="Profesor"===this.usr.role}register(n){var i=this;return(0,b.A)(function*(){return yield i.firestore.collection("usuarios").add(n)})()}registrarUsuario(){var n=this;return(0,b.A)(function*(){var i;const u={id:null===(i=(yield n.AFAuth.createUserWithEmailAndPassword(n.usr.email,n.usr.password)).user)||void 0===i?void 0:i.uid,usuario:n.usr.usuario,email:n.usr.email,password:n.usr.password,role:n.usr.role,departamento:n.usr.departamento};yield n.register(u),console.log("tamos listos mono culiao")})()}}return(r=e).\u0275fac=function(n){return new(n||r)(F.rXU(zf.f),F.rXU(fi.Ix),F.rXU(be.hG),F.rXU(at.DS),F.rXU(Vy))},r.\u0275cmp=F.VBU({type:r,selectors:[["app-registro"]],decls:25,vars:6,consts:[[3,"translucent"],["color","primary",1,"ion-padding"],[1,"register-card-content","register-container"],[3,"ngSubmit"],["src","assets/logo.png","alt","Logo",1,"logo"],["placeholder","Seleccione su rol","name","role",3,"ngModelChange","ionChange","ngModel"],["value","Alumno"],["value","Profesor"],["required","","label","Nombre de usuario","label-placement","floating","fill","outline","placeholder","Ingrese su nombre de usuario","name","usuario",3,"ngModelChange","ngModel"],["required","","label","Email","label-placement","floating","fill","outline","placeholder","Ingrese su email","name","email",3,"ngModelChange","ngModel"],["type","password","required","","label","Contrase\xf1a","name","password","label-placement","floating","fill","outline","placeholder","Ingrese su contrase\xf1a",3,"ngModelChange","ngModel"],["required","","label","Departamento","label-placement","floating","fill","outline","placeholder","Ingrese su departamento","name","departamento",3,"ngModel","ngModelChange",4,"ngIf"],["color","secondary","type","submit","expand","block"],["color","secondary","expand","full","fill","outline","routerLink","/login"],["required","","label","Departamento","label-placement","floating","fill","outline","placeholder","Ingrese su departamento","name","departamento",3,"ngModelChange","ngModel"]],template:function(n,i){1&n&&(F.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),F.EFF(3,"Formulario de registro DuocUC"),F.k0s()()(),F.j41(4,"ion-content",1)(5,"ion-card-content",2)(6,"form",3),F.bIt("ngSubmit",function(){return i.registrarUsuario()}),F.nrm(7,"img",4),F.j41(8,"ion-item")(9,"ion-label"),F.EFF(10,"Rol"),F.k0s(),F.j41(11,"ion-select",5),F.mxI("ngModelChange",function(a){return F.DH7(i.usr.role,a)||(i.usr.role=a),a}),F.bIt("ionChange",function(){return i.onRoleChange()}),F.j41(12,"ion-select-option",6),F.EFF(13,"Alumno"),F.k0s(),F.j41(14,"ion-select-option",7),F.EFF(15,"Profesor"),F.k0s()()(),F.j41(16,"ion-card-content")(17,"ion-input",8),F.mxI("ngModelChange",function(a){return F.DH7(i.usr.usuario,a)||(i.usr.usuario=a),a}),F.k0s(),F.j41(18,"ion-input",9),F.mxI("ngModelChange",function(a){return F.DH7(i.usr.email,a)||(i.usr.email=a),a}),F.k0s(),F.j41(19,"ion-input",10),F.mxI("ngModelChange",function(a){return F.DH7(i.usr.password,a)||(i.usr.password=a),a}),F.k0s(),F.DNE(20,Sy,1,1,"ion-input",11),F.j41(21,"ion-button",12),F.EFF(22,"Registrarse"),F.k0s()(),F.j41(23,"ion-button",13),F.EFF(24,"Ya tengo una cuenta"),F.k0s()()()()),2&n&&(F.Y8G("translucent",!0),F.R7$(11),F.R50("ngModel",i.usr.role),F.R7$(6),F.R50("ngModel",i.usr.usuario),F.R7$(),F.R50("ngModel",i.usr.email),F.R7$(),F.R50("ngModel",i.usr.password),F.R7$(),F.Y8G("ngIf",i.isProfesor))},dependencies:[Ms.bT,jt.qT,jt.BC,jt.cb,jt.YS,jt.vS,jt.cV,be.Jm,be.I9,be.W9,be.eU,be.$w,be.uz,be.he,be.Nm,be.Ip,be.BC,be.ai,be.Je,be.Gw,be.N7,fi.Wk]}),e})()}];let xy=(()=>{var r;class e{}return(r=e).\u0275fac=function(n){return new(n||r)},r.\u0275mod=F.$C({type:r}),r.\u0275inj=F.G2t({imports:[fi.iI.forChild(by),fi.iI]}),e})(),Cy=(()=>{var r;class e{}return(r=e).\u0275fac=function(n){return new(n||r)},r.\u0275mod=F.$C({type:r}),r.\u0275inj=F.G2t({imports:[Ms.MD,jt.YN,be.bv,xy]}),e})()}}]);